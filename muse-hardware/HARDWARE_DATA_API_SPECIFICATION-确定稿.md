# ç¡¬ä»¶æ•°æ®ä¸ŠæŠ¥APIæ¥å£è§„èŒƒ

## è®¾è®¡åŸåˆ™

- **ç»Ÿä¸€æ¥å£**ï¼šä½¿ç”¨å•ä¸€æ¥å£å¤„ç†æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥
- **æ‰å¹³ç»“æ„**ï¼šé¿å…JSONå­—ç¬¦ä¸²åµŒå¥—ï¼Œä½¿ç”¨æ¸…æ™°çš„å­—æ®µç»“æ„
- **ç®€å•æ˜“ç”¨**ï¼šæœ€å°åŒ–å­—æ®µæ•°é‡ï¼Œåªä¿ç•™å¿…è¦ä¿¡æ¯
- **æ˜“äºæ‰©å±•**ï¼šé€šè¿‡æ•°æ®ç±»å‹åŒºåˆ†ä¸åŒä¸ŠæŠ¥åœºæ™¯

---

##  æ ¸å¿ƒæ¥å£

### Tokenè·å–æ¥å£

**æ¥å£åœ°å€**: `POST /api/v2/auth/token`

**è¯·æ±‚å‚æ•°**:
- `deviceId` (å¿…å¡«): è®¾å¤‡IDï¼Œé€šè¿‡URLå‚æ•°æˆ–è¡¨å•å‚æ•°ä¼ é€’

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST "/api/v2/auth/token?deviceId=MUSE_PI_PRO_001"
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 200,
  "message": "Tokenè·å–æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "expiresIn": 86400,
    "deviceId": "MUSE_PI_PRO_001"
  }
}
```

**è¯´æ˜**:
- Tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼ˆ86400ç§’ï¼‰
- å¦‚æœè®¾å¤‡ä¸å­˜åœ¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºè®¾å¤‡è®°å½•
- è·å–Tokenåï¼Œè®¾å¤‡çŠ¶æ€ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºONLINE

---

### ç»Ÿä¸€æ•°æ®ä¸ŠæŠ¥æ¥å£

**æ¥å£åœ°å€**: `POST /api/v2/data/report`

**è®¤è¯æ–¹å¼**: é€šè¿‡URLå‚æ•°æˆ–Headerä¼ é€’Token
- URLå‚æ•°: `?token=YOUR_TOKEN`
- Header: `Authorization: Bearer YOUR_TOKEN`

**è¯·æ±‚æ ¼å¼**: `Content-Type: application/json`

---

## ğŸ“Š æ•°æ®æ ¼å¼

### ç»Ÿä¸€è¯·æ±‚ç»“æ„

```json
{
  "dataType": "event|status|gps",
  "timestamp": 1705123456789,
  "data": {
    // æ ¹æ®dataTypeä¸åŒï¼Œdataç»“æ„ä¸åŒ
  }
}
```

**å­—æ®µè¯´æ˜**:
- `dataType` (å¿…å¡«): æ•°æ®ç±»å‹ï¼Œå¯é€‰å€¼ï¼š`event`ï¼ˆäº‹ä»¶ï¼‰ã€`status`ï¼ˆçŠ¶æ€ï¼‰ã€`gps`ï¼ˆGPSï¼‰
- `timestamp` (å¿…å¡«): æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `data` (å¿…å¡«): å…·ä½“æ•°æ®å†…å®¹

---

## ğŸ“¦ æ•°æ®ç±»å‹è¯¦ç»†è¯´æ˜

### 1. äº‹ä»¶æ•°æ® (dataType: "event")

**è§¦å‘æ—¶æœº**: ç–²åŠ³ç­‰çº§å˜åŒ–æ—¶ä¸ŠæŠ¥

**æ•°æ®æ ¼å¼**:
```json
{
  "dataType": "event",
  "timestamp": 1705123456789,
  "data": {
    "eventId": "MUSE_PI_PRO_001_1705123456789_001",
    "level": "Level 2",
    "score": 75.5,
    "behavior": "eyes_closed",
    "confidence": 0.85,
    "duration": 2.3,
    "locationLat": 33.553485,
    "locationLng": 119.030977,
    "distractedCount": 7
  }
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| `eventId` | string | âœ… | äº‹ä»¶å”¯ä¸€ID | `"MUSE_PI_PRO_001_1705123456789_001"` |
| `level` | string | âœ… | å‘Šè­¦çº§åˆ« | `"Normal"`, `"Level 1"`, `"Level 2"`, `"Level 3"` |
| `score` | number | âœ… | ç–²åŠ³åˆ†æ•° (0-100) | `75.5` |
| `behavior` | string | âœ… | æ£€æµ‹åˆ°çš„è¡Œä¸º | `"eyes_closed"`, `"yarning"`, `"head_down"` |
| `confidence` | number | âœ… | æ£€æµ‹ç½®ä¿¡åº¦ (0-1) | `0.85` |
| `duration` | number | âœ… | è¡Œä¸ºæŒç»­æ—¶é—´(ç§’) | `2.3` |
| `locationLat` | number\|null | âš ï¸ | GPSçº¬åº¦ï¼Œå¤±è´¥æ—¶ä¸ºnull | `33.553485` æˆ– `null` |
| `locationLng` | number\|null | âš ï¸ | GPSç»åº¦ï¼Œå¤±è´¥æ—¶ä¸ºnull | `119.030977` æˆ– `null` |
| `distractedCount` | number | âœ… | ç´¯è®¡åˆ†å¿ƒæ¬¡æ•° | `7` |

**å‘Šè­¦çº§åˆ«è¯´æ˜**:
- `Normal`: æ­£å¸¸çŠ¶æ€ï¼Œåˆ†æ•° < 50
- `Level 1`: ä¸€çº§è­¦æŠ¥ï¼Œåˆ†æ•° 50-74
- `Level 2`: äºŒçº§è­¦æŠ¥ï¼Œåˆ†æ•° 75-94
- `Level 3`: ä¸‰çº§è­¦æŠ¥ï¼Œåˆ†æ•° â‰¥ 95

---

### 2. çŠ¶æ€æ•°æ® (dataType: "status")

**è§¦å‘æ—¶æœº**: å®šæœŸä¸ŠæŠ¥ï¼ˆå»ºè®®æ¯30ç§’ï¼‰

**æ•°æ®æ ¼å¼**:
```json
{
  "dataType": "status",
  "timestamp": 1705123456789,
  "data": {
    "level": "Normal",
    "score": 45.2,
    "locationLat": 33.553485,
    "locationLng": 119.030977,
    "cpuUsage": 45.2,
    "memoryUsage": 68.5,
    "temperature": 42.1
  }
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| `level` | string | âœ… | å½“å‰å‘Šè­¦çº§åˆ« | `"Normal"`, `"Level 1"`, `"Level 2"`, `"Level 3"` |
| `score` | number | âœ… | å½“å‰ç–²åŠ³åˆ†æ•° (0-100) | `45.2` |
| `locationLat` | number\|null | âš ï¸ | GPSçº¬åº¦ | `33.553485` æˆ– `null` |
| `locationLng` | number\|null | âš ï¸ | GPSç»åº¦ | `119.030977` æˆ– `null` |
| `cpuUsage` | number | âš ï¸ | CPUä½¿ç”¨ç‡ (%) | `45.2` |
| `memoryUsage` | number | âš ï¸ | å†…å­˜ä½¿ç”¨ç‡ (%) | `68.5` |
| `temperature` | number | âš ï¸ | è®¾å¤‡æ¸©åº¦ (Â°C) | `42.1` |

---

### 3. GPSæ•°æ® (dataType: "gps")

**è§¦å‘æ—¶æœº**: GPSä½ç½®æ›´æ–°æ—¶ä¸ŠæŠ¥ï¼ˆå»ºè®®æ¯20ç§’ï¼‰

**æ•°æ®æ ¼å¼**:
```json
{
  "dataType": "gps",
  "timestamp": 1705123456789,
  "data": {
    "locationLat": 33.553485,
    "locationLng": 119.030977,
    "speed": 60.5,
    "direction": 180.0,
    "altitude": 44.4,
    "satellites": 8
  }
}
```

**å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| `locationLat` | number\|null | âœ… | GPSçº¬åº¦ | `33.553485` æˆ– `null` |
| `locationLng` | number\|null | âœ… | GPSç»åº¦ | `119.030977` æˆ– `null` |
| `speed` | number\|null | âš ï¸ | é€Ÿåº¦ (km/h) | `60.5` æˆ– `null` |
| `direction` | number\|null | âš ï¸ | æ–¹å‘è§’ (åº¦) | `180.0` æˆ– `null` |
| `altitude` | number\|null | âš ï¸ | æµ·æ‹” (ç±³) | `44.4` æˆ– `null` |
| `satellites` | number\|null | âš ï¸ | å«æ˜Ÿæ•°é‡ | `8` æˆ– `null` |

---

## å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "received": true,
    "serverTime": 1705123456789
  }
}
```

### é”™è¯¯å“åº”

```json
{
  "code": 400,
  "message": "è¯·æ±‚å‚æ•°é”™è¯¯: dataTypeä¸èƒ½ä¸ºç©º",
  "data": null
}
```

**é”™è¯¯ç è¯´æ˜**:
- `200`: æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: è®¤è¯å¤±è´¥ï¼ˆTokenæ— æ•ˆï¼‰
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

##  ä¸ŠæŠ¥ç­–ç•¥

### ä¸ŠæŠ¥é¢‘ç‡

| æ•°æ®ç±»å‹ | ä¸ŠæŠ¥é¢‘ç‡ | è¯´æ˜ |
|----------|----------|------|
| `event` | äº‹ä»¶é©±åŠ¨ | ä»…åœ¨ç–²åŠ³ç­‰çº§å˜åŒ–æ—¶ä¸ŠæŠ¥ |
| `status` | æ¯30ç§’ | å®šæœŸä¸ŠæŠ¥è®¾å¤‡çŠ¶æ€ |
| `gps` | æ¯20ç§’ | GPSä½ç½®æ›´æ–°æ—¶ä¸ŠæŠ¥ |

### ç¦»çº¿å¤„ç†

- ç½‘ç»œå¤±è´¥æ—¶ï¼Œæ•°æ®è‡ªåŠ¨ç¼“å­˜åˆ°æœ¬åœ°é˜Ÿåˆ—
- ç½‘ç»œæ¢å¤åï¼Œè‡ªåŠ¨é‡å‘ç¼“å­˜çš„æ•°æ®
- é˜Ÿåˆ—å¤§å°é™åˆ¶ï¼šæœ€å¤§1000æ¡

---

##  åç«¯å¤„ç†çº¦å®š

### 1. äº‹ä»¶åˆ†ç±»

åç«¯æ ¹æ® `behavior` å­—æ®µè‡ªåŠ¨åˆ†ç±»äº‹ä»¶ç±»å‹ï¼š

| è¡Œä¸ºç±»å‹ | äº‹ä»¶ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `eyes_closed`, `yarning`, `eyes_closed_head_left`, `eyes_closed_head_right` | `FATIGUE` | ç–²åŠ³äº‹ä»¶ |
| `head_down`, `seeing_left`, `seeing_right` | `DISTRACTION` | åˆ†å¿ƒäº‹ä»¶ |
| å…¶ä»– | `EMERGENCY` | ç´§æ€¥äº‹ä»¶ |

### 2. ä¸¥é‡ç¨‹åº¦è®¡ç®—

åç«¯æ ¹æ® `score` å­—æ®µè‡ªåŠ¨è®¡ç®—ä¸¥é‡ç¨‹åº¦ï¼š

| åˆ†æ•°èŒƒå›´ | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ |
|----------|----------|------|
| â‰¥ 85 | `CRITICAL` | ä¸¥é‡ç–²åŠ³ |
| 70-84 | `HIGH` | é«˜åº¦ç–²åŠ³ |
| 60-69 | `MEDIUM` | ä¸­ç­‰ç–²åŠ³ |
| 10-59 | `LOW` | è½»å¾®ç–²åŠ³ |
| < 10 | - | ä¸ä¸ŠæŠ¥ |

### 3. GPIOæ˜ å°„

åç«¯æ ¹æ® `level` å­—æ®µè‡ªåŠ¨æ˜ å°„GPIOåŠ¨ä½œï¼ˆä»…è®°å½•ï¼Œç¡¬ä»¶ç«¯è‡ªè¡Œæ§åˆ¶ï¼‰ï¼š

| ç­‰çº§ | GPIOåŠ¨ä½œ | è¯´æ˜ |
|------|----------|------|
| `Normal` | æ— åŠ¨ä½œ | æ­£å¸¸é©¾é©¶çŠ¶æ€ |
| `Level 1` | GPIO70 | LEDé—ªçƒæé†’ |
| `Level 2` | GPIO70+71 | LEDé—ªçƒ+æŒ¯åŠ¨é©¬è¾¾ |
| `Level 3` | GPIO70+71+72 | LEDé—ªçƒ+æŒ¯åŠ¨é©¬è¾¾+èœ‚é¸£å™¨ |

---

## æµ‹è¯•ç¤ºä¾‹

### ç¤ºä¾‹1: äº‹ä»¶ä¸ŠæŠ¥

```bash
curl -X POST "/api/v2/data/report?token=YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "dataType": "event",
    "timestamp": 1705123456789,
    "data": {
      "eventId": "MUSE_PI_PRO_001_1705123456789_001",
      "level": "Level 2",
      "score": 75.5,
      "behavior": "eyes_closed",
      "confidence": 0.85,
      "duration": 2.3,
      "locationLat": 33.553485,
      "locationLng": 119.030977,
      "distractedCount": 7
    }
  }'
```

### ç¤ºä¾‹2: GPSå¤±è´¥æƒ…å†µ

```bash
curl -X POST "/api/v2/data/report?token=YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "dataType": "event",
    "timestamp": 1705123456789,
    "data": {
      "eventId": "MUSE_PI_PRO_001_1705123456789_002",
      "level": "Level 1",
      "score": 65.0,
      "behavior": "head_down",
      "confidence": 0.78,
      "duration": 1.5,
      "locationLat": null,
      "locationLng": null,
      "distractedCount": 3
    }
  }'
```

### ç¤ºä¾‹3: çŠ¶æ€ä¸ŠæŠ¥

```bash
curl -X POST "/api/v2/data/report?token=YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "dataType": "status",
    "timestamp": 1705123456789,
    "data": {
      "level": "Normal",
      "score": 45.2,
      "locationLat": 33.553485,
      "locationLng": 119.030977,
      "cpuUsage": 45.2,
      "memoryUsage": 68.5,
      "temperature": 42.1
    }
  }'
```

---

##  æ€»ç»“

1. **ç»Ÿä¸€æ¥å£**: åªéœ€ä¸€ä¸ªæ¥å£ï¼Œç®€åŒ–è°ƒç”¨é€»è¾‘
2. **æ‰å¹³ç»“æ„**: æ— JSONå­—ç¬¦ä¸²åµŒå¥—ï¼Œæ˜“äºè§£æ
3. **å­—æ®µç²¾ç®€**: åªä¿ç•™å¿…è¦å­—æ®µï¼Œå‡å°‘æ•°æ®é‡
4. **æ˜“äºæ‰©å±•**: é€šè¿‡dataTypeè½»æ¾æ·»åŠ æ–°æ•°æ®ç±»å‹
5. **åç«¯æ™ºèƒ½**: äº‹ä»¶åˆ†ç±»ã€ä¸¥é‡ç¨‹åº¦è®¡ç®—ç­‰ç”±åç«¯å¤„ç†
6. **å®¹é”™æ€§å¼º**: GPSå¤±è´¥æ—¶ä¼ é€’nullï¼Œåç«¯çµæ´»å¤„ç†

### ç¡¬ä»¶ç«¯æ”¹é€ 

1. **ç»Ÿä¸€æ¥å£è°ƒç”¨**: å°†æ‰€æœ‰æ•°æ®ä¸ŠæŠ¥ç»Ÿä¸€åˆ° `/api/v2/data/report`
2. **ç®€åŒ–æ•°æ®æ ¼å¼**: ç§»é™¤JSONå­—ç¬¦ä¸²åµŒå¥—ï¼Œä½¿ç”¨æ‰å¹³ç»“æ„
3. **ç§»é™¤å†—ä½™å­—æ®µ**: åªä¼ é€’å¿…è¦æ•°æ®ï¼Œè®©åç«¯å¤„ç†ä¸šåŠ¡é€»è¾‘

### åç«¯æ”¹é€ 

1. **æ–°å¢ç»Ÿä¸€æ¥å£**: å®ç° `/api/v2/data/report` æ¥å£
2. **æ•°æ®è·¯ç”±**: æ ¹æ®dataTypeè·¯ç”±åˆ°ä¸åŒçš„å¤„ç†é€»è¾‘
3. **ä¸šåŠ¡å¤„ç†**: å®ç°äº‹ä»¶åˆ†ç±»ã€ä¸¥é‡ç¨‹åº¦è®¡ç®—ç­‰ä¸šåŠ¡é€»è¾‘

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¶é—´**: 2025-12-1  
**é€‚ç”¨ç‰ˆæœ¬**: Muse Pi Pro Plus v2.0+

