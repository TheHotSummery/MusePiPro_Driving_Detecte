const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AlertCenter-DqcXjlyX.js","assets/vendor-BleAlWPf.js","assets/element-DCn9y4rn.js","assets/charts-TxDtCNV3.js","assets/AlertCenter-BHcmqX6g.css","assets/Analytics-D0sR7oBF.js","assets/Analytics-QBwIeuHS.css","assets/UserManagement-sIcLpazW.js","assets/UserManagement-DKxOPfbl.css","assets/WebSocketTest-DwPzZszk.js","assets/WebSocketTest-Cuq8cH5p.css","assets/MapConfigHelp-xktf-ILU.js","assets/MapConfigHelp-IbllU7-j.css"])))=>i.map(i=>d[i]);
import{r as R,c as J,ax as rn,h as Be,U as He,z as j,A as P,R as a,J as i,al as T,B as d,u as U,I as ie,O as A,P as E,M as rt,E as be,L as we,j as Re,n as cn,ad as jt,ay as Mt,az as Rt,ar as Lt,Q as Le,a6 as Pe,D as no,K as Pt,W as un,aA as oo,aB as so,au as ao,aC as lo}from"./vendor-BleAlWPf.js";import{m as dn,w as ro,b as Et,a as io,s as co,i as uo,c as $t,d as fo,u as po,e as mo,f as fn,g as vo,l as pn,E as he,r as xe,h as ho,j as go,k as mn,v as yo,n as _o,o as wo,p as bo,q as So,t as Eo}from"./element-DCn9y4rn.js";import{u as vn,E as hn,i as gn,a as Io,b as yn,c as _n,d as wn,e as bn,f as Co,g as To,h as ko}from"./charts-TxDtCNV3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();class Ao{constructor(){this.socket=null,this.stompClient=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=5e3,this.listeners=new Map}connect(){const t="ws://spacemit.topcoder.fun/websocket";try{this.loadDependencies().then(()=>{this.createSTOMPConnection(t)}).catch(n=>{console.error("加载依赖失败:",n),this.emit("error",n)})}catch(n){console.error("WebSocket连接失败:",n),this.emit("error",n);return}}loadDependencies(){return new Promise((t,n)=>{const o=[];if(window.SockJS||o.push(this.loadScript("https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js")),window.Stomp||o.push(this.loadScript("https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js")),o.length===0){t();return}Promise.all(o).then(t).catch(n)})}loadScript(t){return new Promise((n,o)=>{const s=document.createElement("script");s.src=t,s.onload=n,s.onerror=o,document.head.appendChild(s)})}createSTOMPConnection(t){try{console.log("创建STOMP连接:",t),this.socket=new window.SockJS(t),this.stompClient=window.Stomp.over(this.socket),this.stompClient.debug=null,this.stompClient.connect({},n=>{console.log("WebSocket连接成功:",n),this.isConnected=!0,this.reconnectAttempts=0,this.subscribeToTopics(),this.emit("connected",n)},n=>{console.error("WebSocket连接失败:",n),this.isConnected=!1,this.handleReconnect()})}catch(n){console.error("STOMP连接失败:",n),this.emit("error",n)}}subscribeToTopics(){console.log("开始订阅WebSocket主题..."),this.stompClient.subscribe("/topic/realtime_data",t=>{try{const n=JSON.parse(t.body);console.log("收到实时数据推送:",n),this.emit("realtime_data",n)}catch(n){console.error("解析实时数据失败:",n)}}),this.stompClient.subscribe("/topic/device_status",t=>{try{const n=JSON.parse(t.body);console.log("收到设备状态更新:",n),this.emit("device_status",n)}catch(n){console.error("解析设备状态更新失败:",n)}}),this.stompClient.subscribe("/topic/alert",t=>{try{const n=JSON.parse(t.body);console.log("收到告警推送:",n),this.emit("alert",n)}catch(n){console.error("解析告警推送失败:",n)}}),this.stompClient.subscribe("/topic/event",t=>{try{const n=JSON.parse(t.body);console.log("收到事件通知:",n),this.emit("event",n)}catch(n){console.error("解析事件通知失败:",n)}}),console.log("WebSocket主题订阅完成")}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`尝试重连 (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},this.reconnectInterval)):(console.error("达到最大重连次数，停止重连"),this.emit("max_reconnect_attempts"))}disconnect(){this.stompClient&&this.isConnected&&this.stompClient.disconnect(()=>{console.log("WebSocket连接已断开"),this.isConnected=!1,this.emit("disconnected")})}send(t,n,o={}){this.stompClient&&this.isConnected?this.stompClient.send(t,o,JSON.stringify(n)):console.warn("WebSocket未连接，无法发送消息")}on(t,n){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n)}off(t,n){if(this.listeners.has(t)){const o=this.listeners.get(t),s=o.indexOf(n);s>-1&&o.splice(s,1)}}emit(t,n){this.listeners.has(t)&&this.listeners.get(t).forEach(o=>{try{o(n)}catch(s){console.error(`事件处理器执行失败 (${t}):`,s)}})}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts}}}const te=new Ao,Ee=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},xo={id:"app"},Do={class:"header-content"},Oo={class:"header-actions"},Mo={__name:"App",setup(e){const t=rn(),n=R(!1),o=R(!1),s=R(!1),r=J(()=>t.path==="/"?"/dashboard":t.path),l=R(new Date().toLocaleString()),p=R("production"),w=R("http://spacemit.topcoder.fun"),m=()=>{n.value=!n.value,document.documentElement.classList.toggle("dark",n.value),localStorage.setItem("theme",n.value?"dark":"light")},u=()=>{o.value=!0},_=C=>{const v={analytics:"/analytics",users:"/users","websocket-test":"/websocket-test"};v[C]&&(window.location.href=v[C])},I=C=>{s.value=C};return Be(()=>{localStorage.getItem("theme")==="dark"&&(n.value=!0,document.documentElement.classList.add("dark")),te.on("connected",()=>I(!0)),te.on("disconnected",()=>I(!1)),s.value=te.getConnectionStatus().isConnected}),He(()=>{te.off("connected",I),te.off("disconnected",I)}),(C,v)=>{const g=T("el-icon"),y=T("el-menu-item"),S=T("el-menu"),D=T("el-button"),O=T("el-dropdown-item"),z=T("el-dropdown-menu"),V=T("el-dropdown"),q=T("el-header"),Y=T("RouterView"),ne=T("el-main"),ee=T("el-descriptions-item"),ue=T("el-tag"),me=T("el-descriptions"),de=T("el-dialog");return P(),j("div",xo,[a(q,{class:"app-header"},{default:i(()=>[d("div",Do,[v[8]||(v[8]=d("div",{class:"logo"},[d("h1",null,"Muse 云端实时检测平台")],-1)),a(S,{"default-active":r.value,mode:"horizontal",router:"",class:"header-menu"},{default:i(()=>[a(y,{index:"/dashboard"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(dn))]),_:1}),v[1]||(v[1]=d("span",null,"实时监控",-1))]),_:1}),a(y,{index:"/events"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(ro))]),_:1}),v[2]||(v[2]=d("span",null,"事件中心",-1))]),_:1}),a(y,{index:"/alerts"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(Et))]),_:1}),v[3]||(v[3]=d("span",null,"告警中心",-1))]),_:1})]),_:1},8,["default-active"]),d("div",Oo,[a(D,{size:"small",onClick:m},{default:i(()=>[a(g,null,{default:i(()=>[n.value?(P(),ie(U(io),{key:0})):(P(),ie(U(co),{key:1}))]),_:1})]),_:1}),a(D,{size:"small",onClick:u},{default:i(()=>[a(g,null,{default:i(()=>[a(U(uo))]),_:1})]),_:1}),a(V,{onCommand:_,trigger:"click"},{dropdown:i(()=>[a(z,null,{default:i(()=>[a(O,{command:"analytics"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(fo))]),_:1}),v[5]||(v[5]=A(" 数据分析 ",-1))]),_:1}),a(O,{command:"users"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(po))]),_:1}),v[6]||(v[6]=A(" 用户管理 ",-1))]),_:1}),a(O,{command:"websocket-test"},{default:i(()=>[a(g,null,{default:i(()=>[a(U(mo))]),_:1}),v[7]||(v[7]=A(" 连接测试 ",-1))]),_:1})]),_:1})]),default:i(()=>[a(D,{size:"small"},{default:i(()=>[a(g,null,{default:i(()=>[a(U($t))]),_:1}),v[4]||(v[4]=A(" 管理 ",-1))]),_:1})]),_:1})])])]),_:1}),a(ne,{class:"app-main"},{default:i(()=>[a(Y)]),_:1}),a(de,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=ge=>o.value=ge),title:"系统信息",width:"500px"},{default:i(()=>[a(me,{column:1,border:""},{default:i(()=>[a(ee,{label:"系统版本"},{default:i(()=>[...v[9]||(v[9]=[A("v1.0.0",-1)])]),_:1}),a(ee,{label:"构建时间"},{default:i(()=>[A(E(l.value),1)]),_:1}),a(ee,{label:"运行环境"},{default:i(()=>[A(E(p.value),1)]),_:1}),a(ee,{label:"API地址"},{default:i(()=>[A(E(w.value),1)]),_:1}),a(ee,{label:"WebSocket状态"},{default:i(()=>[a(ue,{type:s.value?"success":"danger"},{default:i(()=>[A(E(s.value?"已连接":"未连接"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ro=Ee(Mo,[["__scopeId","data-v-ff617af4"]]),Lo="modulepreload",Po=function(e){return"/"+e},Wt={},Ge=function(t,n,o){let s=Promise.resolve();if(n&&n.length>0){let w=function(m){return Promise.all(m.map(u=>Promise.resolve(u).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),p=l?.nonce||l?.getAttribute("nonce");s=w(n.map(m=>{if(m=Po(m),m in Wt)return;Wt[m]=!0;const u=m.endsWith(".css"),_=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${_}`))return;const I=document.createElement("link");if(I.rel=u?"stylesheet":Lo,u||(I.as="script"),I.crossOrigin="",I.href=m,p&&I.setAttribute("nonce",p),document.head.appendChild(I),u)return new Promise((C,v)=>{I.addEventListener("load",C),I.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${m}`)))})}))}function r(l){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=l,window.dispatchEvent(p),!p.defaultPrevented)throw l}return s.then(l=>{for(const p of l||[])p.status==="rejected"&&r(p.reason);return t().catch(r)})},$o={class:"stat-content"},No={class:"stat-value"},Fo={class:"stat-label"},Uo={key:0,class:"stat-trend"},zo={__name:"StatCard",props:{title:{type:String,required:!0},value:{type:[Number,String],required:!0},icon:{type:String,required:!0},color:{type:String,default:"primary",validator:e=>["primary","success","warning","danger","info"].includes(e)},suffix:{type:String,default:""},trend:{type:Number,default:void 0},pulse:{type:Boolean,default:!1},highlight:{type:Boolean,default:!1},urgent:{type:Boolean,default:!1}},setup(e){const t=e,n=J(()=>typeof t.value=="number"?t.value.toLocaleString():t.value),o=J(()=>`stat-card--${t.color}${t.pulse?" stat-card--pulse":""}${t.highlight?" stat-card--highlight":""}${t.urgent?" stat-card--urgent":""}`),s=J(()=>`stat-icon--${t.color}${t.pulse?" stat-icon--pulse":""}${t.highlight?" stat-icon--highlight":""}${t.urgent?" stat-icon--urgent":""}`),r=J(()=>t.trend>0?"trend-up":"trend-down");return(l,p)=>{const w=T("el-icon");return P(),j("div",{class:be(["stat-card",o.value])},[d("div",{class:be(["stat-icon",s.value])},[a(w,null,{default:i(()=>[(P(),ie(rt(e.icon)))]),_:1})],2),d("div",$o,[d("div",No,E(n.value)+E(e.suffix),1),d("div",Fo,E(e.title),1),e.trend!==void 0?(P(),j("div",Uo,[a(w,{class:be(r.value)},{default:i(()=>[(P(),ie(rt(e.trend>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),d("span",null,E(Math.abs(e.trend))+"%",1)])):we("",!0)])],2)}}},ot=Ee(zo,[["__scopeId","data-v-d57b29d8"]]),Bo={__name:"DeviceStatusTag",props:{status:{type:String,required:!0,validator:e=>["ONLINE","OFFLINE","LOST"].includes(e)},effect:{type:String,default:"light",validator:e=>["dark","light","plain"].includes(e)}},setup(e){const t=e,n={ONLINE:{type:"success",icon:"CircleCheck",text:"在线"},OFFLINE:{type:"info",icon:"CircleClose",text:"离线"},LOST:{type:"danger",icon:"Warning",text:"失联"}},o=J(()=>n[t.status]?.type||"info"),s=J(()=>n[t.status]?.icon||"CircleClose"),r=J(()=>n[t.status]?.text||"未知");return(l,p)=>{const w=T("el-icon"),m=T("el-tag");return P(),ie(m,{type:o.value,effect:e.effect,size:"small"},{default:i(()=>[a(w,{class:"status-icon"},{default:i(()=>[(P(),ie(rt(s.value)))]),_:1}),A(" "+E(r.value),1)]),_:1},8,["type","effect"])}}},It=Ee(Bo,[["__scopeId","data-v-2e81de45"]]),Ho={class:"health-progress"},Vo={__name:"HealthProgress",props:{score:{type:Number,required:!0,validator:e=>e>=0&&e<=100}},setup(e){const t=e,n=J(()=>Math.round(t.score)),o=J(()=>t.score>=80?"#67C23A":t.score>=60?"#E6A23C":"#F56C6C"),s=J(()=>t.score>=80?"text-success":t.score>=60?"text-warning":"text-danger");return(r,l)=>{const p=T("el-progress");return P(),j("div",Ho,[a(p,{percentage:n.value,color:o.value,"stroke-width":8,"show-text":!1},null,8,["percentage","color"]),d("span",{class:be(["health-text",s.value])},E(n.value)+"%",3)])}}},Ct=Ee(Vo,[["__scopeId","data-v-ada9c17b"]]),jo={class:"map-controls"},Wo={key:0,class:"map-error"},qo={key:1,class:"map-loading"},ve=3.141592653589793,qt=6378245,Gt=.006693421622965943,Go={__name:"SimpleMap",props:{devices:{type:Array,default:()=>[]},center:{type:Object,default:()=>({lat:33.553733,lng:119.030953})},zoom:{type:Number,default:10}},emits:["device-click","map-ready"],setup(e,{expose:t,emit:n}){const o=e,s=n,r=R(null),l=R(!1),p=R(""),w=R("");let m=null,u=[],_=null;function I(f,c){let M=-100+2*f+3*c+.2*c*c+.1*f*c+.2*Math.sqrt(Math.abs(f));return M+=(20*Math.sin(6*f*ve)+20*Math.sin(2*f*ve))*2/3,M+=(20*Math.sin(c*ve)+40*Math.sin(c/3*ve))*2/3,M+=(160*Math.sin(c/12*ve)+320*Math.sin(c*ve/30))*2/3,M}function C(f,c){let M=300+f+2*c+.1*f*f+.1*f*c+.1*Math.sqrt(Math.abs(f));return M+=(20*Math.sin(6*f*ve)+20*Math.sin(2*f*ve))*2/3,M+=(20*Math.sin(f*ve)+40*Math.sin(f/3*ve))*2/3,M+=(150*Math.sin(f/12*ve)+300*Math.sin(f/30*ve))*2/3,M}function v(f,c){return f<72.004||f>137.8347||c<.8293||c>55.8271||!1}function g(f,c){if(v(f,c))return[f,c];{let M=I(f-105,c-35),L=C(f-105,c-35);const B=c/180*ve;let W=Math.sin(B);W=1-Gt*W*W;const x=Math.sqrt(W);M=M*180/(qt*(1-Gt)/(W*x)*ve),L=L*180/(qt/x*Math.cos(B)*ve);const $=c+M;return[f+L,$]}}const y=R(""),S=()=>{const f="732a364f70864bb0c4ac3395cc3d5503";localStorage.getItem("amap_api_key"),y.value=f},D=async()=>{if(console.log("开始初始化地图..."),console.log("API Key:",y.value?"已配置":"未配置"),console.log("地图容器:",r.value),!y.value){p.value="高德地图API key未配置";return}if(!r.value){p.value="地图容器未找到";return}l.value=!0,p.value="";try{if(window.AMap||(console.log("加载高德地图API..."),await O()),!window.AMap)throw new Error("高德地图API加载失败");console.log("AMap已加载，开始创建地图实例..."),console.log("地图容器尺寸:",r.value.offsetWidth,"x",r.value.offsetHeight),m=new window.AMap.Map(r.value,{center:[o.center.lng,o.center.lat],zoom:o.zoom,mapStyle:"amap://styles/normal"}),console.log("地图实例创建成功"),_=new window.AMap.InfoWindow({offset:new window.AMap.Pixel(0,-30)}),m.on("complete",()=>{console.log("地图加载完成"),m.on("click",()=>{_&&_.close()}),s("map-ready",m),z(),l.value=!1})}catch(f){console.error("地图初始化失败:",f),p.value=f.message||"地图初始化失败",l.value=!1}},O=()=>new Promise((f,c)=>{if(window.AMap){f();return}const M=localStorage.getItem("amap_version")||"1.4.15",L=document.createElement("script");L.src=`https://webapi.amap.com/maps?v=${M}&key=${y.value}`,L.onload=()=>{const B=()=>{window.AMap&&window.AMap.Map?f():setTimeout(B,100)};B()},L.onerror=()=>{c(new Error("高德地图API加载失败"))},document.head.appendChild(L)}),z=()=>{if(!m)return;console.log("=== 更新地图标记 ==="),console.log("所有设备:",o.devices),console.log("当前筛选状态:",w.value),u.forEach(c=>m.remove(c)),u=[];const f=o.devices.filter(c=>{const M=jt(c)||c;if(console.log(`检查设备 ${M.deviceId}:`,{status:M.status,hasLocation:!!(M.location&&M.location.lat&&M.location.lng),location:M.location}),w.value&&M.status!==w.value)return console.log(`设备 ${M.deviceId} 状态不匹配，跳过`),!1;const L=M.location&&M.location.lat&&M.location.lng;return L||console.log(`设备 ${M.deviceId} 没有有效位置信息，跳过`),L});console.log("筛选后的设备:",f),f.forEach((c,M)=>{const L=jt(c)||c;if(L.location&&L.location.lat&&L.location.lng){const[B,W]=g(L.location.lng,L.location.lat),x=new window.AMap.Marker({position:[B,W],title:`${L.deviceId} - ${L.username||"未知用户"}`,icon:V(L.status,M),anchor:"center",label:{content:`${L.deviceId}<br/>${L.username||"未知用户"}<br/>${q(L.status)}`,direction:"bottom",offset:new window.AMap.Pixel(0,10),style:{backgroundColor:Y(L.status),color:"#fff",fontSize:"12px",padding:"4px 8px",borderRadius:"4px",border:"1px solid #fff"}}});x.on("click",()=>{ne(L,x),s("device-click",L)}),u.push(x),m.add(x)}}),f.length>0&&m.setFitView(u)},V=(f,c)=>{const M=["#67C23A","#E6A23C","#F56C6C","#409EFF","#909399","#9C27B0","#FF9800","#4CAF50"],L=M[c%M.length];return new window.AMap.Icon({size:new window.AMap.Size(32,32),image:`data:image/svg+xml;base64,${btoa(`
      <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="12" fill="${L}" stroke="#fff" stroke-width="2"/>
        <circle cx="16" cy="16" r="4" fill="#fff"/>
        <text x="16" y="20" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">${c+1}</text>
      </svg>
    `)}`,imageSize:new window.AMap.Size(32,32)})},q=f=>({ONLINE:"在线",OFFLINE:"离线",LOST:"失联"})[f]||"未知",Y=f=>({ONLINE:"#67C23A",OFFLINE:"#909399",LOST:"#F56C6C"})[f]||"#909399",ne=(f,c)=>{const[M,L]=g(f.location.lng,f.location.lat),B=`
    <div class="device-info-window">
      <h4>${f.deviceId}</h4>
      <p><strong>驾驶员:</strong> ${f.username||"未知"}</p>
      <p><strong>状态:</strong> <span style="color: ${Y(f.status)}">${q(f.status)}</span></p>
      <p><strong>健康度:</strong> ${f.healthScore||0}%</p>
      <p><strong>最后心跳:</strong> ${ee(f.lastSeen)}</p>
      <hr style="margin: 8px 0;">
      <p><strong>原始坐标 (WGS-84):</strong></p>
      <p>经度: ${f.location.lng.toFixed(6)}</p>
      <p>纬度: ${f.location.lat.toFixed(6)}</p>
      <p><strong>校准坐标 (GCJ-02):</strong></p>
      <p>经度: ${M.toFixed(6)}</p>
      <p>纬度: ${L.toFixed(6)}</p>
    </div>
  `;_.setContent(B),_.open(m,c.getPosition())},ee=f=>{if(!f)return"未知";const c=new Date(f),L=new Date-c,B=Math.floor(L/6e4);if(B<1)return"刚刚";if(B<60)return`${B}分钟前`;const W=Math.floor(B/60);return W<24?`${W}小时前`:c.toLocaleDateString()},ue=()=>{m&&o.devices.length>0?m.setFitView(u):m&&m.setCenter([o.center.lng,o.center.lat])},me=()=>{r.value.requestFullscreen&&r.value.requestFullscreen()},de=()=>{p.value="",m&&(m.destroy(),m=null),D()},ge=()=>{console.log("强制刷新地图..."),m&&(m.destroy(),m=null),u=[],setTimeout(()=>{D()},100)};return Re(()=>o.devices,z,{deep:!0}),Re(()=>y.value,f=>{f&&!m&&D()}),Be(()=>{S(),cn(()=>{y.value&&D()})}),He(()=>{m&&m.destroy()}),t({centerMap:ue,updateMarkers:z,forceRefresh:ge,getMap:()=>m}),(f,c)=>{const M=T("el-option"),L=T("el-select"),B=T("el-icon"),W=T("el-button"),x=T("el-button-group"),$=T("el-alert");return P(),j("div",{class:"simple-map",ref_key:"mapContainer",ref:r},[d("div",jo,[a(L,{modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=Q=>w.value=Q),placeholder:"筛选设备状态",size:"small",clearable:"",style:{"margin-right":"10px",width:"150px"},onChange:z},{default:i(()=>[a(M,{label:"全部设备",value:""}),a(M,{label:"在线设备",value:"ONLINE"}),a(M,{label:"离线设备",value:"OFFLINE"}),a(M,{label:"失联设备",value:"LOST"})]),_:1},8,["modelValue"]),a(x,null,{default:i(()=>[a(W,{size:"small",onClick:ue},{default:i(()=>[a(B,null,{default:i(()=>[a(U(fn))]),_:1}),c[1]||(c[1]=A(" 居中 ",-1))]),_:1}),a(W,{size:"small",onClick:me},{default:i(()=>[a(B,null,{default:i(()=>[a(U(vo))]),_:1}),c[2]||(c[2]=A(" 全屏 ",-1))]),_:1})]),_:1})]),p.value?(P(),j("div",Wo,[a($,{title:"地图加载失败",description:p.value,type:"error","show-icon":"",closable:!1},null,8,["description"]),a(W,{onClick:de,style:{"margin-top":"10px"}},{default:i(()=>[...c[3]||(c[3]=[A("重试",-1)])]),_:1})])):we("",!0),l.value?(P(),j("div",qo,[a(B,{class:"is-loading"},{default:i(()=>[a(U(pn))]),_:1}),c[4]||(c[4]=d("span",null,"地图加载中...",-1))])):we("",!0)],512)}}},Ko=Ee(Go,[["__scopeId","data-v-0fd1051c"]]),Jo={class:"event-trend-chart"},Yo={class:"chart-header"},Xo={__name:"EventTrendChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["period-change"],setup(e,{emit:t}){vn([gn,Io,yn,_n,wn,bn,Co]);const n=e,o=t,s=R("today"),r=J(()=>{const u=["FATIGUE","DISTRACTION","EMERGENCY"],_=["#FF8C00","#DC143C","#32CD32"],I=l();return{title:{text:"事件趋势",left:"center",textStyle:{fontSize:16,fontWeight:"bold",color:"#303133"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",lineStyle:{color:"#999",width:1}},backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#fff"},formatter:function(C){let v=`<div style="margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #fff;">${C[0].axisValue}</div>`;return C.forEach(g=>{const y=g.value||0;v+=`<div style="margin: 4px 0; display: flex; align-items: center;">
            <span style="display: inline-block; width: 12px; height: 12px; background-color: ${g.color}; border-radius: 50%; margin-right: 8px;"></span>
            <span style="color: #fff; font-weight: 500;">${g.seriesName}:</span>
            <span style="color: #fff; font-weight: bold; margin-left: 8px;">${y}</span>
          </div>`}),v}},legend:{data:["疲劳事件","分心事件","紧急事件"],top:30,textStyle:{fontSize:12,fontWeight:"bold"}},grid:{left:"3%",right:"4%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:I.timeLabels,axisLabel:{rotate:45,color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ddd"}}},yAxis:{type:"value",name:"事件数量",nameTextStyle:{color:"#666",fontSize:12},axisLabel:{formatter:"{value}",color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ddd"}},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},dataZoom:[{type:"inside",start:0,end:100}],series:u.map((C,v)=>({name:w(C),type:"line",data:I.seriesData[C]||[],smooth:!0,symbol:"circle",symbolSize:8,lineStyle:{width:4},itemStyle:{color:_[v],borderColor:"#fff",borderWidth:2},areaStyle:{opacity:.2,color:_[v]},label:{show:!1,position:"top",formatter:"{c}",fontSize:10,fontWeight:"bold",color:_[v]},emphasis:{focus:"series",itemStyle:{borderColor:"#fff",borderWidth:3,shadowBlur:10,shadowColor:_[v]}}}))}}),l=()=>{if(!n.data.length)return{timeLabels:[],seriesData:{}};const u={},_=["FATIGUE","DISTRACTION","EMERGENCY"];n.data.forEach(v=>{const g=p(v.timestamp);u[g]||(u[g]={}),u[g][v.eventType]||(u[g][v.eventType]=0),u[g][v.eventType]++});const I=Object.keys(u).sort(),C={};return _.forEach(v=>{C[v]=I.map(g=>u[g]?.[v]||0)}),{timeLabels:I,seriesData:C}},p=u=>{const _=new Date(u);switch(s.value){case"today":return`${_.getHours().toString().padStart(2,"0")}:${_.getMinutes().toString().padStart(2,"0")}`;case"week":return`${_.getMonth()+1}/${_.getDate()}`;case"month":return`${_.getMonth()+1}/${_.getDate()}`;default:return _.toLocaleDateString()}},w=u=>({FATIGUE:"疲劳事件",DISTRACTION:"分心事件",EMERGENCY:"紧急事件"})[u]||u,m=u=>{o("period-change",u)};return Re(()=>n.data,()=>{},{deep:!0}),(u,_)=>{const I=T("el-option"),C=T("el-select");return P(),j("div",Jo,[d("div",Yo,[_[1]||(_[1]=d("h3",null,"事件趋势分析",-1)),a(C,{modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=v=>s.value=v),onChange:m,size:"small"},{default:i(()=>[a(I,{label:"今日",value:"today"}),a(I,{label:"本周",value:"week"}),a(I,{label:"本月",value:"month"})]),_:1},8,["modelValue"])]),a(U(hn),{class:"chart",option:r.value,loading:e.loading,autoresize:"","canvas-id":"event-trend-chart"},null,8,["option","loading"])])}}},Sn=Ee(Xo,[["__scopeId","data-v-b1a642fe"]]),Qo={class:"fatigue-analysis-chart"},Zo={class:"chart-header"},es={__name:"FatigueAnalysisChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["type-change"],setup(e,{emit:t}){vn([gn,To,ko,yn,_n,wn,bn]);const n=e,o=t,s=R("hourly"),r=J(()=>{switch(s.value){case"hourly":return l();case"severity":return p();case"behavior":return w();default:return l()}}),l=()=>{const C=m();return{title:{text:"疲劳事件小时分布",left:"center",textStyle:{fontSize:16,fontWeight:"bold",color:"#303133"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",shadowStyle:{color:"rgba(0, 0, 0, 0.1)"}},backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#fff"},formatter:function(v){const g=v[0];return`<div style="color: #fff; font-weight: bold;">${g.axisValue}:00</div>
                <div style="margin-top: 4px; color: #fff;">
                  <span style="display: inline-block; width: 12px; height: 12px; background-color: ${g.color}; border-radius: 50%; margin-right: 8px;"></span>
                  疲劳事件: <span style="font-weight: bold;">${g.value}</span>
                </div>`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:C.labels,axisLabel:{formatter:"{value}:00",color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ddd"}}},yAxis:{type:"value",name:"事件数量",nameTextStyle:{color:"#666",fontSize:12},axisLabel:{color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ddd"}},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"疲劳事件",type:"bar",data:C.values,itemStyle:{color:"#FF8C00",borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:"#FF7F00",shadowBlur:10,shadowColor:"#FF8C00"}},label:{show:!0,position:"top",formatter:"{c}",fontSize:10,fontWeight:"bold",color:"#FF8C00"}}]}},p=()=>{const C=u();return{title:{text:"疲劳事件严重程度分布",left:"center",textStyle:{fontSize:16,fontWeight:"bold",color:"#303133"}},tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#fff"},formatter:function(v){return`<div style="color: #fff; font-weight: bold;">${v.name}</div>
                <div style="margin-top: 4px; color: #fff;">
                  <span style="display: inline-block; width: 12px; height: 12px; background-color: ${v.color}; border-radius: 50%; margin-right: 8px;"></span>
                  数量: <span style="font-weight: bold;">${v.value}</span>
                </div>
                <div style="color: #fff; margin-top: 2px;">占比: <span style="font-weight: bold;">${v.percent}%</span></div>`}},legend:{orient:"vertical",left:"left",top:"middle",textStyle:{fontSize:12,fontWeight:"bold"}},series:[{name:"严重程度",type:"pie",radius:["40%","70%"],center:["60%","50%"],data:C,emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.3)"},label:{show:!0,fontSize:14,fontWeight:"bold"}},label:{show:!0,formatter:`{b}
{c} ({d}%)`,fontSize:11,fontWeight:"bold"},labelLine:{show:!0,lineStyle:{width:2}}}]}},w=()=>{const C=_();return{title:{text:"疲劳行为类型分布",left:"center",textStyle:{fontSize:16,fontWeight:"bold",color:"#303133"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",shadowStyle:{color:"rgba(0, 0, 0, 0.1)"}},backgroundColor:"rgba(0, 0, 0, 0.8)",borderColor:"#ccc",borderWidth:1,textStyle:{color:"#fff"},formatter:function(v){const g=v[0];return`<div style="color: #fff; font-weight: bold;">${g.axisValue}</div>
                <div style="margin-top: 4px; color: #fff;">
                  <span style="display: inline-block; width: 12px; height: 12px; background-color: ${g.color}; border-radius: 50%; margin-right: 8px;"></span>
                  行为类型: <span style="font-weight: bold;">${g.value}</span>
                </div>`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"20%",containLabel:!0},xAxis:{type:"category",data:C.labels,axisLabel:{color:"#666",fontSize:11,rotate:45},axisLine:{lineStyle:{color:"#ddd"}}},yAxis:{type:"value",name:"事件数量",nameTextStyle:{color:"#666",fontSize:12},axisLabel:{color:"#666",fontSize:11},axisLine:{lineStyle:{color:"#ddd"}},splitLine:{lineStyle:{color:"#f0f0f0",type:"dashed"}}},series:[{name:"行为类型",type:"bar",data:C.values,itemStyle:{color:"#409EFF",borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:"#337ECC",shadowBlur:10,shadowColor:"#409EFF"}},label:{show:!0,position:"top",formatter:"{c}",fontSize:10,fontWeight:"bold",color:"#409EFF"}}]}},m=()=>{const C=new Array(24).fill(0);return n.data.forEach(v=>{if(v.eventType==="FATIGUE"){const g=new Date(v.timestamp).getHours();C[g]++}}),{labels:Array.from({length:24},(v,g)=>g),values:C}},u=()=>{const C={LOW:0,MEDIUM:0,HIGH:0,CRITICAL:0};n.data.forEach(y=>{y.eventType==="FATIGUE"&&C.hasOwnProperty(y.severity)&&C[y.severity]++});const v={LOW:"#67C23A",MEDIUM:"#E6A23C",HIGH:"#F56C6C",CRITICAL:"#F56C6C"},g={LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"};return Object.entries(C).filter(([y,S])=>S>0).map(([y,S])=>({value:S,name:g[y],itemStyle:{color:v[y]}}))},_=()=>{const C={};n.data.forEach(g=>{g.eventType==="FATIGUE"&&g.behavior&&(C[g.behavior]=(C[g.behavior]||0)+1)});const v={EYE_CLOSURE:"闭眼",YAWNING:"打哈欠",HEAD_NODDING:"点头",DISTRACTED:"分心",SLEEPY:"困倦"};return{labels:Object.keys(C).map(g=>v[g]||g),values:Object.values(C)}},I=C=>{o("type-change",C)};return Re(()=>n.data,()=>{},{deep:!0}),(C,v)=>{const g=T("el-option"),y=T("el-select");return P(),j("div",Qo,[d("div",Zo,[v[1]||(v[1]=d("h3",null,"疲劳行为分析",-1)),a(y,{modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=S=>s.value=S),onChange:I,size:"small"},{default:i(()=>[a(g,{label:"小时分布",value:"hourly"}),a(g,{label:"严重程度",value:"severity"}),a(g,{label:"行为类型",value:"behavior"})]),_:1},8,["modelValue"])]),a(U(hn),{class:"chart",option:r.value,loading:e.loading,autoresize:"","canvas-id":"fatigue-analysis-chart"},null,8,["option","loading"])])}}},ts=Ee(es,[["__scopeId","data-v-365605af"]]);function En(e,t){return function(){return e.apply(t,arguments)}}const{toString:ns}=Object.prototype,{getPrototypeOf:Nt}=Object,{iterator:ut,toStringTag:In}=Symbol,dt=(e=>t=>{const n=ns.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=e=>(e=e.toLowerCase(),t=>dt(t)===e),ft=e=>t=>typeof t===e,{isArray:Ve}=Array,Ye=ft("undefined");function Xe(e){return e!==null&&!Ye(e)&&e.constructor!==null&&!Ye(e.constructor)&&ye(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Cn=Ie("ArrayBuffer");function os(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Cn(e.buffer),t}const ss=ft("string"),ye=ft("function"),Tn=ft("number"),Qe=e=>e!==null&&typeof e=="object",as=e=>e===!0||e===!1,st=e=>{if(dt(e)!=="object")return!1;const t=Nt(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(In in e)&&!(ut in e)},ls=e=>{if(!Qe(e)||Xe(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},rs=Ie("Date"),is=Ie("File"),cs=Ie("Blob"),us=Ie("FileList"),ds=e=>Qe(e)&&ye(e.pipe),fs=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ye(e.append)&&((t=dt(e))==="formdata"||t==="object"&&ye(e.toString)&&e.toString()==="[object FormData]"))},ps=Ie("URLSearchParams"),[ms,vs,hs,gs]=["ReadableStream","Request","Response","Headers"].map(Ie),ys=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ze(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let o,s;if(typeof e!="object"&&(e=[e]),Ve(e))for(o=0,s=e.length;o<s;o++)t.call(null,e[o],o,e);else{if(Xe(e))return;const r=n?Object.getOwnPropertyNames(e):Object.keys(e),l=r.length;let p;for(o=0;o<l;o++)p=r[o],t.call(null,e[p],p,e)}}function kn(e,t){if(Xe(e))return null;t=t.toLowerCase();const n=Object.keys(e);let o=n.length,s;for(;o-- >0;)if(s=n[o],t===s.toLowerCase())return s;return null}const Me=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,An=e=>!Ye(e)&&e!==Me;function Tt(){const{caseless:e}=An(this)&&this||{},t={},n=(o,s)=>{const r=e&&kn(t,s)||s;st(t[r])&&st(o)?t[r]=Tt(t[r],o):st(o)?t[r]=Tt({},o):Ve(o)?t[r]=o.slice():t[r]=o};for(let o=0,s=arguments.length;o<s;o++)arguments[o]&&Ze(arguments[o],n);return t}const _s=(e,t,n,{allOwnKeys:o}={})=>(Ze(t,(s,r)=>{n&&ye(s)?e[r]=En(s,n):e[r]=s},{allOwnKeys:o}),e),ws=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),bs=(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},Ss=(e,t,n,o)=>{let s,r,l;const p={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),r=s.length;r-- >0;)l=s[r],(!o||o(l,e,t))&&!p[l]&&(t[l]=e[l],p[l]=!0);e=n!==!1&&Nt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Es=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return o!==-1&&o===n},Is=e=>{if(!e)return null;if(Ve(e))return e;let t=e.length;if(!Tn(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},Cs=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&Nt(Uint8Array)),Ts=(e,t)=>{const o=(e&&e[ut]).call(e);let s;for(;(s=o.next())&&!s.done;){const r=s.value;t.call(e,r[0],r[1])}},ks=(e,t)=>{let n;const o=[];for(;(n=e.exec(t))!==null;)o.push(n);return o},As=Ie("HTMLFormElement"),xs=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,o,s){return o.toUpperCase()+s}),Kt=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Ds=Ie("RegExp"),xn=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};Ze(n,(s,r)=>{let l;(l=t(s,r,e))!==!1&&(o[r]=l||s)}),Object.defineProperties(e,o)},Os=e=>{xn(e,(t,n)=>{if(ye(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=e[n];if(ye(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Ms=(e,t)=>{const n={},o=s=>{s.forEach(r=>{n[r]=!0})};return Ve(e)?o(e):o(String(e).split(t)),n},Rs=()=>{},Ls=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Ps(e){return!!(e&&ye(e.append)&&e[In]==="FormData"&&e[ut])}const $s=e=>{const t=new Array(10),n=(o,s)=>{if(Qe(o)){if(t.indexOf(o)>=0)return;if(Xe(o))return o;if(!("toJSON"in o)){t[s]=o;const r=Ve(o)?[]:{};return Ze(o,(l,p)=>{const w=n(l,s+1);!Ye(w)&&(r[p]=w)}),t[s]=void 0,r}}return o};return n(e,0)},Ns=Ie("AsyncFunction"),Fs=e=>e&&(Qe(e)||ye(e))&&ye(e.then)&&ye(e.catch),Dn=((e,t)=>e?setImmediate:t?((n,o)=>(Me.addEventListener("message",({source:s,data:r})=>{s===Me&&r===n&&o.length&&o.shift()()},!1),s=>{o.push(s),Me.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",ye(Me.postMessage)),Us=typeof queueMicrotask<"u"?queueMicrotask.bind(Me):typeof process<"u"&&process.nextTick||Dn,zs=e=>e!=null&&ye(e[ut]),h={isArray:Ve,isArrayBuffer:Cn,isBuffer:Xe,isFormData:fs,isArrayBufferView:os,isString:ss,isNumber:Tn,isBoolean:as,isObject:Qe,isPlainObject:st,isEmptyObject:ls,isReadableStream:ms,isRequest:vs,isResponse:hs,isHeaders:gs,isUndefined:Ye,isDate:rs,isFile:is,isBlob:cs,isRegExp:Ds,isFunction:ye,isStream:ds,isURLSearchParams:ps,isTypedArray:Cs,isFileList:us,forEach:Ze,merge:Tt,extend:_s,trim:ys,stripBOM:ws,inherits:bs,toFlatObject:Ss,kindOf:dt,kindOfTest:Ie,endsWith:Es,toArray:Is,forEachEntry:Ts,matchAll:ks,isHTMLForm:As,hasOwnProperty:Kt,hasOwnProp:Kt,reduceDescriptors:xn,freezeMethods:Os,toObjectSet:Ms,toCamelCase:xs,noop:Rs,toFiniteNumber:Ls,findKey:kn,global:Me,isContextDefined:An,isSpecCompliantForm:Ps,toJSONObject:$s,isAsyncFn:Ns,isThenable:Fs,setImmediate:Dn,asap:Us,isIterable:zs};function H(e,t,n,o,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),s&&(this.response=s,this.status=s.status?s.status:null)}h.inherits(H,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:h.toJSONObject(this.config),code:this.code,status:this.status}}});const On=H.prototype,Mn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Mn[e]={value:e}});Object.defineProperties(H,Mn);Object.defineProperty(On,"isAxiosError",{value:!0});H.from=(e,t,n,o,s,r)=>{const l=Object.create(On);return h.toFlatObject(e,l,function(w){return w!==Error.prototype},p=>p!=="isAxiosError"),H.call(l,e.message,t,n,o,s),l.cause=e,l.name=e.name,r&&Object.assign(l,r),l};const Bs=null;function kt(e){return h.isPlainObject(e)||h.isArray(e)}function Rn(e){return h.endsWith(e,"[]")?e.slice(0,-2):e}function Jt(e,t,n){return e?e.concat(t).map(function(s,r){return s=Rn(s),!n&&r?"["+s+"]":s}).join(n?".":""):t}function Hs(e){return h.isArray(e)&&!e.some(kt)}const Vs=h.toFlatObject(h,{},null,function(t){return/^is[A-Z]/.test(t)});function pt(e,t,n){if(!h.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=h.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,y){return!h.isUndefined(y[g])});const o=n.metaTokens,s=n.visitor||u,r=n.dots,l=n.indexes,w=(n.Blob||typeof Blob<"u"&&Blob)&&h.isSpecCompliantForm(t);if(!h.isFunction(s))throw new TypeError("visitor must be a function");function m(v){if(v===null)return"";if(h.isDate(v))return v.toISOString();if(h.isBoolean(v))return v.toString();if(!w&&h.isBlob(v))throw new H("Blob is not supported. Use a Buffer instead.");return h.isArrayBuffer(v)||h.isTypedArray(v)?w&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function u(v,g,y){let S=v;if(v&&!y&&typeof v=="object"){if(h.endsWith(g,"{}"))g=o?g:g.slice(0,-2),v=JSON.stringify(v);else if(h.isArray(v)&&Hs(v)||(h.isFileList(v)||h.endsWith(g,"[]"))&&(S=h.toArray(v)))return g=Rn(g),S.forEach(function(O,z){!(h.isUndefined(O)||O===null)&&t.append(l===!0?Jt([g],z,r):l===null?g:g+"[]",m(O))}),!1}return kt(v)?!0:(t.append(Jt(y,g,r),m(v)),!1)}const _=[],I=Object.assign(Vs,{defaultVisitor:u,convertValue:m,isVisitable:kt});function C(v,g){if(!h.isUndefined(v)){if(_.indexOf(v)!==-1)throw Error("Circular reference detected in "+g.join("."));_.push(v),h.forEach(v,function(S,D){(!(h.isUndefined(S)||S===null)&&s.call(t,S,h.isString(D)?D.trim():D,g,I))===!0&&C(S,g?g.concat(D):[D])}),_.pop()}}if(!h.isObject(e))throw new TypeError("data must be an object");return C(e),t}function Yt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function Ft(e,t){this._pairs=[],e&&pt(e,this,t)}const Ln=Ft.prototype;Ln.append=function(t,n){this._pairs.push([t,n])};Ln.toString=function(t){const n=t?function(o){return t.call(this,o,Yt)}:Yt;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function js(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Pn(e,t,n){if(!t)return e;const o=n&&n.encode||js;h.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let r;if(s?r=s(t,n):r=h.isURLSearchParams(t)?t.toString():new Ft(t,n).toString(o),r){const l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+r}return e}class Xt{constructor(){this.handlers=[]}use(t,n,o){return this.handlers.push({fulfilled:t,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){h.forEach(this.handlers,function(o){o!==null&&t(o)})}}const $n={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ws=typeof URLSearchParams<"u"?URLSearchParams:Ft,qs=typeof FormData<"u"?FormData:null,Gs=typeof Blob<"u"?Blob:null,Ks={isBrowser:!0,classes:{URLSearchParams:Ws,FormData:qs,Blob:Gs},protocols:["http","https","file","blob","url","data"]},Ut=typeof window<"u"&&typeof document<"u",At=typeof navigator=="object"&&navigator||void 0,Js=Ut&&(!At||["ReactNative","NativeScript","NS"].indexOf(At.product)<0),Ys=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Xs=Ut&&window.location.href||"http://localhost",Qs=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ut,hasStandardBrowserEnv:Js,hasStandardBrowserWebWorkerEnv:Ys,navigator:At,origin:Xs},Symbol.toStringTag,{value:"Module"})),pe={...Qs,...Ks};function Zs(e,t){return pt(e,new pe.classes.URLSearchParams,{visitor:function(n,o,s,r){return pe.isNode&&h.isBuffer(n)?(this.append(o,n.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}function ea(e){return h.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ta(e){const t={},n=Object.keys(e);let o;const s=n.length;let r;for(o=0;o<s;o++)r=n[o],t[r]=e[r];return t}function Nn(e){function t(n,o,s,r){let l=n[r++];if(l==="__proto__")return!0;const p=Number.isFinite(+l),w=r>=n.length;return l=!l&&h.isArray(s)?s.length:l,w?(h.hasOwnProp(s,l)?s[l]=[s[l],o]:s[l]=o,!p):((!s[l]||!h.isObject(s[l]))&&(s[l]=[]),t(n,o,s[l],r)&&h.isArray(s[l])&&(s[l]=ta(s[l])),!p)}if(h.isFormData(e)&&h.isFunction(e.entries)){const n={};return h.forEachEntry(e,(o,s)=>{t(ea(o),s,n,0)}),n}return null}function na(e,t,n){if(h.isString(e))try{return(t||JSON.parse)(e),h.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(e)}const et={transitional:$n,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const o=n.getContentType()||"",s=o.indexOf("application/json")>-1,r=h.isObject(t);if(r&&h.isHTMLForm(t)&&(t=new FormData(t)),h.isFormData(t))return s?JSON.stringify(Nn(t)):t;if(h.isArrayBuffer(t)||h.isBuffer(t)||h.isStream(t)||h.isFile(t)||h.isBlob(t)||h.isReadableStream(t))return t;if(h.isArrayBufferView(t))return t.buffer;if(h.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let p;if(r){if(o.indexOf("application/x-www-form-urlencoded")>-1)return Zs(t,this.formSerializer).toString();if((p=h.isFileList(t))||o.indexOf("multipart/form-data")>-1){const w=this.env&&this.env.FormData;return pt(p?{"files[]":t}:t,w&&new w,this.formSerializer)}}return r||s?(n.setContentType("application/json",!1),na(t)):t}],transformResponse:[function(t){const n=this.transitional||et.transitional,o=n&&n.forcedJSONParsing,s=this.responseType==="json";if(h.isResponse(t)||h.isReadableStream(t))return t;if(t&&h.isString(t)&&(o&&!this.responseType||s)){const l=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(t)}catch(p){if(l)throw p.name==="SyntaxError"?H.from(p,H.ERR_BAD_RESPONSE,this,null,this.response):p}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:pe.classes.FormData,Blob:pe.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};h.forEach(["delete","get","head","post","put","patch"],e=>{et.headers[e]={}});const oa=h.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),sa=e=>{const t={};let n,o,s;return e&&e.split(`
`).forEach(function(l){s=l.indexOf(":"),n=l.substring(0,s).trim().toLowerCase(),o=l.substring(s+1).trim(),!(!n||t[n]&&oa[n])&&(n==="set-cookie"?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)}),t},Qt=Symbol("internals");function Ke(e){return e&&String(e).trim().toLowerCase()}function at(e){return e===!1||e==null?e:h.isArray(e)?e.map(at):String(e)}function aa(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(e);)t[o[1]]=o[2];return t}const la=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function _t(e,t,n,o,s){if(h.isFunction(o))return o.call(this,t,n);if(s&&(t=n),!!h.isString(t)){if(h.isString(o))return t.indexOf(o)!==-1;if(h.isRegExp(o))return o.test(t)}}function ra(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,o)=>n.toUpperCase()+o)}function ia(e,t){const n=h.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+n,{value:function(s,r,l){return this[o].call(this,t,s,r,l)},configurable:!0})})}let _e=class{constructor(t){t&&this.set(t)}set(t,n,o){const s=this;function r(p,w,m){const u=Ke(w);if(!u)throw new Error("header name must be a non-empty string");const _=h.findKey(s,u);(!_||s[_]===void 0||m===!0||m===void 0&&s[_]!==!1)&&(s[_||w]=at(p))}const l=(p,w)=>h.forEach(p,(m,u)=>r(m,u,w));if(h.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(h.isString(t)&&(t=t.trim())&&!la(t))l(sa(t),n);else if(h.isObject(t)&&h.isIterable(t)){let p={},w,m;for(const u of t){if(!h.isArray(u))throw TypeError("Object iterator must return a key-value pair");p[m=u[0]]=(w=p[m])?h.isArray(w)?[...w,u[1]]:[w,u[1]]:u[1]}l(p,n)}else t!=null&&r(n,t,o);return this}get(t,n){if(t=Ke(t),t){const o=h.findKey(this,t);if(o){const s=this[o];if(!n)return s;if(n===!0)return aa(s);if(h.isFunction(n))return n.call(this,s,o);if(h.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Ke(t),t){const o=h.findKey(this,t);return!!(o&&this[o]!==void 0&&(!n||_t(this,this[o],o,n)))}return!1}delete(t,n){const o=this;let s=!1;function r(l){if(l=Ke(l),l){const p=h.findKey(o,l);p&&(!n||_t(o,o[p],p,n))&&(delete o[p],s=!0)}}return h.isArray(t)?t.forEach(r):r(t),s}clear(t){const n=Object.keys(this);let o=n.length,s=!1;for(;o--;){const r=n[o];(!t||_t(this,this[r],r,t,!0))&&(delete this[r],s=!0)}return s}normalize(t){const n=this,o={};return h.forEach(this,(s,r)=>{const l=h.findKey(o,r);if(l){n[l]=at(s),delete n[r];return}const p=t?ra(r):String(r).trim();p!==r&&delete n[r],n[p]=at(s),o[p]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return h.forEach(this,(o,s)=>{o!=null&&o!==!1&&(n[s]=t&&h.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const o=new this(t);return n.forEach(s=>o.set(s)),o}static accessor(t){const o=(this[Qt]=this[Qt]={accessors:{}}).accessors,s=this.prototype;function r(l){const p=Ke(l);o[p]||(ia(s,l),o[p]=!0)}return h.isArray(t)?t.forEach(r):r(t),this}};_e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);h.reduceDescriptors(_e.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(o){this[n]=o}}});h.freezeMethods(_e);function wt(e,t){const n=this||et,o=t||n,s=_e.from(o.headers);let r=o.data;return h.forEach(e,function(p){r=p.call(n,r,s.normalize(),t?t.status:void 0)}),s.normalize(),r}function Fn(e){return!!(e&&e.__CANCEL__)}function je(e,t,n){H.call(this,e??"canceled",H.ERR_CANCELED,t,n),this.name="CanceledError"}h.inherits(je,H,{__CANCEL__:!0});function Un(e,t,n){const o=n.config.validateStatus;!n.status||!o||o(n.status)?e(n):t(new H("Request failed with status code "+n.status,[H.ERR_BAD_REQUEST,H.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function ca(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function ua(e,t){e=e||10;const n=new Array(e),o=new Array(e);let s=0,r=0,l;return t=t!==void 0?t:1e3,function(w){const m=Date.now(),u=o[r];l||(l=m),n[s]=w,o[s]=m;let _=r,I=0;for(;_!==s;)I+=n[_++],_=_%e;if(s=(s+1)%e,s===r&&(r=(r+1)%e),m-l<t)return;const C=u&&m-u;return C?Math.round(I*1e3/C):void 0}}function da(e,t){let n=0,o=1e3/t,s,r;const l=(m,u=Date.now())=>{n=u,s=null,r&&(clearTimeout(r),r=null),e(...m)};return[(...m)=>{const u=Date.now(),_=u-n;_>=o?l(m,u):(s=m,r||(r=setTimeout(()=>{r=null,l(s)},o-_)))},()=>s&&l(s)]}const it=(e,t,n=3)=>{let o=0;const s=ua(50,250);return da(r=>{const l=r.loaded,p=r.lengthComputable?r.total:void 0,w=l-o,m=s(w),u=l<=p;o=l;const _={loaded:l,total:p,progress:p?l/p:void 0,bytes:w,rate:m||void 0,estimated:m&&p&&u?(p-l)/m:void 0,event:r,lengthComputable:p!=null,[t?"download":"upload"]:!0};e(_)},n)},Zt=(e,t)=>{const n=e!=null;return[o=>t[0]({lengthComputable:n,total:e,loaded:o}),t[1]]},en=e=>(...t)=>h.asap(()=>e(...t)),fa=pe.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,pe.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(pe.origin),pe.navigator&&/(msie|trident)/i.test(pe.navigator.userAgent)):()=>!0,pa=pe.hasStandardBrowserEnv?{write(e,t,n,o,s,r){const l=[e+"="+encodeURIComponent(t)];h.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),h.isString(o)&&l.push("path="+o),h.isString(s)&&l.push("domain="+s),r===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ma(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function va(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function zn(e,t,n){let o=!ma(t);return e&&(o||n==!1)?va(e,t):t}const tn=e=>e instanceof _e?{...e}:e;function Ne(e,t){t=t||{};const n={};function o(m,u,_,I){return h.isPlainObject(m)&&h.isPlainObject(u)?h.merge.call({caseless:I},m,u):h.isPlainObject(u)?h.merge({},u):h.isArray(u)?u.slice():u}function s(m,u,_,I){if(h.isUndefined(u)){if(!h.isUndefined(m))return o(void 0,m,_,I)}else return o(m,u,_,I)}function r(m,u){if(!h.isUndefined(u))return o(void 0,u)}function l(m,u){if(h.isUndefined(u)){if(!h.isUndefined(m))return o(void 0,m)}else return o(void 0,u)}function p(m,u,_){if(_ in t)return o(m,u);if(_ in e)return o(void 0,m)}const w={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:p,headers:(m,u,_)=>s(tn(m),tn(u),_,!0)};return h.forEach(Object.keys({...e,...t}),function(u){const _=w[u]||s,I=_(e[u],t[u],u);h.isUndefined(I)&&_!==p||(n[u]=I)}),n}const Bn=e=>{const t=Ne({},e);let{data:n,withXSRFToken:o,xsrfHeaderName:s,xsrfCookieName:r,headers:l,auth:p}=t;t.headers=l=_e.from(l),t.url=Pn(zn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),p&&l.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):"")));let w;if(h.isFormData(n)){if(pe.hasStandardBrowserEnv||pe.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((w=l.getContentType())!==!1){const[m,...u]=w?w.split(";").map(_=>_.trim()).filter(Boolean):[];l.setContentType([m||"multipart/form-data",...u].join("; "))}}if(pe.hasStandardBrowserEnv&&(o&&h.isFunction(o)&&(o=o(t)),o||o!==!1&&fa(t.url))){const m=s&&r&&pa.read(r);m&&l.set(s,m)}return t},ha=typeof XMLHttpRequest<"u",ga=ha&&function(e){return new Promise(function(n,o){const s=Bn(e);let r=s.data;const l=_e.from(s.headers).normalize();let{responseType:p,onUploadProgress:w,onDownloadProgress:m}=s,u,_,I,C,v;function g(){C&&C(),v&&v(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let y=new XMLHttpRequest;y.open(s.method.toUpperCase(),s.url,!0),y.timeout=s.timeout;function S(){if(!y)return;const O=_e.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),V={data:!p||p==="text"||p==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:O,config:e,request:y};Un(function(Y){n(Y),g()},function(Y){o(Y),g()},V),y=null}"onloadend"in y?y.onloadend=S:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(S)},y.onabort=function(){y&&(o(new H("Request aborted",H.ECONNABORTED,e,y)),y=null)},y.onerror=function(){o(new H("Network Error",H.ERR_NETWORK,e,y)),y=null},y.ontimeout=function(){let z=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const V=s.transitional||$n;s.timeoutErrorMessage&&(z=s.timeoutErrorMessage),o(new H(z,V.clarifyTimeoutError?H.ETIMEDOUT:H.ECONNABORTED,e,y)),y=null},r===void 0&&l.setContentType(null),"setRequestHeader"in y&&h.forEach(l.toJSON(),function(z,V){y.setRequestHeader(V,z)}),h.isUndefined(s.withCredentials)||(y.withCredentials=!!s.withCredentials),p&&p!=="json"&&(y.responseType=s.responseType),m&&([I,v]=it(m,!0),y.addEventListener("progress",I)),w&&y.upload&&([_,C]=it(w),y.upload.addEventListener("progress",_),y.upload.addEventListener("loadend",C)),(s.cancelToken||s.signal)&&(u=O=>{y&&(o(!O||O.type?new je(null,e,y):O),y.abort(),y=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const D=ca(s.url);if(D&&pe.protocols.indexOf(D)===-1){o(new H("Unsupported protocol "+D+":",H.ERR_BAD_REQUEST,e));return}y.send(r||null)})},ya=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let o=new AbortController,s;const r=function(m){if(!s){s=!0,p();const u=m instanceof Error?m:this.reason;o.abort(u instanceof H?u:new je(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,r(new H(`timeout ${t} of ms exceeded`,H.ETIMEDOUT))},t);const p=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(m=>{m.unsubscribe?m.unsubscribe(r):m.removeEventListener("abort",r)}),e=null)};e.forEach(m=>m.addEventListener("abort",r));const{signal:w}=o;return w.unsubscribe=()=>h.asap(p),w}},_a=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let o=0,s;for(;o<n;)s=o+t,yield e.slice(o,s),o=s},wa=async function*(e,t){for await(const n of ba(e))yield*_a(n,t)},ba=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:o}=await t.read();if(n)break;yield o}}finally{await t.cancel()}},nn=(e,t,n,o)=>{const s=wa(e,t);let r=0,l,p=w=>{l||(l=!0,o&&o(w))};return new ReadableStream({async pull(w){try{const{done:m,value:u}=await s.next();if(m){p(),w.close();return}let _=u.byteLength;if(n){let I=r+=_;n(I)}w.enqueue(new Uint8Array(u))}catch(m){throw p(m),m}},cancel(w){return p(w),s.return()}},{highWaterMark:2})},mt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Hn=mt&&typeof ReadableStream=="function",Sa=mt&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),Vn=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Ea=Hn&&Vn(()=>{let e=!1;const t=new Request(pe.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),on=64*1024,xt=Hn&&Vn(()=>h.isReadableStream(new Response("").body)),ct={stream:xt&&(e=>e.body)};mt&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!ct[t]&&(ct[t]=h.isFunction(e[t])?n=>n[t]():(n,o)=>{throw new H(`Response type '${t}' is not supported`,H.ERR_NOT_SUPPORT,o)})})})(new Response);const Ia=async e=>{if(e==null)return 0;if(h.isBlob(e))return e.size;if(h.isSpecCompliantForm(e))return(await new Request(pe.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(h.isArrayBufferView(e)||h.isArrayBuffer(e))return e.byteLength;if(h.isURLSearchParams(e)&&(e=e+""),h.isString(e))return(await Sa(e)).byteLength},Ca=async(e,t)=>{const n=h.toFiniteNumber(e.getContentLength());return n??Ia(t)},Ta=mt&&(async e=>{let{url:t,method:n,data:o,signal:s,cancelToken:r,timeout:l,onDownloadProgress:p,onUploadProgress:w,responseType:m,headers:u,withCredentials:_="same-origin",fetchOptions:I}=Bn(e);m=m?(m+"").toLowerCase():"text";let C=ya([s,r&&r.toAbortSignal()],l),v;const g=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let y;try{if(w&&Ea&&n!=="get"&&n!=="head"&&(y=await Ca(u,o))!==0){let V=new Request(t,{method:"POST",body:o,duplex:"half"}),q;if(h.isFormData(o)&&(q=V.headers.get("content-type"))&&u.setContentType(q),V.body){const[Y,ne]=Zt(y,it(en(w)));o=nn(V.body,on,Y,ne)}}h.isString(_)||(_=_?"include":"omit");const S="credentials"in Request.prototype;v=new Request(t,{...I,signal:C,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:o,duplex:"half",credentials:S?_:void 0});let D=await fetch(v,I);const O=xt&&(m==="stream"||m==="response");if(xt&&(p||O&&g)){const V={};["status","statusText","headers"].forEach(ee=>{V[ee]=D[ee]});const q=h.toFiniteNumber(D.headers.get("content-length")),[Y,ne]=p&&Zt(q,it(en(p),!0))||[];D=new Response(nn(D.body,on,Y,()=>{ne&&ne(),g&&g()}),V)}m=m||"text";let z=await ct[h.findKey(ct,m)||"text"](D,e);return!O&&g&&g(),await new Promise((V,q)=>{Un(V,q,{data:z,headers:_e.from(D.headers),status:D.status,statusText:D.statusText,config:e,request:v})})}catch(S){throw g&&g(),S&&S.name==="TypeError"&&/Load failed|fetch/i.test(S.message)?Object.assign(new H("Network Error",H.ERR_NETWORK,e,v),{cause:S.cause||S}):H.from(S,S&&S.code,e,v)}}),Dt={http:Bs,xhr:ga,fetch:Ta};h.forEach(Dt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const sn=e=>`- ${e}`,ka=e=>h.isFunction(e)||e===null||e===!1,jn={getAdapter:e=>{e=h.isArray(e)?e:[e];const{length:t}=e;let n,o;const s={};for(let r=0;r<t;r++){n=e[r];let l;if(o=n,!ka(n)&&(o=Dt[(l=String(n)).toLowerCase()],o===void 0))throw new H(`Unknown adapter '${l}'`);if(o)break;s[l||"#"+r]=o}if(!o){const r=Object.entries(s).map(([p,w])=>`adapter ${p} `+(w===!1?"is not supported by the environment":"is not available in the build"));let l=t?r.length>1?`since :
`+r.map(sn).join(`
`):" "+sn(r[0]):"as no adapter specified";throw new H("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return o},adapters:Dt};function bt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new je(null,e)}function an(e){return bt(e),e.headers=_e.from(e.headers),e.data=wt.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),jn.getAdapter(e.adapter||et.adapter)(e).then(function(o){return bt(e),o.data=wt.call(e,e.transformResponse,o),o.headers=_e.from(o.headers),o},function(o){return Fn(o)||(bt(e),o&&o.response&&(o.response.data=wt.call(e,e.transformResponse,o.response),o.response.headers=_e.from(o.response.headers))),Promise.reject(o)})}const Wn="1.11.0",vt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{vt[e]=function(o){return typeof o===e||"a"+(t<1?"n ":" ")+e}});const ln={};vt.transitional=function(t,n,o){function s(r,l){return"[Axios v"+Wn+"] Transitional option '"+r+"'"+l+(o?". "+o:"")}return(r,l,p)=>{if(t===!1)throw new H(s(l," has been removed"+(n?" in "+n:"")),H.ERR_DEPRECATED);return n&&!ln[l]&&(ln[l]=!0,console.warn(s(l," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(r,l,p):!0}};vt.spelling=function(t){return(n,o)=>(console.warn(`${o} is likely a misspelling of ${t}`),!0)};function Aa(e,t,n){if(typeof e!="object")throw new H("options must be an object",H.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let s=o.length;for(;s-- >0;){const r=o[s],l=t[r];if(l){const p=e[r],w=p===void 0||l(p,r,e);if(w!==!0)throw new H("option "+r+" must be "+w,H.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new H("Unknown option "+r,H.ERR_BAD_OPTION)}}const lt={assertOptions:Aa,validators:vt},Te=lt.validators;let $e=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Xt,response:new Xt}}async request(t,n){try{return await this._request(t,n)}catch(o){if(o instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const r=s.stack?s.stack.replace(/^.+\n/,""):"";try{o.stack?r&&!String(o.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+r):o.stack=r}catch{}}throw o}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=Ne(this.defaults,n);const{transitional:o,paramsSerializer:s,headers:r}=n;o!==void 0&&lt.assertOptions(o,{silentJSONParsing:Te.transitional(Te.boolean),forcedJSONParsing:Te.transitional(Te.boolean),clarifyTimeoutError:Te.transitional(Te.boolean)},!1),s!=null&&(h.isFunction(s)?n.paramsSerializer={serialize:s}:lt.assertOptions(s,{encode:Te.function,serialize:Te.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),lt.assertOptions(n,{baseUrl:Te.spelling("baseURL"),withXsrfToken:Te.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=r&&h.merge(r.common,r[n.method]);r&&h.forEach(["delete","get","head","post","put","patch","common"],v=>{delete r[v]}),n.headers=_e.concat(l,r);const p=[];let w=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(n)===!1||(w=w&&g.synchronous,p.unshift(g.fulfilled,g.rejected))});const m=[];this.interceptors.response.forEach(function(g){m.push(g.fulfilled,g.rejected)});let u,_=0,I;if(!w){const v=[an.bind(this),void 0];for(v.unshift(...p),v.push(...m),I=v.length,u=Promise.resolve(n);_<I;)u=u.then(v[_++],v[_++]);return u}I=p.length;let C=n;for(_=0;_<I;){const v=p[_++],g=p[_++];try{C=v(C)}catch(y){g.call(this,y);break}}try{u=an.call(this,C)}catch(v){return Promise.reject(v)}for(_=0,I=m.length;_<I;)u=u.then(m[_++],m[_++]);return u}getUri(t){t=Ne(this.defaults,t);const n=zn(t.baseURL,t.url,t.allowAbsoluteUrls);return Pn(n,t.params,t.paramsSerializer)}};h.forEach(["delete","get","head","options"],function(t){$e.prototype[t]=function(n,o){return this.request(Ne(o||{},{method:t,url:n,data:(o||{}).data}))}});h.forEach(["post","put","patch"],function(t){function n(o){return function(r,l,p){return this.request(Ne(p||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}$e.prototype[t]=n(),$e.prototype[t+"Form"]=n(!0)});let xa=class qn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(r){n=r});const o=this;this.promise.then(s=>{if(!o._listeners)return;let r=o._listeners.length;for(;r-- >0;)o._listeners[r](s);o._listeners=null}),this.promise.then=s=>{let r;const l=new Promise(p=>{o.subscribe(p),r=p}).then(s);return l.cancel=function(){o.unsubscribe(r)},l},t(function(r,l,p){o.reason||(o.reason=new je(r,l,p),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=o=>{t.abort(o)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new qn(function(s){t=s}),cancel:t}}};function Da(e){return function(n){return e.apply(null,n)}}function Oa(e){return h.isObject(e)&&e.isAxiosError===!0}const Ot={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ot).forEach(([e,t])=>{Ot[t]=e});function Gn(e){const t=new $e(e),n=En($e.prototype.request,t);return h.extend(n,$e.prototype,t,{allOwnKeys:!0}),h.extend(n,t,null,{allOwnKeys:!0}),n.create=function(s){return Gn(Ne(e,s))},n}const ae=Gn(et);ae.Axios=$e;ae.CanceledError=je;ae.CancelToken=xa;ae.isCancel=Fn;ae.VERSION=Wn;ae.toFormData=pt;ae.AxiosError=H;ae.Cancel=ae.CanceledError;ae.all=function(t){return Promise.all(t)};ae.spread=Da;ae.isAxiosError=Oa;ae.mergeConfig=Ne;ae.AxiosHeaders=_e;ae.formToJSON=e=>Nn(h.isHTMLForm(e)?new FormData(e):e);ae.getAdapter=jn.getAdapter;ae.HttpStatusCode=Ot;ae.default=ae;const{Axios:Vr,AxiosError:jr,CanceledError:Wr,isCancel:qr,CancelToken:Gr,VERSION:Kr,all:Jr,Cancel:Yr,isAxiosError:Xr,spread:Qr,toFormData:Zr,AxiosHeaders:ei,HttpStatusCode:ti,formToJSON:ni,getAdapter:oi,mergeConfig:si}=ae,Se=ae.create({baseURL:"http://spacemit.topcoder.fun",timeout:1e4,headers:{"Content-Type":"application/json"}});Se.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),console.log("API请求:",e.method?.toUpperCase(),e.url),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e)));Se.interceptors.response.use(e=>{const{data:t}=e;if(t.code!==void 0)if(t.code===200||t.code===0){console.log("=== API响应拦截器 ==="),console.log("原始响应:",t),console.log("data.data:",t.data),console.log("data.data.events:",t.data?.events),console.log("data.data.events长度:",t.data?.events?.length);const n=t.data||t;return console.log("最终返回数据:",n),console.log("最终返回的events:",n.events),console.log("最终返回的events长度:",n.events?.length),n}else return he.error(t.message||"请求失败"),Promise.reject(new Error(t.message||"请求失败"));return t},e=>{console.error("API响应错误:",e);let t="网络错误";if(e.response){const{status:n,data:o}=e.response;switch(n){case 401:t="未授权，请重新登录",localStorage.removeItem("auth_token");break;case 403:t="拒绝访问";break;case 404:t="请求的资源不存在";break;case 500:t="服务器内部错误";break;default:t=o?.message||`请求失败 (${n})`}}else e.code==="ECONNABORTED"?t="请求超时":e.message&&(t=e.message);return he.error(t),Promise.reject(e)});const Je={getDevices(e={}){return console.log("=== API调用: 获取设备列表 ==="),console.log("请求参数:",e),Se.get("/api/v1/platform/devices",{params:e})},getDeviceDetail(e){return Se.get(`/api/v1/platform/devices/${e}`)},getDeviceTrack(e,t={}){return Se.get(`/api/v1/platform/devices/${e}/track`,{params:t})},getRealtimeStream(){return Se.get("/api/v1/platform/realtime/stream")},updateDevice(e,t){return console.log("=== API调用: 更新设备信息 ==="),console.log("设备ID:",e),console.log("更新数据:",t),Se.put(`/api/v1/platform/devices/${e}`,t)}},zt=Mt("device",()=>{const e=R([]),t=R(null),n=R([]),o=R(!1),s=R(null),r=J(()=>e.value.filter(S=>S.status==="ONLINE")),l=J(()=>e.value.filter(S=>S.status==="OFFLINE")),p=J(()=>({total:e.value.length,online:r.value.length,offline:l.value.length})),w=async(S={})=>{o.value=!0,s.value=null,console.log("=== 设备Store: 开始获取设备列表 ==="),console.log("参数:",S);try{const D=await Je.getDevices(S);return console.log("设备API响应:",D),console.log("响应中的设备数组:",D.devices),console.log("设备数组长度:",D.devices?.length),D.devices&&D.devices.length>0?(e.value=D.devices,console.log("设置设备列表:",e.value.length,"个设备"),console.log("最终设备列表:",e.value),console.log("第一个设备的用户名:",e.value[0]?.username),console.log("第一个设备的设备ID:",e.value[0]?.deviceId)):(console.log("API返回的设备数组为空，使用空数组"),e.value=[]),e.value.length===0&&(console.log("⚠️ 警告：使用模拟数据！"),e.value=[{deviceId:"MUSE_PI_PRO_001",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:85,lastSeen:new Date().toISOString(),username:"张三",phone:"13800138001",location:{lat:33.553733,lng:119.030953,speed:60,direction:45,altitude:10,hdop:1.2,satellites:8}},{deviceId:"MUSE_PI_PRO_002",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:92,lastSeen:new Date(Date.now()-300*1e3).toISOString(),username:"李四",phone:"13800138002",location:{lat:33.563733,lng:119.040953,speed:45,direction:90,altitude:15,hdop:.8,satellites:10}},{deviceId:"MUSE_PI_PRO_003",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"OFFLINE",healthScore:78,lastSeen:new Date(Date.now()-1800*1e3).toISOString(),username:"王五",phone:"13800138003",location:{lat:33.543733,lng:119.020953,speed:0,direction:0,altitude:8,hdop:2.1,satellites:6}}]),D}catch(D){console.error("获取设备列表失败:",D),s.value=D.message,console.log("API调用失败，使用模拟数据"),e.value=[{deviceId:"MUSE_PI_PRO_001",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:85,lastSeen:new Date().toISOString(),username:"张三",phone:"13800138001",location:{lat:33.553733,lng:119.030953,speed:60,direction:45,altitude:10,hdop:1.2,satellites:8}},{deviceId:"MUSE_PI_PRO_002",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:92,lastSeen:new Date(Date.now()-300*1e3).toISOString(),username:"李四",phone:"13800138002",location:{lat:33.563733,lng:119.040953,speed:45,direction:90,altitude:15,hdop:.8,satellites:10}},{deviceId:"MUSE_PI_PRO_003",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"OFFLINE",healthScore:78,lastSeen:new Date(Date.now()-1800*1e3).toISOString(),username:"王五",phone:"13800138003",location:{lat:33.543733,lng:119.020953,speed:0,direction:0,altitude:8,hdop:2.1,satellites:6}}]}finally{o.value=!1}},m=async S=>{o.value=!0,s.value=null;try{const D=await Je.getDeviceDetail(S);return t.value=D,D}catch(D){throw s.value=D.message,D}finally{o.value=!1}},u=async(S,D={})=>{try{return await Je.getDeviceTrack(S,D)}catch(O){return s.value=O.message,{track:_(S,D)}}},_=(S,D)=>{const O=[],z=new Date(D.startTime||Date.now()-864e5),V=new Date(D.endTime||Date.now());let q=33.553733,Y=119.030953;const ne=Math.ceil((V-z)/(1e3*60*60));for(let ee=0;ee<ne;ee++){const ue=new Date(z.getTime()+ee*60*60*1e3),me=q+(Math.random()-.5)*.01,de=Y+(Math.random()-.5)*.01;O.push({timestamp:ue.toISOString(),lat:me,lng:de,speed:Math.random()*80+20,direction:Math.random()*360,altitude:Math.random()*20+5,hdop:Math.random()*2+.5,satellites:Math.floor(Math.random()*5)+6})}return O};return{devices:e,currentDevice:t,realtimeDevices:n,loading:o,error:s,onlineDevices:r,offlineDevices:l,deviceCount:p,fetchDevices:w,fetchDeviceDetail:m,fetchDeviceTrack:u,fetchRealtimeStream:async()=>{try{const S=await Je.getRealtimeStream();return n.value=S.devices||[],S}catch(S){throw s.value=S.message,S}},updateDeviceStatus:(S,D)=>{const O=e.value.find(z=>z.deviceId===S);O&&(O.status=D,O.lastSeen=new Date().toISOString())},updateDeviceLocation:(S,D)=>{const O=e.value.find(z=>z.deviceId===S);O&&(O.location=D)},updateDevice:async(S,D)=>{o.value=!0,s.value=null,console.log("=== 设备Store: 开始更新设备信息 ==="),console.log("设备ID:",S),console.log("更新数据:",D);try{const O=await Je.updateDevice(S,D);console.log("更新设备API响应:",O);const z=e.value.find(V=>V.deviceId===S);return z&&Object.assign(z,D),O}catch(O){throw console.error("更新设备失败:",O),s.value=O.message,O}finally{o.value=!1}},clearError:()=>{s.value=null}}}),Ma={getOverview(){return Se.get("/api/v1/platform/overview")}},Ra=Mt("overview",()=>{const e=R(null),t=R(!1),n=R(null);return{overview:e,loading:t,error:n,fetchOverview:async()=>{t.value=!0,n.value=null;try{const r=await Ma.getOverview();return e.value=r,r}catch(r){throw n.value=r.message,r}finally{t.value=!1}},clearError:()=>{n.value=null}}}),La={class:"dashboard"},Pa={class:"admin-toggle"},$a={class:"status-indicator"},Na={class:"indicator-header"},Fa={class:"status-info"},Ua={class:"status-item"},za={class:"status-item"},Ba={class:"update-time"},Ha={class:"status-indicator"},Va={class:"indicator-header"},ja={class:"event-stream"},Wa={class:"stream-info"},qa={class:"stream-item"},Ga={class:"event-count"},Ka={class:"stream-item"},Ja={class:"processing-speed"},Ya={class:"indicator-header"},Xa={key:0,class:"alert-badge"},Qa={class:"alert-info"},Za={class:"alert-item"},el={class:"alert-item"},tl={class:"response-time"},nl={class:"card-header"},ol={class:"header-actions"},sl={class:"map-stats"},al={class:"card-header"},ll={class:"alert-header-badge"},rl={key:0,class:"critical-indicator"},il={class:"alert-list"},cl=["onClick"],ul={class:"alert-icon"},dl={class:"alert-content"},fl={class:"alert-title"},pl={class:"alert-meta"},ml={class:"alert-device"},vl={class:"alert-time"},hl={class:"alert-severity"},gl={key:0,class:"no-alerts"},yl={class:"card-header"},_l={class:"header-actions"},wl={key:0},bl={key:1,class:"text-muted"},Sl={class:"card-header"},El={class:"device-status-grid"},Il=["onClick"],Cl={class:"device-info"},Tl={class:"device-id"},kl={class:"device-user"},Al={class:"device-status"},xl={class:"device-time"},Dl={__name:"Dashboard",setup(e){const t=Rt(),n=zt(),o=Ra(),s=R({}),r=R([]),l=R(""),p=R(""),w=R(!1),m=R(!1),u=R(!1),_=R([]),I=R([]),C=R(!1),v=R("刚刚"),g=R(0),y=R(150),S=R(0),D=R(2.5),O=R({apiKey:"",securityKey:"",version:"1.4.15"}),z=R(null),V=J(()=>{console.log("计算filteredDevices，当前设备数量:",n.devices.length),console.log("设备列表:",n.devices),console.log("搜索关键词:",l.value),console.log("地图状态筛选:",p.value);let k=n.devices;if(l.value){const b=l.value.toLowerCase();k=k.filter(K=>K.deviceId.toLowerCase().includes(b)||K.username&&K.username.toLowerCase().includes(b))}return p.value&&(k=k.filter(b=>b.status===p.value)),console.log("过滤后设备数量:",k.length),k}),q=J(()=>C.value&&s.value.deviceStatus?.online>0?"healthy":C.value?"warning":"error"),Y=J(()=>n.devices.filter(k=>k.status==="ONLINE").length),ne=J(()=>n.devices.filter(k=>k.status==="OFFLINE"||k.status==="LOST").length),ee=async()=>{try{console.log("=== 开始并行加载数据 ==="),u.value=!0,await Promise.all([ue(),me(),de(),ge(),f()]),console.log("=== 数据加载完成 ===")}catch(k){console.error("加载数据失败:",k),he.error("加载数据失败")}finally{u.value=!1}},ue=async()=>{try{const k=await o.fetchOverview();s.value=k}catch(k){console.error("加载概览数据失败:",k)}},me=async()=>{try{console.log("=== Dashboard: 开始加载设备列表 ==="),await n.fetchDevices(),console.log("=== Dashboard: 设备列表加载完成 ==="),console.log("当前设备数量:",n.devices.length),console.log("设备列表:",n.devices),n.devices.length>0&&(console.log("第一个设备详情:",n.devices[0]),console.log("第一个设备用户名:",n.devices[0].username),console.log("第一个设备ID:",n.devices[0].deviceId))}catch(k){console.error("加载设备列表失败:",k)}},de=async()=>{try{console.log("=== 开始加载实时数据 ===");const k=await n.fetchRealtimeStream();console.log("实时数据响应:",k),r.value=k.devices||[],console.log("设置实时设备数量:",r.value.length),console.log("实时设备列表:",r.value)}catch(k){console.error("加载实时数据失败:",k),console.log("使用设备列表作为实时数据备选"),r.value=n.devices||[]}},ge=async()=>{try{console.log("=== 开始加载事件数据 ==="),_.value=[{eventId:"EVENT_001",deviceId:"MUSE_PI_PRO_001",timestamp:new Date(Date.now()-1e3*60*30).toISOString(),eventType:"FATIGUE",severity:"MEDIUM",behavior:"EYE_CLOSURE"},{eventId:"EVENT_002",deviceId:"MUSE_PI_PRO_001",timestamp:new Date(Date.now()-1e3*60*15).toISOString(),eventType:"DISTRACTION",severity:"LOW",behavior:"DISTRACTED"}],console.log("事件数据加载完成:",_.value.length,"个事件")}catch(k){console.error("加载事件数据失败:",k),_.value=[]}},f=async()=>{try{console.log("=== 开始加载活跃告警 ==="),I.value=[{alertId:"ALERT_001",deviceId:"MUSE_PI_PRO_001",timestamp:new Date(Date.now()-1e3*60*5).toISOString(),message:"驾驶员出现疲劳状态",severity:"HIGH",alertType:"FATIGUE_HIGH"}],console.log("活跃告警加载完成:",I.value.length,"个告警")}catch(k){console.error("加载活跃告警失败:",k),I.value=[]}},c=()=>{de()},M=()=>{me()},L=()=>{console.log("更新地图筛选:",p.value)},B=()=>{m.value=!m.value,he({message:m.value?"已进入管理模式":"已退出管理模式",type:m.value?"warning":"info",duration:2e3})},W=k=>{console.log("事件周期变化:",k)},x=k=>{console.log("疲劳分析类型变化:",k)},$=k=>{if(!k)return"未知";const b=new Date(k),X=new Date-b,G=Math.floor(X/6e4);if(G<1)return"刚刚";if(G<60)return`${G}分钟前`;const se=Math.floor(G/60);return se<24?`${se}小时前`:b.toLocaleDateString()},Q=k=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[k]||"未知",Z=k=>({LOW:"success",MEDIUM:"warning",HIGH:"danger",CRITICAL:"danger"})[k]||"info",le=k=>({LOW:"Check",MEDIUM:"Warning",HIGH:"Bell",CRITICAL:"Bell"})[k]||"Check",ce=k=>{console.log("点击告警:",k),he.info(`查看告警详情: ${k.message}`)},ke=k=>{console.log("设备点击:",k)},Ae=k=>{console.log("地图准备就绪:",k)},Fe=k=>{Ue(k)},Ue=k=>{t.push(`/devices/${k.deviceId}`)},fe=()=>{O.value.apiKey=localStorage.getItem("amap_api_key")||"",O.value.securityKey=localStorage.getItem("amap_security_key")||"",O.value.version=localStorage.getItem("amap_version")||"1.4.15",w.value=!0},We=()=>{if(!O.value.apiKey.trim()){he.warning("请输入API Key");return}localStorage.setItem("amap_api_key",O.value.apiKey),localStorage.setItem("amap_security_key",O.value.securityKey),localStorage.setItem("amap_version",O.value.version),w.value=!1,he.success("地图配置已保存"),setTimeout(()=>{window.location.reload()},1e3)},oe=k=>{if(!k)return"未知";const b=new Date(k),X=new Date-b,G=Math.floor(X/6e4);if(G<1)return"刚刚";if(G<60)return`${G}分钟前`;const se=Math.floor(G/60);return se<24?`${se}小时前`:b.toLocaleDateString()},qe=k=>{console.log("收到实时数据推送:",k);const{type:b,payload:K}=k;if(b==="realtime_data"){const{deviceId:X,data:G,timestamp:se}=K,re=r.value.find(Ce=>Ce.deviceId===X);re?Object.assign(re,{location:G.location,speed:G.speed,direction:G.direction,fatigueLevel:G.fatigueLevel,fatigueScore:G.fatigueScore,lastSeen:new Date(se).toISOString()}):r.value.push({deviceId:X,...G,lastSeen:new Date(se).toISOString()}),z.value&&z.value.updateMarkers()}},F=k=>{console.log("收到设备状态更新:",k);const{type:b,payload:K}=k;if(b==="device_status"){const{deviceId:X,status:G,timestamp:se}=K,re=r.value.find(Ce=>Ce.deviceId===X);re&&(re.status=G,re.lastSeen=new Date(se).toISOString()),he.info(`设备 ${X} 状态变更为 ${G}`)}},De=k=>{console.log("收到告警推送:",k);const{type:b,payload:K}=k;if(b==="alert"){const{alertType:X,message:G,severity:se}=K;he({type:{CRITICAL:"error",HIGH:"warning",MEDIUM:"info",LOW:"success"}[se]||"warning",message:`${X}: ${G}`,duration:se==="CRITICAL"?0:5e3,showClose:!0}),(se==="CRITICAL"||se==="HIGH")&&Yn(se)}},Bt=k=>{console.log("收到事件通知:",k);const{type:b,payload:K}=k;if(b==="event"){const{eventType:X}=K;if(s.value.eventSummary){const G=new Date().toDateString();s.value.eventSummary[G]||(s.value.eventSummary[G]={total:0,fatigue:0,distraction:0,emergency:0}),s.value.eventSummary[G].total++,s.value.eventSummary[G][X.toLowerCase()]++}}},Yn=k=>{try{new Audio(`/static/audio/alert_${k.toLowerCase()}.mp3`).play().catch(K=>{console.log("无法播放告警声音:",K)})}catch(b){console.log("告警声音文件不存在:",b)}},ht=()=>{v.value="刚刚",g.value=_.value.length,S.value=I.value.filter(k=>k.severity==="CRITICAL"||k.severity==="HIGH").length,y.value=Math.floor(Math.random()*50)+100,D.value=(Math.random()*2+1).toFixed(1)},nt=k=>{C.value=k,console.log("WebSocket状态变化:",k?"已连接":"已断开")};return Be(async()=>{console.log("=== Dashboard组件已挂载 ==="),console.log("开始加载数据..."),console.log("当前时间:",new Date().toISOString());try{await ee(),ht(),console.log("=== Dashboard数据加载完成 ===")}catch(K){console.error("=== Dashboard数据加载失败 ===",K)}console.log("开始连接WebSocket...");try{te.connect(),console.log("WebSocket连接请求已发送")}catch(K){console.error("WebSocket连接失败:",K)}te.on("connected",nt),te.on("disconnected",nt),te.on("realtime_data",qe),te.on("device_status",F),te.on("alert",De),te.on("event",Bt),C.value=te.getConnectionStatus().isConnected;const k=setInterval(()=>{console.log("=== 定时刷新实时数据 ==="),de(),ht()},15e3),b=setInterval(()=>{ht()},5e3);He(()=>{clearInterval(k),clearInterval(b),te.off("connected",nt),te.off("disconnected",nt),te.off("realtime_data",qe),te.off("device_status",F),te.off("alert",De),te.off("event",Bt)})}),(k,b)=>{const K=T("el-button"),X=T("el-col"),G=T("el-row"),se=T("el-tag"),re=T("el-icon"),Ce=T("el-option"),Ht=T("el-select"),ze=T("el-card"),Xn=T("el-badge"),gt=T("el-input"),Oe=T("el-table-column"),Qn=T("el-table"),yt=T("el-form-item"),Zn=T("el-form"),eo=T("el-dialog"),to=Lt("loading");return P(),j("div",La,[d("div",Pa,[a(K,{type:m.value?"danger":"primary",icon:m.value?"Lock":"Unlock",onClick:B,size:"small"},{default:i(()=>[A(E(m.value?"退出管理":"管理模式"),1)]),_:1},8,["type","icon"])]),a(G,{gutter:20,class:"overview-section"},{default:i(()=>[a(X,{xs:12,sm:6,md:6,lg:6,xl:6},{default:i(()=>[a(ot,{title:"设备总数",value:s.value.deviceStatus?.total||0,icon:"Monitor",color:"primary",suffix:"台",highlight:!0},null,8,["value"])]),_:1}),a(X,{xs:12,sm:6,md:6,lg:6,xl:6},{default:i(()=>[a(ot,{title:"离线设备",value:s.value.deviceStatus?.offline||0,icon:"CircleClose",color:"warning",suffix:"台",pulse:s.value.deviceStatus?.offline>0},null,8,["value","pulse"])]),_:1}),a(X,{xs:12,sm:6,md:6,lg:6,xl:6},{default:i(()=>[a(ot,{title:"今日事件",value:s.value.eventSummary?.today?.total||0,icon:"Warning",color:"primary",suffix:"起",pulse:s.value.eventSummary?.today?.total>0},null,8,["value","pulse"])]),_:1}),a(X,{xs:12,sm:6,md:6,lg:6,xl:6},{default:i(()=>[a(ot,{title:"活跃告警",value:s.value.alertSummary?.active||0,icon:"Bell",color:"danger",suffix:"条",pulse:s.value.alertSummary?.active>0,highlight:s.value.alertSummary?.active>0,urgent:s.value.alertSummary?.active>0},null,8,["value","pulse","highlight","urgent"])]),_:1})]),_:1}),a(G,{gutter:20,class:"status-indicators"},{default:i(()=>[a(X,{xs:24,sm:8,md:8,lg:8,xl:8},{default:i(()=>[d("div",$a,[d("div",Na,[b[8]||(b[8]=d("span",null,"系统状态",-1)),d("div",{class:be(["status-dot",q.value])},[...b[7]||(b[7]=[d("div",{class:"pulse-ring"},null,-1)])],2)]),d("div",Fa,[d("div",Ua,[b[9]||(b[9]=d("span",null,"WebSocket连接",-1)),a(se,{type:C.value?"success":"danger",size:"small"},{default:i(()=>[A(E(C.value?"已连接":"断开"),1)]),_:1},8,["type"])]),d("div",za,[b[10]||(b[10]=d("span",null,"数据更新",-1)),d("span",Ba,E(v.value),1)])])])]),_:1}),a(X,{xs:24,sm:8,md:8,lg:8,xl:8},{default:i(()=>[d("div",Ha,[d("div",Va,[b[11]||(b[11]=d("span",null,"实时事件流",-1)),d("div",ja,[(P(),j(Le,null,Pe(5,N=>d("div",{class:"stream-dot",key:N,style:no({animationDelay:`${N*.2}s`})},null,4)),64))])]),d("div",Wa,[d("div",qa,[b[12]||(b[12]=d("span",null,"最近事件",-1)),d("span",Ga,E(g.value),1)]),d("div",Ka,[b[13]||(b[13]=d("span",null,"处理速度",-1)),d("span",Ja,E(y.value)+"ms",1)])])])]),_:1}),a(X,{xs:24,sm:8,md:8,lg:8,xl:8},{default:i(()=>[d("div",{class:be(["status-indicator alert-indicator",{"has-critical-alerts":S.value>0}])},[d("div",Ya,[b[14]||(b[14]=d("span",null,"告警监控",-1)),d("div",{class:be(["alert-monitor",{"has-alerts":I.value.length>0}])},[a(re,null,{default:i(()=>[a(U(Et))]),_:1}),S.value>0?(P(),j("div",Xa,E(S.value),1)):we("",!0)],2)]),d("div",Qa,[d("div",Za,[b[15]||(b[15]=d("span",null,"严重告警",-1)),d("span",{class:be(["critical-count",{critical:S.value>0}])},E(S.value),3)]),d("div",el,[b[16]||(b[16]=d("span",null,"响应时间",-1)),d("span",tl,E(D.value)+"s",1)])])],2)]),_:1})]),_:1}),a(G,{gutter:20,class:"monitoring-section"},{default:i(()=>[a(X,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[a(ze,{class:"map-section",shadow:"hover"},{header:i(()=>[d("div",nl,[b[19]||(b[19]=d("span",null,"实时设备监控",-1)),d("div",ol,[d("div",sl,[a(se,{size:"small",type:"success"},{default:i(()=>[A("在线 "+E(Y.value),1)]),_:1}),a(se,{size:"small",type:"warning"},{default:i(()=>[A("离线 "+E(ne.value),1)]),_:1})]),a(Ht,{modelValue:p.value,"onUpdate:modelValue":b[0]||(b[0]=N=>p.value=N),placeholder:"筛选设备状态",size:"small",clearable:"",style:{"margin-right":"10px",width:"150px"},onChange:L},{default:i(()=>[a(Ce,{label:"全部设备",value:""}),a(Ce,{label:"在线设备",value:"ONLINE"}),a(Ce,{label:"离线设备",value:"OFFLINE"}),a(Ce,{label:"失联设备",value:"LOST"})]),_:1},8,["modelValue"]),a(K,{size:"small",onClick:c},{default:i(()=>[a(re,null,{default:i(()=>[a(U(xe))]),_:1}),b[17]||(b[17]=A(" 刷新 ",-1))]),_:1}),m.value?(P(),ie(K,{key:0,size:"small",onClick:fe},{default:i(()=>[a(re,null,{default:i(()=>[a(U($t))]),_:1}),b[18]||(b[18]=A(" 配置 ",-1))]),_:1})):we("",!0)])])]),default:i(()=>[a(Ko,{ref_key:"mapComponent",ref:z,devices:V.value,onDeviceClick:ke,onMapReady:Ae},null,8,["devices"])]),_:1})]),_:1}),a(X,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[a(G,{gutter:20,class:"charts-row"},{default:i(()=>[a(X,{span:24},{default:i(()=>[a(ze,{class:"chart-card",shadow:"hover"},{header:i(()=>[...b[20]||(b[20]=[d("span",null,"事件趋势",-1)])]),default:i(()=>[a(Sn,{data:_.value,loading:u.value,onPeriodChange:W},null,8,["data","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(G,{gutter:20,class:"analysis-section"},{default:i(()=>[a(X,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[a(ze,{class:"chart-card",shadow:"hover"},{header:i(()=>[...b[21]||(b[21]=[d("span",null,"疲劳行为分析",-1)])]),default:i(()=>[a(ts,{data:_.value,loading:u.value,onTypeChange:x},null,8,["data","loading"])]),_:1})]),_:1}),a(X,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[a(ze,{class:be(["alert-panel",{"has-critical-alerts":S.value>0}]),shadow:"hover"},{header:i(()=>[d("div",al,[b[22]||(b[22]=d("span",null,"实时告警",-1)),d("div",ll,[a(Xn,{value:I.value.length,hidden:I.value.length===0,type:"danger"},{default:i(()=>[a(re,null,{default:i(()=>[a(U(Et))]),_:1})]),_:1},8,["value","hidden"]),S.value>0?(P(),j("span",rl,"严重告警 "+E(S.value),1)):we("",!0)])])]),default:i(()=>[d("div",il,[(P(!0),j(Le,null,Pe(I.value.slice(0,5),N=>(P(),j("div",{key:N.alertId,class:be(["alert-item",`alert-${N.severity.toLowerCase()}`]),onClick:Vt=>ce(N)},[d("div",ul,[a(re,{class:be(le(N.severity))},{default:i(()=>[(P(),ie(rt(le(N.severity))))]),_:2},1032,["class"])]),d("div",dl,[d("div",fl,E(N.message),1),d("div",pl,[d("span",ml,[a(re,null,{default:i(()=>[a(U(dn))]),_:1}),A(" "+E(N.deviceId),1)]),d("span",vl,[a(re,null,{default:i(()=>[a(U(ho))]),_:1}),A(" "+E($(N.timestamp)),1)])])]),d("div",hl,[a(se,{type:Z(N.severity),size:"small"},{default:i(()=>[A(E(Q(N.severity)),1)]),_:2},1032,["type"])])],10,cl))),128)),I.value.length===0?(P(),j("div",gl,[a(re,null,{default:i(()=>[a(U(go))]),_:1}),b[23]||(b[23]=d("span",null,"暂无活跃告警",-1))])):we("",!0)])]),_:1},8,["class"])]),_:1})]),_:1}),m.value?(P(),ie(ze,{key:0,class:"device-list-section",shadow:"hover"},{header:i(()=>[d("div",yl,[b[25]||(b[25]=d("span",null,"设备管理",-1)),d("div",_l,[a(gt,{modelValue:l.value,"onUpdate:modelValue":b[1]||(b[1]=N=>l.value=N),placeholder:"搜索设备ID或驾驶员",size:"small",style:{width:"200px","margin-right":"10px"},clearable:""},{prefix:i(()=>[a(re,null,{default:i(()=>[a(U(mn))]),_:1})]),_:1},8,["modelValue"]),a(K,{size:"small",onClick:M},{default:i(()=>[a(re,null,{default:i(()=>[a(U(xe))]),_:1}),b[24]||(b[24]=A(" 刷新 ",-1))]),_:1})])])]),default:i(()=>[Pt((P(),ie(Qn,{data:V.value,stripe:"",style:{width:"100%"},onRowClick:Fe},{default:i(()=>[a(Oe,{prop:"deviceId",label:"设备ID",width:"150"}),a(Oe,{prop:"username",label:"驾驶员",width:"120"}),a(Oe,{prop:"status",label:"状态",width:"100"},{default:i(({row:N})=>[a(It,{status:N.status},null,8,["status"])]),_:1}),a(Oe,{prop:"healthScore",label:"健康度",width:"120"},{default:i(({row:N})=>[a(Ct,{score:N.healthScore||0},null,8,["score"])]),_:1}),a(Oe,{prop:"lastSeen",label:"最后心跳",width:"150"},{default:i(({row:N})=>[A(E(oe(N.lastSeen)),1)]),_:1}),a(Oe,{prop:"location",label:"位置","min-width":"200"},{default:i(({row:N})=>[N.location&&N.location.lat!==null&&N.location.lng!==null?(P(),j("span",wl,E(N.location.lat.toFixed(6))+", "+E(N.location.lng.toFixed(6)),1)):(P(),j("span",bl,"未知"))]),_:1}),a(Oe,{label:"操作",width:"120",fixed:"right"},{default:i(({row:N})=>[a(K,{size:"small",type:"primary",onClick:un(Vt=>Ue(N),["stop"])},{default:i(()=>[...b[26]||(b[26]=[A(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[to,U(n).loading]])]),_:1})):(P(),ie(ze,{key:1,class:"device-status-section",shadow:"hover"},{header:i(()=>[d("div",Sl,[b[28]||(b[28]=d("span",null,"设备状态概览",-1)),a(K,{size:"small",onClick:M},{default:i(()=>[a(re,null,{default:i(()=>[a(U(xe))]),_:1}),b[27]||(b[27]=A(" 刷新 ",-1))]),_:1})])]),default:i(()=>[d("div",El,[(P(!0),j(Le,null,Pe(V.value.slice(0,8),N=>(P(),j("div",{key:N.deviceId,class:"device-status-item",onClick:Vt=>ke(N)},[d("div",Cl,[d("div",Tl,E(N.deviceId),1),d("div",kl,E(N.username||"未知用户"),1)]),d("div",Al,[a(It,{status:N.status},null,8,["status"]),a(Ct,{score:N.healthScore||0},null,8,["score"])]),d("div",xl,E(oe(N.lastSeen)),1)],8,Il))),128))])]),_:1})),a(eo,{modelValue:w.value,"onUpdate:modelValue":b[6]||(b[6]=N=>w.value=N),title:"地图配置",width:"600px","close-on-click-modal":!1},{footer:i(()=>[a(K,{onClick:b[5]||(b[5]=N=>w.value=!1)},{default:i(()=>[...b[32]||(b[32]=[A("取消",-1)])]),_:1}),a(K,{type:"primary",onClick:We},{default:i(()=>[...b[33]||(b[33]=[A("保存",-1)])]),_:1})]),default:i(()=>[a(Zn,{model:O.value,"label-width":"120px"},{default:i(()=>[a(yt,{label:"高德地图API Key"},{default:i(()=>[a(gt,{modelValue:O.value.apiKey,"onUpdate:modelValue":b[2]||(b[2]=N=>O.value.apiKey=N),type:"password",placeholder:"请输入高德地图API Key","show-password":""},null,8,["modelValue"]),b[29]||(b[29]=d("div",{class:"form-tip"},[A(" 请到 "),d("a",{href:"https://console.amap.com/",target:"_blank"},"高德开放平台"),A(" 申请API Key "),d("br"),d("a",{href:"/map-config-help",target:"_blank"},"查看详细配置帮助")],-1))]),_:1}),a(yt,{label:"安全密钥"},{default:i(()=>[a(gt,{modelValue:O.value.securityKey,"onUpdate:modelValue":b[3]||(b[3]=N=>O.value.securityKey=N),type:"password",placeholder:"请输入安全密钥（可选）","show-password":""},null,8,["modelValue"]),b[30]||(b[30]=d("div",{class:"form-tip"}," 2021年后申请的API Key需要配置安全密钥，请到控制台获取 ",-1))]),_:1}),a(yt,{label:"API版本"},{default:i(()=>[a(Ht,{modelValue:O.value.version,"onUpdate:modelValue":b[4]||(b[4]=N=>O.value.version=N),placeholder:"选择API版本"},{default:i(()=>[a(Ce,{label:"基础版 v1.4.15",value:"1.4.15"}),a(Ce,{label:"标准版 v2.0",value:"2.0"})]),_:1},8,["modelValue"]),b[31]||(b[31]=d("div",{class:"form-tip"}," 基础版功能较少但调用限制较少，标准版功能完整但有限制 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ol=Ee(Dl,[["__scopeId","data-v-fde1ec5a"]]),Ml={class:"map-controls"},Rl={key:0,class:"time-controls"},Ll={key:1,class:"map-error"},Pl={key:2,class:"map-loading"},$l={__name:"SimpleTrackMap",props:{deviceId:{type:String,required:!0},trackData:{type:Array,default:()=>[]},events:{type:Array,default:()=>[]},center:{type:Object,default:()=>({lat:33.553733,lng:119.030953})},zoom:{type:Number,default:12}},emits:["event-click","map-ready"],setup(e,{expose:t,emit:n}){const o=e,s=n,r=R(null),l=R(!1),p=R(""),w=R(!1),m=R(0);let u=null,_=null,I=[],C=[],v=null,g=null,y=null;const S=R(""),D=()=>{const x="732a364f70864bb0c4ac3395cc3d5503";localStorage.getItem("amap_api_key"),S.value=x},O=async()=>{if(console.log("开始初始化SimpleTrackMap..."),console.log("API Key:",S.value?"已配置":"未配置"),console.log("地图容器:",r.value),!S.value){p.value="高德地图API key未配置";return}if(!r.value){p.value="地图容器未找到";return}l.value=!0,p.value="";try{if(window.AMap||(console.log("加载高德地图API..."),await z()),!window.AMap)throw new Error("高德地图API加载失败");console.log("AMap已加载，开始创建SimpleTrackMap实例..."),console.log("地图容器尺寸:",r.value.offsetWidth,"x",r.value.offsetHeight),u=new window.AMap.Map(r.value,{center:[o.center.lng,o.center.lat],zoom:o.zoom,mapStyle:"amap://styles/normal"}),console.log("SimpleTrackMap实例创建成功"),g=new window.AMap.InfoWindow({offset:new window.AMap.Pixel(0,-30)}),u.on("complete",()=>{console.log("SimpleTrackMap地图加载完成"),s("map-ready",u),V(),q(),l.value=!1})}catch(x){console.error("SimpleTrackMap地图初始化失败:",x),p.value=x.message||"地图初始化失败",l.value=!1}},z=()=>new Promise((x,$)=>{if(window.AMap){x();return}const Q=localStorage.getItem("amap_version")||"1.4.15",Z=document.createElement("script");Z.src=`https://webapi.amap.com/maps?v=${Q}&key=${S.value}`,Z.onload=()=>{const le=()=>{window.AMap&&window.AMap.Map?x():setTimeout(le,100)};le()},Z.onerror=()=>{$(new Error("高德地图API加载失败"))},document.head.appendChild(Z)}),V=()=>{if(!u||!o.trackData.length)return;_&&u.remove(_),I.forEach($=>u.remove($)),I=[];const x=o.trackData.map($=>[$.lng,$.lat]);_=new window.AMap.Polyline({path:x,strokeColor:"#409EFF",strokeWeight:3,strokeOpacity:.8}),u.add(_),o.trackData.forEach(($,Q)=>{const Z=new window.AMap.Marker({position:[$.lng,$.lat],title:`轨迹点 ${Q+1}`,icon:Y(Q),anchor:"center"});Z.on("click",()=>{ee($,Z)}),I.push(Z),u.add(Z)}),x.length>0&&u.setFitView(I)},q=()=>{!u||!o.events.length||(C.forEach(x=>u.remove(x)),C=[],o.events.forEach(x=>{if(x.location&&x.location.lat&&x.location.lng){const $=new window.AMap.Marker({position:[x.location.lng,x.location.lat],title:B(x.eventType),icon:ne(x.severity),anchor:"center"});$.on("click",()=>{ue(x,$),s("event-click",x)}),C.push($),u.add($)}}))},Y=x=>x===0?"https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png":x===o.trackData.length-1?"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png":"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",ne=x=>{const $={LOW:"https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png",MEDIUM:"https://webapi.amap.com/theme/v1.3/markers/n/mark_y.png",HIGH:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",CRITICAL:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png"};return $[x]||$.MEDIUM},ee=(x,$)=>{const Q=`
    <div class="track-point-info">
      <h4>轨迹点</h4>
      <p><strong>时间:</strong> ${L(x.timestamp)}</p>
      <p><strong>位置:</strong> ${x.lat.toFixed(6)}, ${x.lng.toFixed(6)}</p>
      <p><strong>速度:</strong> ${x.speed||0} km/h</p>
      <p><strong>方向:</strong> ${x.direction||0}°</p>
    </div>
  `;g.setContent(Q),g.open(u,$.getPosition())},ue=(x,$)=>{const Q=`
    <div class="event-info">
      <h4>${B(x.eventType)}</h4>
      <p><strong>严重程度:</strong> ${W(x.severity)}</p>
      <p><strong>置信度:</strong> ${(x.confidence*100).toFixed(1)}%</p>
      <p><strong>时间:</strong> ${L(x.timestamp)}</p>
      <p><strong>描述:</strong> ${x.context||"无"}</p>
    </div>
  `;g.setContent(Q),g.open(u,$.getPosition())},me=()=>{o.trackData.length&&(w.value?(y&&(clearInterval(y),y=null),w.value=!1):(w.value=!0,m.value=0,y=setInterval(()=>{m.value<o.trackData.length-1?(m.value++,ge(m.value)):(y&&(clearInterval(y),y=null),w.value=!1)},1e3)))},de=()=>{y&&(clearInterval(y),y=null),w.value=!1,m.value=0,V()},ge=x=>{if(!u||!o.trackData[x])return;const $=o.trackData[x];u.setCenter([$.lng,$.lat]),v&&u.remove(v),v=new window.AMap.Marker({position:[$.lng,$.lat],title:"当前位置",icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",anchor:"center"}),u.add(v)},f=()=>{u&&o.trackData.length>0?u.setFitView(I):u&&u.setCenter([o.center.lng,o.center.lat])},c=()=>{p.value="",u&&(u.destroy(),u=null),O()},M=x=>o.trackData[x]?L(o.trackData[x].timestamp):"",L=x=>x?new Date(x).toLocaleString():"未知",B=x=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[x]||"未知事件",W=x=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[x]||"未知";return Re(()=>o.trackData,V,{deep:!0}),Re(()=>o.events,q,{deep:!0}),Re(()=>S.value,x=>{x&&!u&&O()}),Be(()=>{D(),cn(()=>{S.value&&O()})}),He(()=>{y&&clearInterval(y),u&&u.destroy()}),t({centerMap:f,updateTrackDisplay:V,updateEventMarkers:q,getMap:()=>u}),(x,$)=>{const Q=T("el-icon"),Z=T("el-button"),le=T("el-button-group"),ce=T("el-slider"),ke=T("el-alert");return P(),j("div",{class:"simple-track-map",ref_key:"mapContainer",ref:r},[d("div",Ml,[a(le,null,{default:i(()=>[a(Z,{size:"small",onClick:me,disabled:!e.trackData.length},{default:i(()=>[a(Q,null,{default:i(()=>[a(U(yo))]),_:1}),A(" "+E(w.value?"暂停":"播放"),1)]),_:1},8,["disabled"]),a(Z,{size:"small",onClick:de},{default:i(()=>[a(Q,null,{default:i(()=>[a(U(xe))]),_:1}),$[1]||($[1]=A(" 重置 ",-1))]),_:1}),a(Z,{size:"small",onClick:f},{default:i(()=>[a(Q,null,{default:i(()=>[a(U(fn))]),_:1}),$[2]||($[2]=A(" 居中 ",-1))]),_:1})]),_:1})]),e.trackData.length?(P(),j("div",Rl,[a(ce,{modelValue:m.value,"onUpdate:modelValue":$[0]||($[0]=Ae=>m.value=Ae),min:0,max:e.trackData.length-1,step:1,onChange:ge,"format-tooltip":M},null,8,["modelValue","max"])])):we("",!0),p.value?(P(),j("div",Ll,[a(ke,{title:"地图加载失败",description:p.value,type:"error","show-icon":"",closable:!1},null,8,["description"]),a(Z,{onClick:c,style:{"margin-top":"10px"}},{default:i(()=>[...$[3]||($[3]=[A("重试",-1)])]),_:1})])):we("",!0),l.value?(P(),j("div",Pl,[a(Q,{class:"is-loading"},{default:i(()=>[a(U(pn))]),_:1}),$[4]||($[4]=d("span",null,"地图加载中...",-1))])):we("",!0)],512)}}},Nl=Ee($l,[["__scopeId","data-v-89efa1a2"]]),St={getEvents(e={}){return console.log("=== API调用: 获取事件列表 ==="),console.log("请求参数:",e),Se.get("/api/v1/platform/events",{params:e})},getEventStatistics(e={}){return Se.get("/api/v1/platform/events/statistics",{params:e})},getDrivingBehaviorAnalysis(e,t={}){return Se.get("/api/v1/platform/analysis/driving-behavior",{params:{deviceId:e,...t}})}},Kn=Mt("event",()=>{const e=R([]),t=R(null),n=R(null),o=R(!1),s=R(null),r=J(()=>({total:e.value.length,fatigue:e.value.filter(g=>g.eventType==="FATIGUE").length,distraction:e.value.filter(g=>g.eventType==="DISTRACTION").length,emergency:e.value.filter(g=>g.eventType==="EMERGENCY").length})),l=J(()=>({low:e.value.filter(g=>g.severity==="LOW").length,medium:e.value.filter(g=>g.severity==="MEDIUM").length,high:e.value.filter(g=>g.severity==="HIGH").length,critical:e.value.filter(g=>g.severity==="CRITICAL").length})),p=async(g={})=>{o.value=!0,s.value=null,console.log("=== 事件Store: 开始获取事件列表 ==="),console.log("请求参数:",g);try{const y=await St.getEvents(g);return console.log("事件API响应:",y),console.log("响应中的事件数组:",y.events),console.log("事件数组长度:",y.events?.length),e.value=y.events||[],console.log("设置事件列表:",e.value.length,"个事件"),console.log("最终事件列表:",e.value),y}catch(y){console.error("获取事件列表失败:",y),s.value=y.message,console.log("API调用失败，使用模拟数据");const S=w(g);return e.value=S,{events:S}}finally{o.value=!1}},w=g=>{const y=[],S=g.deviceId||"MUSE_PI_PRO_001",D=["FATIGUE","DISTRACTION","EMERGENCY"],O=["LOW","MEDIUM","HIGH","CRITICAL"];for(let z=0;z<5;z++){const V=new Date(Date.now()-Math.random()*24*60*60*1e3),q=D[Math.floor(Math.random()*D.length)],Y=O[Math.floor(Math.random()*O.length)],ne=33.553733+(Math.random()-.5)*.01,ee=119.030953+(Math.random()-.5)*.01;y.push({eventId:`EVENT_${Date.now()}_${z}`,deviceId:S,eventType:q,severity:Y,confidence:Math.random()*.4+.6,duration:Math.floor(Math.random()*30)+5,timestamp:V.toISOString(),location:{lat:ne,lng:ee,altitude:Math.random()*20+5},behavior:m(q),context:u(q,Y)})}return y.sort((z,V)=>new Date(V.timestamp)-new Date(z.timestamp))},m=g=>{const S={FATIGUE:["频繁眨眼","头部下垂","打哈欠","注意力不集中"],DISTRACTION:["看手机","转头说话","吃东西","调整设备"],EMERGENCY:["急刹车","急转弯","偏离车道","碰撞预警"]}[g]||["未知行为"];return S[Math.floor(Math.random()*S.length)]},u=(g,y)=>({FATIGUE:{LOW:"轻微疲劳，建议适当休息",MEDIUM:"中度疲劳，建议立即休息",HIGH:"严重疲劳，存在安全隐患",CRITICAL:"极度疲劳，立即停车休息"},DISTRACTION:{LOW:"轻微分心，注意驾驶安全",MEDIUM:"中度分心，影响驾驶安全",HIGH:"严重分心，存在碰撞风险",CRITICAL:"极度分心，立即停止驾驶"},EMERGENCY:{LOW:"轻微紧急情况，注意观察",MEDIUM:"中度紧急情况，谨慎驾驶",HIGH:"严重紧急情况，立即处理",CRITICAL:"极度紧急情况，立即停车"}})[g]?.[y]||"事件详情";return{events:e,eventStatistics:t,drivingBehaviorAnalysis:n,loading:o,error:s,eventCount:r,severityCount:l,fetchEvents:p,fetchEventStatistics:async(g={})=>{try{const y=await St.getEventStatistics(g);return t.value=y,y}catch(y){throw s.value=y.message,y}},fetchDrivingBehaviorAnalysis:async(g,y={})=>{try{const S=await St.getDrivingBehaviorAnalysis(g,y);return n.value=S,S}catch(S){throw s.value=S.message,S}},addEvent:g=>{e.value.unshift(g)},clearError:()=>{s.value=null}}}),Fl={class:"device-detail"},Ul={class:"page-header"},zl={key:0,class:"device-info"},Bl={class:"info-item"},Hl={class:"info-item"},Vl={class:"info-item"},jl={class:"info-item"},Wl={class:"info-item"},ql={class:"info-item"},Gl={class:"info-item"},Kl={class:"info-item"},Jl={key:0,class:"data-grid"},Yl={class:"data-item"},Xl={class:"data-item"},Ql={class:"data-item"},Zl={class:"data-item"},er={class:"data-item"},tr={class:"data-item"},nr={key:0,class:"stats-grid"},or={class:"stat-item"},sr={class:"stat-value"},ar={class:"stat-item"},lr={class:"stat-value"},rr={class:"stat-item"},ir={class:"stat-value"},cr={class:"stat-item"},ur={class:"stat-value"},dr={class:"stat-item"},fr={class:"stat-value"},pr={class:"event-context"},mr={class:"event-details"},vr={class:"header-actions"},hr={key:0,class:"event-detail"},gr={__name:"DeviceDetail",setup(e){const t=rn(),n=Rt(),o=zt(),s=Kn(),r=J(()=>t.params.deviceId),l=J(()=>o.currentDevice),p=R([]),w=R([]),m=R(!1),u=R(null),_=R(!1),I=R({apiKey:""}),C=()=>{n.go(-1)},v=async()=>{try{await o.fetchDeviceDetail(r.value)}catch(f){console.error("加载设备详情失败:",f),he.error("加载设备详情失败")}},g=async()=>{try{const f={deviceId:r.value,eventType:"FATIGUE",limit:10},c=await s.fetchEvents(f);p.value=c.events||[]}catch(f){console.error("加载事件历史失败:",f)}},y=async()=>{try{const f=new Date,M={startTime:new Date(f.getTime()-1440*60*1e3).toISOString(),endTime:f.toISOString()},L=await o.fetchDeviceTrack(r.value,M);w.value=L.track||[]}catch(f){console.error("加载轨迹数据失败:",f)}},S=()=>{v()},D=f=>{console.log("显示事件位置:",f)},O=f=>{u.value=f,m.value=!0},z=()=>{I.value.apiKey=localStorage.getItem("amap_api_key")||"",_.value=!0},V=()=>{if(!I.value.apiKey.trim()){he.warning("请输入API Key");return}localStorage.setItem("amap_api_key",I.value.apiKey),_.value=!1,he.success("地图配置已保存"),setTimeout(()=>{window.location.reload()},1e3)},q=f=>f?new Date(f).toLocaleString():"未知",Y=f=>f?`${f.lat.toFixed(6)}, ${f.lng.toFixed(6)}`:"未知",ne=f=>{if(!f)return"0分钟";const c=Math.floor(f/3600),M=Math.floor(f%3600/60);return c>0?`${c}小时${M}分钟`:`${M}分钟`},ee=f=>f?f<1?"优秀":f<2?"良好":f<5?"一般":"较差":"未知",ue=f=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[f]||"未知事件",me=f=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[f]||"未知",de=f=>({LOW:"success",MEDIUM:"warning",HIGH:"danger",CRITICAL:"danger"})[f]||"info",ge=f=>{f.deviceId===r.value&&v()};return Be(()=>{v(),g(),y(),te.on("realtime_data",ge);const f=setInterval(()=>{v()},3e4);He(()=>{clearInterval(f),te.off("realtime_data",ge)})}),(f,c)=>{const M=T("el-icon"),L=T("el-button"),B=T("el-card"),W=T("el-empty"),x=T("el-tag"),$=T("el-timeline-item"),Q=T("el-timeline"),Z=T("el-col"),le=T("el-row"),ce=T("el-descriptions-item"),ke=T("el-descriptions"),Ae=T("el-dialog"),Fe=T("el-input"),Ue=T("el-form-item"),fe=T("el-form"),We=Lt("loading");return P(),j("div",Fl,[d("div",Ul,[a(L,{onClick:C,size:"small"},{default:i(()=>[a(M,null,{default:i(()=>[a(U(_o))]),_:1}),c[4]||(c[4]=A(" 返回 ",-1))]),_:1}),d("h2",null,"设备详情 - "+E(r.value),1)]),Pt((P(),ie(le,{gutter:20},{default:i(()=>[a(Z,{xs:24,sm:24,md:10,lg:10,xl:10},{default:i(()=>[a(B,{class:"info-panel",shadow:"hover"},{header:i(()=>[...c[5]||(c[5]=[d("span",null,"设备信息",-1)])]),default:i(()=>[l.value?(P(),j("div",zl,[d("div",Bl,[c[6]||(c[6]=d("label",null,"设备ID:",-1)),d("span",null,E(l.value.deviceId),1)]),d("div",Hl,[c[7]||(c[7]=d("label",null,"设备类型:",-1)),d("span",null,E(l.value.deviceType),1)]),d("div",Vl,[c[8]||(c[8]=d("label",null,"版本:",-1)),d("span",null,E(l.value.version),1)]),d("div",jl,[c[9]||(c[9]=d("label",null,"驾驶员:",-1)),d("span",null,E(l.value.user?.username||"未知"),1)]),d("div",Wl,[c[10]||(c[10]=d("label",null,"联系方式:",-1)),d("span",null,E(l.value.user?.phone||"未知"),1)]),d("div",ql,[c[11]||(c[11]=d("label",null,"状态:",-1)),a(It,{status:l.value.status},null,8,["status"])]),d("div",Gl,[c[12]||(c[12]=d("label",null,"健康度:",-1)),a(Ct,{score:l.value.healthScore||0},null,8,["score"])]),d("div",Kl,[c[13]||(c[13]=d("label",null,"最后心跳:",-1)),d("span",null,E(q(l.value.lastSeen)),1)])])):we("",!0)]),_:1}),a(B,{class:"realtime-data",shadow:"hover"},{header:i(()=>[c[15]||(c[15]=d("span",null,"实时数据",-1)),a(L,{size:"small",onClick:S},{default:i(()=>[a(M,null,{default:i(()=>[a(U(xe))]),_:1}),c[14]||(c[14]=A(" 刷新 ",-1))]),_:1})]),default:i(()=>[l.value?.currentLocation?(P(),j("div",Jl,[d("div",Yl,[c[16]||(c[16]=d("label",null,"位置:",-1)),d("span",null,E(Y(l.value.currentLocation)),1)]),d("div",Xl,[c[17]||(c[17]=d("label",null,"速度:",-1)),d("span",null,E(l.value.currentLocation.speed||0)+" km/h",1)]),d("div",Ql,[c[18]||(c[18]=d("label",null,"方向:",-1)),d("span",null,E(l.value.currentLocation.direction||0)+"°",1)]),d("div",Zl,[c[19]||(c[19]=d("label",null,"海拔:",-1)),d("span",null,E(l.value.currentLocation.altitude||0)+"m",1)]),d("div",er,[c[20]||(c[20]=d("label",null,"GPS质量:",-1)),d("span",null,E(ee(l.value.currentLocation.hdop)),1)]),d("div",tr,[c[21]||(c[21]=d("label",null,"卫星数:",-1)),d("span",null,E(l.value.currentLocation.satellites||0)+"颗",1)])])):(P(),ie(W,{key:1,description:"暂无实时数据"}))]),_:1}),a(B,{class:"fatigue-stats",shadow:"hover"},{header:i(()=>[...c[22]||(c[22]=[d("span",null,"疲劳行为统计",-1)])]),default:i(()=>[l.value?.statistics?(P(),j("div",nr,[d("div",or,[c[23]||(c[23]=d("label",null,"今日疲劳事件:",-1)),d("span",sr,E(l.value.statistics.fatigueEvents||0),1)]),d("div",ar,[c[24]||(c[24]=d("label",null,"今日分心事件:",-1)),d("span",lr,E(l.value.statistics.distractionEvents||0),1)]),d("div",rr,[c[25]||(c[25]=d("label",null,"总驾驶时长:",-1)),d("span",ir,E(ne(l.value.statistics.totalDrivingTime)),1)]),d("div",cr,[c[26]||(c[26]=d("label",null,"总行驶距离:",-1)),d("span",ur,E(l.value.statistics.totalDistance||0)+" km",1)]),d("div",dr,[c[27]||(c[27]=d("label",null,"最后疲劳事件:",-1)),d("span",fr,E(q(l.value.statistics.lastFatigueEvent)),1)])])):(P(),ie(W,{key:1,description:"暂无统计数据"}))]),_:1}),a(B,{class:"event-history",shadow:"hover"},{header:i(()=>[c[29]||(c[29]=d("span",null,"历史疲劳事件",-1)),a(L,{size:"small",onClick:g},{default:i(()=>[a(M,null,{default:i(()=>[a(U(xe))]),_:1}),c[28]||(c[28]=A(" 刷新 ",-1))]),_:1})]),default:i(()=>[p.value.length?(P(),ie(Q,{key:0},{default:i(()=>[(P(!0),j(Le,null,Pe(p.value,oe=>(P(),ie($,{key:oe.eventId,timestamp:q(oe.timestamp),type:de(oe.severity),onClick:qe=>D(oe)},{default:i(()=>[a(x,{type:de(oe.severity),size:"small"},{default:i(()=>[A(E(ue(oe.eventType)),1)]),_:2},1032,["type"]),d("p",pr,E(oe.context),1),d("p",mr," 置信度: "+E((oe.confidence*100).toFixed(1))+"% | 持续时间: "+E(oe.duration)+"秒 ",1)]),_:2},1032,["timestamp","type","onClick"]))),128))]),_:1})):(P(),ie(W,{key:1,description:"暂无疲劳事件"}))]),_:1})]),_:1}),a(Z,{xs:24,sm:24,md:14,lg:14,xl:14},{default:i(()=>[a(B,{class:"map-panel",shadow:"hover"},{header:i(()=>[c[32]||(c[32]=d("span",null,"设备轨迹与事件位置",-1)),d("div",vr,[a(L,{size:"small",onClick:y},{default:i(()=>[a(M,null,{default:i(()=>[a(U(xe))]),_:1}),c[30]||(c[30]=A(" 刷新轨迹 ",-1))]),_:1}),a(L,{size:"small",onClick:z},{default:i(()=>[a(M,null,{default:i(()=>[a(U($t))]),_:1}),c[31]||(c[31]=A(" 配置 ",-1))]),_:1})])]),default:i(()=>[a(Nl,{"device-id":r.value,"track-data":w.value,events:p.value,onEventClick:O},null,8,["device-id","track-data","events"])]),_:1})]),_:1})]),_:1})),[[We,U(o).loading]]),a(Ae,{modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=oe=>m.value=oe),title:"事件详情",width:"600px"},{default:i(()=>[u.value?(P(),j("div",hr,[a(ke,{column:2,border:""},{default:i(()=>[a(ce,{label:"事件ID"},{default:i(()=>[A(E(u.value.eventId),1)]),_:1}),a(ce,{label:"设备ID"},{default:i(()=>[A(E(u.value.deviceId),1)]),_:1}),a(ce,{label:"事件类型"},{default:i(()=>[A(E(ue(u.value.eventType)),1)]),_:1}),a(ce,{label:"严重程度"},{default:i(()=>[A(E(me(u.value.severity)),1)]),_:1}),a(ce,{label:"置信度"},{default:i(()=>[A(E((u.value.confidence*100).toFixed(1))+"%",1)]),_:1}),a(ce,{label:"持续时间"},{default:i(()=>[A(E(u.value.duration)+"秒",1)]),_:1}),a(ce,{label:"发生时间",span:2},{default:i(()=>[A(E(q(u.value.timestamp)),1)]),_:1}),a(ce,{label:"位置",span:2},{default:i(()=>[A(E(Y(u.value.location)),1)]),_:1}),a(ce,{label:"行为描述",span:2},{default:i(()=>[A(E(u.value.behavior),1)]),_:1}),a(ce,{label:"上下文",span:2},{default:i(()=>[A(E(u.value.context),1)]),_:1})]),_:1})])):we("",!0)]),_:1},8,["modelValue"]),a(Ae,{modelValue:_.value,"onUpdate:modelValue":c[3]||(c[3]=oe=>_.value=oe),title:"地图配置",width:"500px","close-on-click-modal":!1},{footer:i(()=>[a(L,{onClick:c[2]||(c[2]=oe=>_.value=!1)},{default:i(()=>[...c[34]||(c[34]=[A("取消",-1)])]),_:1}),a(L,{type:"primary",onClick:V},{default:i(()=>[...c[35]||(c[35]=[A("保存",-1)])]),_:1})]),default:i(()=>[a(fe,{model:I.value,"label-width":"100px"},{default:i(()=>[a(Ue,{label:"高德地图API Key"},{default:i(()=>[a(Fe,{modelValue:I.value.apiKey,"onUpdate:modelValue":c[1]||(c[1]=oe=>I.value.apiKey=oe),type:"password",placeholder:"请输入高德地图API Key","show-password":""},null,8,["modelValue"]),c[33]||(c[33]=d("div",{class:"form-tip"},[A(" 请到 "),d("a",{href:"https://console.amap.com/",target:"_blank"},"高德开放平台"),A(" 申请API Key ")],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},yr=Ee(gr,[["__scopeId","data-v-37e52c0a"]]),_r={class:"event-management"},wr={class:"page-header"},br={class:"header-actions"},Sr={class:"card-header"},Er={class:"header-info"},Ir={class:"pagination-wrapper"},Cr={class:"severity-stats"},Tr={class:"severity-label"},kr={class:"severity-count"},Ar={class:"severity-percentage"},xr={class:"device-stats"},Dr={class:"device-info"},Or={class:"device-id"},Mr={class:"device-user"},Rr={class:"device-count"},Lr={key:0,class:"event-detail"},Pr={__name:"EventManagement",setup(e){Rt();const t=Kn(),n=zt(),o=R({deviceId:"",eventType:"",severity:"",timeRange:[]}),s=R({currentPage:1,pageSize:20,total:0}),r=R(!1),l=R(null),p=J(()=>n.devices),w=J(()=>{const f={LOW:0,MEDIUM:0,HIGH:0,CRITICAL:0};return t.events.forEach(c=>{f.hasOwnProperty(c.severity)&&f[c.severity]++}),f}),m=J(()=>{const f={};return t.events.forEach(c=>{f[c.deviceId]||(f[c.deviceId]={deviceId:c.deviceId,username:c.user?.username||"未知",eventCount:0}),f[c.deviceId].eventCount++}),Object.values(f).sort((c,M)=>M.eventCount-c.eventCount)}),u=async()=>{try{console.log("=== EventManagement: 开始加载事件列表 ===");const f={...I()};console.log("加载参数:",f);const c=await t.fetchEvents(f);console.log("=== EventManagement: 事件列表加载完成 ==="),console.log("响应数据:",c),console.log("当前事件数量:",t.events.length),console.log("事件列表:",t.events),s.value.total=c.total||0}catch(f){console.error("加载事件列表失败:",f),he.error("加载事件列表失败")}},_=async()=>{try{await n.fetchDevices()}catch(f){console.error("加载设备列表失败:",f)}},I=()=>{const f={};return o.value.deviceId&&(f.deviceId=o.value.deviceId),o.value.eventType&&(f.eventType=o.value.eventType),o.value.severity&&(f.severity=o.value.severity),o.value.timeRange&&o.value.timeRange.length===2&&(f.startTime=o.value.timeRange[0],f.endTime=o.value.timeRange[1]),f},C=()=>{s.value.currentPage=1,u()},v=()=>{o.value={deviceId:"",eventType:"",severity:"",timeRange:[]},s.value.currentPage=1,u()},g=()=>{u()},y=()=>{he.info("导出功能开发中...")},S=f=>{D(f)},D=f=>{l.value=f,r.value=!0},O=f=>{s.value.pageSize=f,s.value.currentPage=1,u()},z=f=>{s.value.currentPage=f,u()},V=f=>{u()},q=f=>f?new Date(f).toLocaleString():"未知",Y=f=>f?`${f.lat.toFixed(6)}, ${f.lng.toFixed(6)}`:"未知",ne=f=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[f]||"未知事件",ee=f=>({FATIGUE:"warning",DISTRACTION:"danger",EMERGENCY:"danger"})[f]||"info",ue=f=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[f]||"未知",me=f=>({LOW:"success",MEDIUM:"warning",HIGH:"danger",CRITICAL:"danger"})[f]||"info",de=f=>{const c=t.events.length;return c===0?0:(f/c*100).toFixed(1)},ge=f=>{console.log("收到新事件推送:",f);const{type:c,payload:M}=f;if(c==="event"){const{deviceId:L,eventType:B,data:W,timestamp:x}=M,$={eventId:W.eventId||`EVENT_${Date.now()}`,deviceId:L,eventType:B,severity:W.severity||"MEDIUM",location:W.location,behavior:W.behavior,confidence:W.confidence,duration:W.duration,alertLevel:W.alertLevel,context:W.context,timestamp:new Date(x).toISOString(),user:{username:"实时推送"}};t.events.unshift($),he.success(`收到新事件: ${B}`);try{new Audio("/static/audio/alert_mid.mp3").play().catch(()=>{})}catch(Q){console.log("无法播放提示音:",Q)}}};return Be(()=>{_(),u(),te.on("event",ge);const f=setInterval(()=>{u()},3e5);He(()=>{clearInterval(f),te.off("event",ge)})}),(f,c)=>{const M=T("el-icon"),L=T("el-button"),B=T("el-option"),W=T("el-select"),x=T("el-form-item"),$=T("el-date-picker"),Q=T("el-form"),Z=T("el-card"),le=T("el-table-column"),ce=T("el-tag"),ke=T("el-table"),Ae=T("el-pagination"),Fe=T("el-col"),Ue=T("el-row"),fe=T("el-descriptions-item"),We=T("el-descriptions"),oe=T("el-dialog"),qe=Lt("loading");return P(),j("div",_r,[d("div",wr,[c[9]||(c[9]=d("h2",null,"事件管理",-1)),d("div",br,[a(L,{onClick:g},{default:i(()=>[a(M,null,{default:i(()=>[a(U(xe))]),_:1}),c[7]||(c[7]=A(" 刷新 ",-1))]),_:1}),a(L,{onClick:y},{default:i(()=>[a(M,null,{default:i(()=>[a(U(wo))]),_:1}),c[8]||(c[8]=A(" 导出 ",-1))]),_:1})])]),a(Z,{class:"filter-section",shadow:"hover"},{default:i(()=>[a(Q,{model:o.value,inline:""},{default:i(()=>[a(x,{label:"设备"},{default:i(()=>[a(W,{modelValue:o.value.deviceId,"onUpdate:modelValue":c[0]||(c[0]=F=>o.value.deviceId=F),placeholder:"选择设备",clearable:"",style:{width:"200px"}},{default:i(()=>[(P(!0),j(Le,null,Pe(p.value,F=>(P(),ie(B,{key:F.deviceId,label:`${F.deviceId} (${F.username})`,value:F.deviceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"事件类型"},{default:i(()=>[a(W,{modelValue:o.value.eventType,"onUpdate:modelValue":c[1]||(c[1]=F=>o.value.eventType=F),placeholder:"选择事件类型",clearable:"",style:{width:"150px"}},{default:i(()=>[a(B,{label:"疲劳检测",value:"FATIGUE"}),a(B,{label:"分心行为",value:"DISTRACTION"}),a(B,{label:"紧急事件",value:"EMERGENCY"})]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"严重程度"},{default:i(()=>[a(W,{modelValue:o.value.severity,"onUpdate:modelValue":c[2]||(c[2]=F=>o.value.severity=F),placeholder:"选择严重程度",clearable:"",style:{width:"150px"}},{default:i(()=>[a(B,{label:"轻微",value:"LOW"}),a(B,{label:"中等",value:"MEDIUM"}),a(B,{label:"严重",value:"HIGH"}),a(B,{label:"危急",value:"CRITICAL"})]),_:1},8,["modelValue"])]),_:1}),a(x,{label:"时间范围"},{default:i(()=>[a($,{modelValue:o.value.timeRange,"onUpdate:modelValue":c[3]||(c[3]=F=>o.value.timeRange=F),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),a(x,null,{default:i(()=>[a(L,{type:"primary",onClick:C},{default:i(()=>[a(M,null,{default:i(()=>[a(U(mn))]),_:1}),c[10]||(c[10]=A(" 搜索 ",-1))]),_:1}),a(L,{onClick:v},{default:i(()=>[a(M,null,{default:i(()=>[a(U(bo))]),_:1}),c[11]||(c[11]=A(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(Ue,{gutter:20},{default:i(()=>[a(Fe,{xs:24,sm:24,md:16,lg:16,xl:16},{default:i(()=>[a(Z,{class:"event-list-section",shadow:"hover"},{header:i(()=>[d("div",Sr,[c[12]||(c[12]=d("span",null,"事件列表",-1)),d("div",Er," 共 "+E(U(t).events.length)+" 条记录 ",1)])]),default:i(()=>[Pt((P(),ie(ke,{data:U(t).events,stripe:"",style:{width:"100%"},onRowClick:S},{default:i(()=>[a(le,{prop:"timestamp",label:"时间",width:"180"},{default:i(({row:F})=>[A(E(q(F.timestamp)),1)]),_:1}),a(le,{prop:"deviceId",label:"设备ID",width:"150"}),a(le,{prop:"username",label:"驾驶员",width:"120"},{default:i(({row:F})=>[A(E(F.user?.username||"未知"),1)]),_:1}),a(le,{prop:"eventType",label:"事件类型",width:"120"},{default:i(({row:F})=>[a(ce,{type:ee(F.eventType),size:"small"},{default:i(()=>[A(E(ne(F.eventType)),1)]),_:2},1032,["type"])]),_:1}),a(le,{prop:"severity",label:"严重程度",width:"100"},{default:i(({row:F})=>[a(ce,{type:me(F.severity),size:"small"},{default:i(()=>[A(E(ue(F.severity)),1)]),_:2},1032,["type"])]),_:1}),a(le,{prop:"confidence",label:"置信度",width:"100"},{default:i(({row:F})=>[A(E(F.confidence?(F.confidence*100).toFixed(1)+"%":"未知"),1)]),_:1}),a(le,{prop:"duration",label:"持续时间",width:"100"},{default:i(({row:F})=>[A(E(F.duration?F.duration+"秒":"未知"),1)]),_:1}),a(le,{prop:"context",label:"描述","min-width":"200","show-overflow-tooltip":""}),a(le,{label:"操作",width:"120",fixed:"right"},{default:i(({row:F})=>[a(L,{size:"small",onClick:un(De=>D(F),["stop"])},{default:i(()=>[...c[13]||(c[13]=[A(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[qe,U(t).loading]]),d("div",Ir,[a(Ae,{"current-page":s.value.currentPage,"onUpdate:currentPage":c[4]||(c[4]=F=>s.value.currentPage=F),"page-size":s.value.pageSize,"onUpdate:pageSize":c[5]||(c[5]=F=>s.value.pageSize=F),"page-sizes":[10,20,50,100],total:s.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:z},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),a(Fe,{xs:24,sm:24,md:8,lg:8,xl:8},{default:i(()=>[a(Z,{class:"statistics-section",shadow:"hover"},{header:i(()=>[...c[14]||(c[14]=[d("span",null,"事件统计图表",-1)])]),default:i(()=>[a(Sn,{data:U(t).events,loading:U(t).loading,onPeriodChange:V},null,8,["data","loading"])]),_:1}),a(Z,{class:"severity-section",shadow:"hover"},{header:i(()=>[...c[15]||(c[15]=[d("span",null,"严重程度分布",-1)])]),default:i(()=>[d("div",Cr,[(P(!0),j(Le,null,Pe(w.value,(F,De)=>(P(),j("div",{key:De,class:"severity-item"},[d("div",Tr,[a(ce,{type:me(De),size:"small"},{default:i(()=>[A(E(ue(De)),1)]),_:2},1032,["type"])]),d("div",kr,E(F),1),d("div",Ar,E(de(F))+"% ",1)]))),128))])]),_:1}),a(Z,{class:"device-stats-section",shadow:"hover"},{header:i(()=>[...c[16]||(c[16]=[d("span",null,"设备事件统计",-1)])]),default:i(()=>[d("div",xr,[(P(!0),j(Le,null,Pe(m.value,F=>(P(),j("div",{key:F.deviceId,class:"device-stat-item"},[d("div",Dr,[d("div",Or,E(F.deviceId),1),d("div",Mr,E(F.username),1)]),d("div",Rr,E(F.eventCount),1)]))),128))])]),_:1})]),_:1})]),_:1}),a(oe,{modelValue:r.value,"onUpdate:modelValue":c[6]||(c[6]=F=>r.value=F),title:"事件详情",width:"800px"},{default:i(()=>[l.value?(P(),j("div",Lr,[a(We,{column:2,border:""},{default:i(()=>[a(fe,{label:"事件ID"},{default:i(()=>[A(E(l.value.eventId),1)]),_:1}),a(fe,{label:"设备ID"},{default:i(()=>[A(E(l.value.deviceId),1)]),_:1}),a(fe,{label:"驾驶员"},{default:i(()=>[A(E(l.value.user?.username||"未知"),1)]),_:1}),a(fe,{label:"联系方式"},{default:i(()=>[A(E(l.value.user?.phone||"未知"),1)]),_:1}),a(fe,{label:"事件类型"},{default:i(()=>[A(E(ne(l.value.eventType)),1)]),_:1}),a(fe,{label:"严重程度"},{default:i(()=>[A(E(ue(l.value.severity)),1)]),_:1}),a(fe,{label:"置信度"},{default:i(()=>[A(E((l.value.confidence*100).toFixed(1))+"%",1)]),_:1}),a(fe,{label:"持续时间"},{default:i(()=>[A(E(l.value.duration)+"秒",1)]),_:1}),a(fe,{label:"发生时间",span:2},{default:i(()=>[A(E(q(l.value.timestamp)),1)]),_:1}),a(fe,{label:"位置",span:2},{default:i(()=>[A(E(Y(l.value.location)),1)]),_:1}),a(fe,{label:"行为描述",span:2},{default:i(()=>[A(E(l.value.behavior),1)]),_:1}),a(fe,{label:"上下文",span:2},{default:i(()=>[A(E(l.value.context),1)]),_:1})]),_:1})])):we("",!0)]),_:1},8,["modelValue"])])}}},$r=Ee(Pr,[["__scopeId","data-v-74d57346"]]),Nr=[{path:"/",redirect:"/dashboard"},{path:"/dashboard",name:"Dashboard",component:Ol,meta:{title:"实时监控仪表板"}},{path:"/devices/:deviceId",name:"DeviceDetail",component:yr,meta:{title:"设备详情"}},{path:"/events",name:"EventManagement",component:$r,meta:{title:"事件管理"}},{path:"/alerts",name:"AlertCenter",component:()=>Ge(()=>import("./AlertCenter-DqcXjlyX.js"),__vite__mapDeps([0,1,2,3,4])),meta:{title:"告警中心"}},{path:"/analytics",name:"Analytics",component:()=>Ge(()=>import("./Analytics-D0sR7oBF.js"),__vite__mapDeps([5,2,1,3,6])),meta:{title:"数据分析"}},{path:"/users",name:"UserManagement",component:()=>Ge(()=>import("./UserManagement-sIcLpazW.js"),__vite__mapDeps([7,1,2,3,8])),meta:{title:"用户管理"}},{path:"/websocket-test",name:"WebSocketTest",component:()=>Ge(()=>import("./WebSocketTest-DwPzZszk.js"),__vite__mapDeps([9,1,2,3,10])),meta:{title:"WebSocket测试"}},{path:"/map-config-help",name:"MapConfigHelp",component:()=>Ge(()=>import("./MapConfigHelp-xktf-ILU.js"),__vite__mapDeps([11,1,2,3,12])),meta:{title:"地图配置帮助"}}],Jn=oo({history:so(),routes:Nr});Jn.beforeEach((e,t,n)=>{e.meta.title&&(document.title=`${e.meta.title} - Muse 云端实时检测平台`),n()});const tt=ao(Ro);for(const[e,t]of Object.entries(So))tt.component(e,t);tt.use(lo());tt.use(Jn);tt.use(Eo);tt.mount("#app");export{It as D,Sn as E,ts as F,Ct as H,ot as S,Ee as _,zt as a,Se as r,Kn as u,te as w};
