const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AlertCenter-B7xRL3qO.js","assets/vendor-BleAlWPf.js","assets/element-C3fiOSfn.js","assets/charts-TxDtCNV3.js","assets/AlertCenter-BHcmqX6g.css","assets/Analytics-wVHM7b_G.js","assets/Analytics-CwnDfLbI.css","assets/UserManagement-ZlSOaJUM.js","assets/UserManagement-DKxOPfbl.css","assets/WebSocketTest-BWRlERPs.js","assets/WebSocketTest-Cuq8cH5p.css","assets/MapConfigHelp-DS-svIgq.js","assets/MapConfigHelp-IbllU7-j.css"])))=>i.map(i=>d[i]);
import{r as L,c as G,ax as Ft,h as Ce,U as Te,z as W,A as F,R as r,J as c,al as C,B as v,u as z,I as ae,O as D,P as k,M as lt,E as ze,L as ge,j as Ie,n as Ut,ay as mt,az as vt,ar as ht,K as gt,W as Vt,Q as je,a6 as He,aA as bn,aB as Sn,au as En,aC as In}from"./vendor-BleAlWPf.js";import{m as Cn,w as Tn,b as kn,d as An,u as Rn,c as Dn,a as On,s as xn,i as Mn,e as Bt,f as Pn,l as zt,E as pe,r as be,g as Ln,h as jt,j as Ht,v as Nn,k as $n,n as Fn,o as Un,p as Vn,q as Bn}from"./element-C3fiOSfn.js";import{u as zn,E as jn,i as Hn,a as qn,b as Wn,c as Kn,d as Gn,e as Jn,f as Yn}from"./charts-TxDtCNV3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();class Xn{constructor(){this.socket=null,this.stompClient=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=5e3,this.listeners=new Map}connect(){const t="ws://spacemit.topcoder.fun/websocket";try{this.loadDependencies().then(()=>{this.createSTOMPConnection(t)}).catch(n=>{console.error("加载依赖失败:",n),this.emit("error",n)})}catch(n){console.error("WebSocket连接失败:",n),this.emit("error",n);return}}loadDependencies(){return new Promise((t,n)=>{const o=[];if(window.SockJS||o.push(this.loadScript("https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js")),window.Stomp||o.push(this.loadScript("https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js")),o.length===0){t();return}Promise.all(o).then(t).catch(n)})}loadScript(t){return new Promise((n,o)=>{const s=document.createElement("script");s.src=t,s.onload=n,s.onerror=o,document.head.appendChild(s)})}createSTOMPConnection(t){try{console.log("创建STOMP连接:",t),this.socket=new window.SockJS(t),this.stompClient=window.Stomp.over(this.socket),this.stompClient.debug=null,this.stompClient.connect({},n=>{console.log("WebSocket连接成功:",n),this.isConnected=!0,this.reconnectAttempts=0,this.subscribeToTopics(),this.emit("connected",n)},n=>{console.error("WebSocket连接失败:",n),this.isConnected=!1,this.handleReconnect()})}catch(n){console.error("STOMP连接失败:",n),this.emit("error",n)}}subscribeToTopics(){console.log("开始订阅WebSocket主题..."),this.stompClient.subscribe("/topic/realtime_data",t=>{try{const n=JSON.parse(t.body);console.log("收到实时数据推送:",n),this.emit("realtime_data",n)}catch(n){console.error("解析实时数据失败:",n)}}),this.stompClient.subscribe("/topic/device_status",t=>{try{const n=JSON.parse(t.body);console.log("收到设备状态更新:",n),this.emit("device_status",n)}catch(n){console.error("解析设备状态更新失败:",n)}}),this.stompClient.subscribe("/topic/alert",t=>{try{const n=JSON.parse(t.body);console.log("收到告警推送:",n),this.emit("alert",n)}catch(n){console.error("解析告警推送失败:",n)}}),this.stompClient.subscribe("/topic/event",t=>{try{const n=JSON.parse(t.body);console.log("收到事件通知:",n),this.emit("event",n)}catch(n){console.error("解析事件通知失败:",n)}}),console.log("WebSocket主题订阅完成")}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`尝试重连 (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},this.reconnectInterval)):(console.error("达到最大重连次数，停止重连"),this.emit("max_reconnect_attempts"))}disconnect(){this.stompClient&&this.isConnected&&this.stompClient.disconnect(()=>{console.log("WebSocket连接已断开"),this.isConnected=!1,this.emit("disconnected")})}send(t,n,o={}){this.stompClient&&this.isConnected?this.stompClient.send(t,o,JSON.stringify(n)):console.warn("WebSocket未连接，无法发送消息")}on(t,n){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n)}off(t,n){if(this.listeners.has(t)){const o=this.listeners.get(t),s=o.indexOf(n);s>-1&&o.splice(s,1)}}emit(t,n){this.listeners.has(t)&&this.listeners.get(t).forEach(o=>{try{o(n)}catch(s){console.error(`事件处理器执行失败 (${t}):`,s)}})}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts}}}const ee=new Xn,he=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},Qn={id:"app"},Zn={class:"header-content"},eo={class:"header-actions"},to={__name:"App",setup(e){const t=Ft(),n=L(!1),o=L(!1),s=L(!1),l=G(()=>t.path),a=L(new Date().toLocaleString()),f=L("production"),E=L("http://spacemit.topcoder.fun"),p=()=>{n.value=!n.value,document.documentElement.classList.toggle("dark",n.value),localStorage.setItem("theme",n.value?"dark":"light")},u=()=>{o.value=!0},h=T=>{s.value=T};return Ce(()=>{localStorage.getItem("theme")==="dark"&&(n.value=!0,document.documentElement.classList.add("dark")),ee.on("connected",()=>h(!0)),ee.on("disconnected",()=>h(!1)),s.value=ee.getConnectionStatus().isConnected}),Te(()=>{ee.off("connected",h),ee.off("disconnected",h)}),(T,O)=>{const b=C("el-icon"),g=C("el-menu-item"),y=C("el-menu"),I=C("el-button"),A=C("el-header"),M=C("RouterView"),V=C("el-main"),B=C("el-descriptions-item"),q=C("el-tag"),K=C("el-descriptions"),J=C("el-dialog");return F(),W("div",Qn,[r(A,{class:"app-header"},{default:c(()=>[v("div",Zn,[O[7]||(O[7]=v("div",{class:"logo"},[v("h1",null,"Muse 云端实时检测平台")],-1)),r(y,{"default-active":l.value,mode:"horizontal",router:"",class:"header-menu"},{default:c(()=>[r(g,{index:"/"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(Cn))]),_:1}),O[1]||(O[1]=v("span",null,"仪表板",-1))]),_:1}),r(g,{index:"/events"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(Tn))]),_:1}),O[2]||(O[2]=v("span",null,"事件管理",-1))]),_:1}),r(g,{index:"/alerts"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(kn))]),_:1}),O[3]||(O[3]=v("span",null,"告警中心",-1))]),_:1}),r(g,{index:"/analytics"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(An))]),_:1}),O[4]||(O[4]=v("span",null,"数据分析",-1))]),_:1}),r(g,{index:"/users"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(Rn))]),_:1}),O[5]||(O[5]=v("span",null,"用户管理",-1))]),_:1}),r(g,{index:"/websocket-test"},{default:c(()=>[r(b,null,{default:c(()=>[r(z(Dn))]),_:1}),O[6]||(O[6]=v("span",null,"连接测试",-1))]),_:1})]),_:1},8,["default-active"]),v("div",eo,[r(I,{size:"small",onClick:p},{default:c(()=>[r(b,null,{default:c(()=>[n.value?(F(),ae(z(On),{key:0})):(F(),ae(z(xn),{key:1}))]),_:1})]),_:1}),r(I,{size:"small",onClick:u},{default:c(()=>[r(b,null,{default:c(()=>[r(z(Mn))]),_:1})]),_:1})])])]),_:1}),r(V,{class:"app-main"},{default:c(()=>[r(M)]),_:1}),r(J,{modelValue:o.value,"onUpdate:modelValue":O[0]||(O[0]=X=>o.value=X),title:"系统信息",width:"500px"},{default:c(()=>[r(K,{column:1,border:""},{default:c(()=>[r(B,{label:"系统版本"},{default:c(()=>[...O[8]||(O[8]=[D("v1.0.0",-1)])]),_:1}),r(B,{label:"构建时间"},{default:c(()=>[D(k(a.value),1)]),_:1}),r(B,{label:"运行环境"},{default:c(()=>[D(k(f.value),1)]),_:1}),r(B,{label:"API地址"},{default:c(()=>[D(k(E.value),1)]),_:1}),r(B,{label:"WebSocket状态"},{default:c(()=>[r(q,{type:s.value?"success":"danger"},{default:c(()=>[D(k(s.value?"已连接":"未连接"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},no=he(to,[["__scopeId","data-v-ce294a2b"]]),oo="modulepreload",so=function(e){return"/"+e},St={},Oe=function(t,n,o){let s=Promise.resolve();if(n&&n.length>0){let E=function(p){return Promise.all(p.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),f=a?.nonce||a?.getAttribute("nonce");s=E(n.map(p=>{if(p=so(p),p in St)return;St[p]=!0;const u=p.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${h}`))return;const T=document.createElement("link");if(T.rel=u?"stylesheet":oo,u||(T.as="script"),T.crossOrigin="",T.href=p,f&&T.setAttribute("nonce",f),document.head.appendChild(T),u)return new Promise((O,b)=>{T.addEventListener("load",O),T.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${p}`)))})}))}function l(a){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=a,window.dispatchEvent(f),!f.defaultPrevented)throw a}return s.then(a=>{for(const f of a||[])f.status==="rejected"&&l(f.reason);return t().catch(l)})},ao={class:"stat-content"},ro={class:"stat-value"},lo={class:"stat-label"},io={key:0,class:"stat-trend"},co={__name:"StatCard",props:{title:{type:String,required:!0},value:{type:[Number,String],required:!0},icon:{type:String,required:!0},color:{type:String,default:"primary",validator:e=>["primary","success","warning","danger","info"].includes(e)},suffix:{type:String,default:""},trend:{type:Number,default:void 0}},setup(e){const t=e,n=G(()=>typeof t.value=="number"?t.value.toLocaleString():t.value),o=G(()=>`stat-card--${t.color}`),s=G(()=>`stat-icon--${t.color}`),l=G(()=>t.trend>0?"trend-up":"trend-down");return(a,f)=>{const E=C("el-icon");return F(),W("div",{class:ze(["stat-card",o.value])},[v("div",{class:ze(["stat-icon",s.value])},[r(E,null,{default:c(()=>[(F(),ae(lt(e.icon)))]),_:1})],2),v("div",ao,[v("div",ro,k(n.value)+k(e.suffix),1),v("div",lo,k(e.title),1),e.trend!==void 0?(F(),W("div",io,[r(E,{class:ze(l.value)},{default:c(()=>[(F(),ae(lt(e.trend>0?"ArrowUp":"ArrowDown")))]),_:1},8,["class"]),v("span",null,k(Math.abs(e.trend))+"%",1)])):ge("",!0)])],2)}}},Be=he(co,[["__scopeId","data-v-03a24230"]]),uo={__name:"DeviceStatusTag",props:{status:{type:String,required:!0,validator:e=>["ONLINE","OFFLINE","LOST"].includes(e)},effect:{type:String,default:"light",validator:e=>["dark","light","plain"].includes(e)}},setup(e){const t=e,n={ONLINE:{type:"success",icon:"CircleCheck",text:"在线"},OFFLINE:{type:"info",icon:"CircleClose",text:"离线"},LOST:{type:"danger",icon:"Warning",text:"失联"}},o=G(()=>n[t.status]?.type||"info"),s=G(()=>n[t.status]?.icon||"CircleClose"),l=G(()=>n[t.status]?.text||"未知");return(a,f)=>{const E=C("el-icon"),p=C("el-tag");return F(),ae(p,{type:o.value,effect:e.effect,size:"small"},{default:c(()=>[r(E,{class:"status-icon"},{default:c(()=>[(F(),ae(lt(s.value)))]),_:1}),D(" "+k(l.value),1)]),_:1},8,["type","effect"])}}},qt=he(uo,[["__scopeId","data-v-2e81de45"]]),po={class:"health-progress"},fo={__name:"HealthProgress",props:{score:{type:Number,required:!0,validator:e=>e>=0&&e<=100}},setup(e){const t=e,n=G(()=>Math.round(t.score)),o=G(()=>t.score>=80?"#67C23A":t.score>=60?"#E6A23C":"#F56C6C"),s=G(()=>t.score>=80?"text-success":t.score>=60?"text-warning":"text-danger");return(l,a)=>{const f=C("el-progress");return F(),W("div",po,[r(f,{percentage:n.value,color:o.value,"stroke-width":8,"show-text":!1},null,8,["percentage","color"]),v("span",{class:ze(["health-text",s.value])},k(n.value)+"%",3)])}}},Wt=he(fo,[["__scopeId","data-v-ada9c17b"]]),mo={class:"map-controls"},vo={key:0,class:"map-error"},ho={key:1,class:"map-loading"},se=3.141592653589793,Et=6378245,It=.006693421622965943,go={__name:"SimpleMap",props:{devices:{type:Array,default:()=>[]},center:{type:Object,default:()=>({lat:33.553733,lng:119.030953})},zoom:{type:Number,default:10}},emits:["device-click","map-ready"],setup(e,{expose:t,emit:n}){const o=e,s=n,l=L(null),a=L(!1),f=L(""),E=L("");let p=null,u=[],h=null;function T(d,i){let w=-100+2*d+3*i+.2*i*i+.1*d*i+.2*Math.sqrt(Math.abs(d));return w+=(20*Math.sin(6*d*se)+20*Math.sin(2*d*se))*2/3,w+=(20*Math.sin(i*se)+40*Math.sin(i/3*se))*2/3,w+=(160*Math.sin(i/12*se)+320*Math.sin(i*se/30))*2/3,w}function O(d,i){let w=300+d+2*i+.1*d*d+.1*d*i+.1*Math.sqrt(Math.abs(d));return w+=(20*Math.sin(6*d*se)+20*Math.sin(2*d*se))*2/3,w+=(20*Math.sin(d*se)+40*Math.sin(d/3*se))*2/3,w+=(150*Math.sin(d/12*se)+300*Math.sin(d/30*se))*2/3,w}function b(d,i){return d<72.004||d>137.8347||i<.8293||i>55.8271||!1}function g(d,i){if(b(d,i))return[d,i];{let w=T(d-105,i-35),_=O(d-105,i-35);const x=i/180*se;let P=Math.sin(x);P=1-It*P*P;const S=Math.sqrt(P);w=w*180/(Et*(1-It)/(P*S)*se),_=_*180/(Et/S*Math.cos(x)*se);const R=i+w;return[d+_,R]}}const y=L(""),I=()=>{const d="732a364f70864bb0c4ac3395cc3d5503";localStorage.getItem("amap_api_key"),y.value=d},A=async()=>{if(console.log("开始初始化地图..."),console.log("API Key:",y.value?"已配置":"未配置"),console.log("地图容器:",l.value),!y.value){f.value="高德地图API key未配置";return}if(!l.value){f.value="地图容器未找到";return}a.value=!0,f.value="";try{if(window.AMap||(console.log("加载高德地图API..."),await M()),!window.AMap)throw new Error("高德地图API加载失败");console.log("AMap已加载，开始创建地图实例..."),console.log("地图容器尺寸:",l.value.offsetWidth,"x",l.value.offsetHeight),p=new window.AMap.Map(l.value,{center:[o.center.lng,o.center.lat],zoom:o.zoom,mapStyle:"amap://styles/normal"}),console.log("地图实例创建成功"),h=new window.AMap.InfoWindow({offset:new window.AMap.Pixel(0,-30)}),p.on("complete",()=>{console.log("地图加载完成"),p.on("click",()=>{h&&h.close()}),s("map-ready",p),V(),a.value=!1})}catch(d){console.error("地图初始化失败:",d),f.value=d.message||"地图初始化失败",a.value=!1}},M=()=>new Promise((d,i)=>{if(window.AMap){d();return}const w=localStorage.getItem("amap_version")||"1.4.15",_=document.createElement("script");_.src=`https://webapi.amap.com/maps?v=${w}&key=${y.value}`,_.onload=()=>{const x=()=>{window.AMap&&window.AMap.Map?d():setTimeout(x,100)};x()},_.onerror=()=>{i(new Error("高德地图API加载失败"))},document.head.appendChild(_)}),V=()=>{if(!p)return;console.log("=== 更新地图标记 ==="),console.log("所有设备:",o.devices),console.log("当前筛选状态:",E.value),u.forEach(i=>p.remove(i)),u=[];const d=o.devices.filter(i=>{if(console.log(`检查设备 ${i.deviceId}:`,{status:i.status,hasLocation:!!(i.location&&i.location.lat&&i.location.lng),location:i.location}),E.value&&i.status!==E.value)return console.log(`设备 ${i.deviceId} 状态不匹配，跳过`),!1;const w=i.location&&i.location.lat&&i.location.lng;return w||console.log(`设备 ${i.deviceId} 没有有效位置信息，跳过`),w});console.log("筛选后的设备:",d),d.forEach((i,w)=>{if(i.location&&i.location.lat&&i.location.lng){const[_,x]=g(i.location.lng,i.location.lat),P=new window.AMap.Marker({position:[_,x],title:`${i.deviceId} - ${i.username||"未知用户"}`,icon:B(i.status,w),anchor:"center",label:{content:`${i.deviceId}<br/>${i.username||"未知用户"}<br/>${q(i.status)}`,direction:"bottom",offset:new window.AMap.Pixel(0,10),style:{backgroundColor:K(i.status),color:"#fff",fontSize:"12px",padding:"4px 8px",borderRadius:"4px",border:"1px solid #fff"}}});P.on("click",()=>{J(i,P),s("device-click",i)}),u.push(P),p.add(P)}}),d.length>0&&p.setFitView(u)},B=(d,i)=>{const w=["#67C23A","#E6A23C","#F56C6C","#409EFF","#909399","#9C27B0","#FF9800","#4CAF50"],_=w[i%w.length];return new window.AMap.Icon({size:new window.AMap.Size(32,32),image:`data:image/svg+xml;base64,${btoa(`
      <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <circle cx="16" cy="16" r="12" fill="${_}" stroke="#fff" stroke-width="2"/>
        <circle cx="16" cy="16" r="4" fill="#fff"/>
        <text x="16" y="20" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">${i+1}</text>
      </svg>
    `)}`,imageSize:new window.AMap.Size(32,32)})},q=d=>({ONLINE:"在线",OFFLINE:"离线",LOST:"失联"})[d]||"未知",K=d=>({ONLINE:"#67C23A",OFFLINE:"#909399",LOST:"#F56C6C"})[d]||"#909399",J=(d,i)=>{const[w,_]=g(d.location.lng,d.location.lat),x=`
    <div class="device-info-window">
      <h4>${d.deviceId}</h4>
      <p><strong>驾驶员:</strong> ${d.username||"未知"}</p>
      <p><strong>状态:</strong> <span style="color: ${K(d.status)}">${q(d.status)}</span></p>
      <p><strong>健康度:</strong> ${d.healthScore||0}%</p>
      <p><strong>最后心跳:</strong> ${X(d.lastSeen)}</p>
      <hr style="margin: 8px 0;">
      <p><strong>原始坐标 (WGS-84):</strong></p>
      <p>经度: ${d.location.lng.toFixed(6)}</p>
      <p>纬度: ${d.location.lat.toFixed(6)}</p>
      <p><strong>校准坐标 (GCJ-02):</strong></p>
      <p>经度: ${w.toFixed(6)}</p>
      <p>纬度: ${_.toFixed(6)}</p>
    </div>
  `;h.setContent(x),h.open(p,i.getPosition())},X=d=>{if(!d)return"未知";const i=new Date(d),_=new Date-i,x=Math.floor(_/6e4);if(x<1)return"刚刚";if(x<60)return`${x}分钟前`;const P=Math.floor(x/60);return P<24?`${P}小时前`:i.toLocaleDateString()},oe=()=>{p&&o.devices.length>0?p.setFitView(u):p&&p.setCenter([o.center.lng,o.center.lat])},ie=()=>{l.value.requestFullscreen&&l.value.requestFullscreen()},ce=()=>{f.value="",p&&(p.destroy(),p=null),A()},ue=()=>{console.log("强制刷新地图..."),p&&(p.destroy(),p=null),u=[],setTimeout(()=>{A()},100)};return Ie(()=>o.devices,V,{deep:!0}),Ie(()=>y.value,d=>{d&&!p&&A()}),Ce(()=>{I(),Ut(()=>{y.value&&A()})}),Te(()=>{p&&p.destroy()}),t({centerMap:oe,updateMarkers:V,forceRefresh:ue,getMap:()=>p}),(d,i)=>{const w=C("el-option"),_=C("el-select"),x=C("el-icon"),P=C("el-button"),S=C("el-button-group"),R=C("el-alert");return F(),W("div",{class:"simple-map",ref_key:"mapContainer",ref:l},[v("div",mo,[r(_,{modelValue:E.value,"onUpdate:modelValue":i[0]||(i[0]=j=>E.value=j),placeholder:"筛选设备状态",size:"small",clearable:"",style:{"margin-right":"10px",width:"150px"},onChange:V},{default:c(()=>[r(w,{label:"全部设备",value:""}),r(w,{label:"在线设备",value:"ONLINE"}),r(w,{label:"离线设备",value:"OFFLINE"}),r(w,{label:"失联设备",value:"LOST"})]),_:1},8,["modelValue"]),r(S,null,{default:c(()=>[r(P,{size:"small",onClick:oe},{default:c(()=>[r(x,null,{default:c(()=>[r(z(Bt))]),_:1}),i[1]||(i[1]=D(" 居中 ",-1))]),_:1}),r(P,{size:"small",onClick:ie},{default:c(()=>[r(x,null,{default:c(()=>[r(z(Pn))]),_:1}),i[2]||(i[2]=D(" 全屏 ",-1))]),_:1})]),_:1})]),f.value?(F(),W("div",vo,[r(R,{title:"地图加载失败",description:f.value,type:"error","show-icon":"",closable:!1},null,8,["description"]),r(P,{onClick:ce,style:{"margin-top":"10px"}},{default:c(()=>[...i[3]||(i[3]=[D("重试",-1)])]),_:1})])):ge("",!0),a.value?(F(),W("div",ho,[r(x,{class:"is-loading"},{default:c(()=>[r(z(zt))]),_:1}),i[4]||(i[4]=v("span",null,"地图加载中...",-1))])):ge("",!0)],512)}}},yo=he(go,[["__scopeId","data-v-33b90856"]]);function Kt(e,t){return function(){return e.apply(t,arguments)}}const{toString:_o}=Object.prototype,{getPrototypeOf:yt}=Object,{iterator:Ye,toStringTag:Gt}=Symbol,Xe=(e=>t=>{const n=_o.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),me=e=>(e=e.toLowerCase(),t=>Xe(t)===e),Qe=e=>t=>typeof t===e,{isArray:ke}=Array,Pe=Qe("undefined");function Le(e){return e!==null&&!Pe(e)&&e.constructor!==null&&!Pe(e.constructor)&&re(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Jt=me("ArrayBuffer");function wo(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Jt(e.buffer),t}const bo=Qe("string"),re=Qe("function"),Yt=Qe("number"),Ne=e=>e!==null&&typeof e=="object",So=e=>e===!0||e===!1,qe=e=>{if(Xe(e)!=="object")return!1;const t=yt(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Gt in e)&&!(Ye in e)},Eo=e=>{if(!Ne(e)||Le(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Io=me("Date"),Co=me("File"),To=me("Blob"),ko=me("FileList"),Ao=e=>Ne(e)&&re(e.pipe),Ro=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||re(e.append)&&((t=Xe(e))==="formdata"||t==="object"&&re(e.toString)&&e.toString()==="[object FormData]"))},Do=me("URLSearchParams"),[Oo,xo,Mo,Po]=["ReadableStream","Request","Response","Headers"].map(me),Lo=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function $e(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let o,s;if(typeof e!="object"&&(e=[e]),ke(e))for(o=0,s=e.length;o<s;o++)t.call(null,e[o],o,e);else{if(Le(e))return;const l=n?Object.getOwnPropertyNames(e):Object.keys(e),a=l.length;let f;for(o=0;o<a;o++)f=l[o],t.call(null,e[f],f,e)}}function Xt(e,t){if(Le(e))return null;t=t.toLowerCase();const n=Object.keys(e);let o=n.length,s;for(;o-- >0;)if(s=n[o],t===s.toLowerCase())return s;return null}const we=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Qt=e=>!Pe(e)&&e!==we;function it(){const{caseless:e}=Qt(this)&&this||{},t={},n=(o,s)=>{const l=e&&Xt(t,s)||s;qe(t[l])&&qe(o)?t[l]=it(t[l],o):qe(o)?t[l]=it({},o):ke(o)?t[l]=o.slice():t[l]=o};for(let o=0,s=arguments.length;o<s;o++)arguments[o]&&$e(arguments[o],n);return t}const No=(e,t,n,{allOwnKeys:o}={})=>($e(t,(s,l)=>{n&&re(s)?e[l]=Kt(s,n):e[l]=s},{allOwnKeys:o}),e),$o=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Fo=(e,t,n,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},Uo=(e,t,n,o)=>{let s,l,a;const f={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),l=s.length;l-- >0;)a=s[l],(!o||o(a,e,t))&&!f[a]&&(t[a]=e[a],f[a]=!0);e=n!==!1&&yt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},Vo=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const o=e.indexOf(t,n);return o!==-1&&o===n},Bo=e=>{if(!e)return null;if(ke(e))return e;let t=e.length;if(!Yt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},zo=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&yt(Uint8Array)),jo=(e,t)=>{const o=(e&&e[Ye]).call(e);let s;for(;(s=o.next())&&!s.done;){const l=s.value;t.call(e,l[0],l[1])}},Ho=(e,t)=>{let n;const o=[];for(;(n=e.exec(t))!==null;)o.push(n);return o},qo=me("HTMLFormElement"),Wo=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,o,s){return o.toUpperCase()+s}),Ct=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Ko=me("RegExp"),Zt=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),o={};$e(n,(s,l)=>{let a;(a=t(s,l,e))!==!1&&(o[l]=a||s)}),Object.defineProperties(e,o)},Go=e=>{Zt(e,(t,n)=>{if(re(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const o=e[n];if(re(o)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Jo=(e,t)=>{const n={},o=s=>{s.forEach(l=>{n[l]=!0})};return ke(e)?o(e):o(String(e).split(t)),n},Yo=()=>{},Xo=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function Qo(e){return!!(e&&re(e.append)&&e[Gt]==="FormData"&&e[Ye])}const Zo=e=>{const t=new Array(10),n=(o,s)=>{if(Ne(o)){if(t.indexOf(o)>=0)return;if(Le(o))return o;if(!("toJSON"in o)){t[s]=o;const l=ke(o)?[]:{};return $e(o,(a,f)=>{const E=n(a,s+1);!Pe(E)&&(l[f]=E)}),t[s]=void 0,l}}return o};return n(e,0)},es=me("AsyncFunction"),ts=e=>e&&(Ne(e)||re(e))&&re(e.then)&&re(e.catch),en=((e,t)=>e?setImmediate:t?((n,o)=>(we.addEventListener("message",({source:s,data:l})=>{s===we&&l===n&&o.length&&o.shift()()},!1),s=>{o.push(s),we.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",re(we.postMessage)),ns=typeof queueMicrotask<"u"?queueMicrotask.bind(we):typeof process<"u"&&process.nextTick||en,os=e=>e!=null&&re(e[Ye]),m={isArray:ke,isArrayBuffer:Jt,isBuffer:Le,isFormData:Ro,isArrayBufferView:wo,isString:bo,isNumber:Yt,isBoolean:So,isObject:Ne,isPlainObject:qe,isEmptyObject:Eo,isReadableStream:Oo,isRequest:xo,isResponse:Mo,isHeaders:Po,isUndefined:Pe,isDate:Io,isFile:Co,isBlob:To,isRegExp:Ko,isFunction:re,isStream:Ao,isURLSearchParams:Do,isTypedArray:zo,isFileList:ko,forEach:$e,merge:it,extend:No,trim:Lo,stripBOM:$o,inherits:Fo,toFlatObject:Uo,kindOf:Xe,kindOfTest:me,endsWith:Vo,toArray:Bo,forEachEntry:jo,matchAll:Ho,isHTMLForm:qo,hasOwnProperty:Ct,hasOwnProp:Ct,reduceDescriptors:Zt,freezeMethods:Go,toObjectSet:Jo,toCamelCase:Wo,noop:Yo,toFiniteNumber:Xo,findKey:Xt,global:we,isContextDefined:Qt,isSpecCompliantForm:Qo,toJSONObject:Zo,isAsyncFn:es,isThenable:ts,setImmediate:en,asap:ns,isIterable:os};function U(e,t,n,o,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),o&&(this.request=o),s&&(this.response=s,this.status=s.status?s.status:null)}m.inherits(U,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:m.toJSONObject(this.config),code:this.code,status:this.status}}});const tn=U.prototype,nn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{nn[e]={value:e}});Object.defineProperties(U,nn);Object.defineProperty(tn,"isAxiosError",{value:!0});U.from=(e,t,n,o,s,l)=>{const a=Object.create(tn);return m.toFlatObject(e,a,function(E){return E!==Error.prototype},f=>f!=="isAxiosError"),U.call(a,e.message,t,n,o,s),a.cause=e,a.name=e.name,l&&Object.assign(a,l),a};const ss=null;function ct(e){return m.isPlainObject(e)||m.isArray(e)}function on(e){return m.endsWith(e,"[]")?e.slice(0,-2):e}function Tt(e,t,n){return e?e.concat(t).map(function(s,l){return s=on(s),!n&&l?"["+s+"]":s}).join(n?".":""):t}function as(e){return m.isArray(e)&&!e.some(ct)}const rs=m.toFlatObject(m,{},null,function(t){return/^is[A-Z]/.test(t)});function Ze(e,t,n){if(!m.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=m.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,y){return!m.isUndefined(y[g])});const o=n.metaTokens,s=n.visitor||u,l=n.dots,a=n.indexes,E=(n.Blob||typeof Blob<"u"&&Blob)&&m.isSpecCompliantForm(t);if(!m.isFunction(s))throw new TypeError("visitor must be a function");function p(b){if(b===null)return"";if(m.isDate(b))return b.toISOString();if(m.isBoolean(b))return b.toString();if(!E&&m.isBlob(b))throw new U("Blob is not supported. Use a Buffer instead.");return m.isArrayBuffer(b)||m.isTypedArray(b)?E&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function u(b,g,y){let I=b;if(b&&!y&&typeof b=="object"){if(m.endsWith(g,"{}"))g=o?g:g.slice(0,-2),b=JSON.stringify(b);else if(m.isArray(b)&&as(b)||(m.isFileList(b)||m.endsWith(g,"[]"))&&(I=m.toArray(b)))return g=on(g),I.forEach(function(M,V){!(m.isUndefined(M)||M===null)&&t.append(a===!0?Tt([g],V,l):a===null?g:g+"[]",p(M))}),!1}return ct(b)?!0:(t.append(Tt(y,g,l),p(b)),!1)}const h=[],T=Object.assign(rs,{defaultVisitor:u,convertValue:p,isVisitable:ct});function O(b,g){if(!m.isUndefined(b)){if(h.indexOf(b)!==-1)throw Error("Circular reference detected in "+g.join("."));h.push(b),m.forEach(b,function(I,A){(!(m.isUndefined(I)||I===null)&&s.call(t,I,m.isString(A)?A.trim():A,g,T))===!0&&O(I,g?g.concat(A):[A])}),h.pop()}}if(!m.isObject(e))throw new TypeError("data must be an object");return O(e),t}function kt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(o){return t[o]})}function _t(e,t){this._pairs=[],e&&Ze(e,this,t)}const sn=_t.prototype;sn.append=function(t,n){this._pairs.push([t,n])};sn.toString=function(t){const n=t?function(o){return t.call(this,o,kt)}:kt;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function ls(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function an(e,t,n){if(!t)return e;const o=n&&n.encode||ls;m.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let l;if(s?l=s(t,n):l=m.isURLSearchParams(t)?t.toString():new _t(t,n).toString(o),l){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}class At{constructor(){this.handlers=[]}use(t,n,o){return this.handlers.push({fulfilled:t,rejected:n,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){m.forEach(this.handlers,function(o){o!==null&&t(o)})}}const rn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},is=typeof URLSearchParams<"u"?URLSearchParams:_t,cs=typeof FormData<"u"?FormData:null,us=typeof Blob<"u"?Blob:null,ds={isBrowser:!0,classes:{URLSearchParams:is,FormData:cs,Blob:us},protocols:["http","https","file","blob","url","data"]},wt=typeof window<"u"&&typeof document<"u",ut=typeof navigator=="object"&&navigator||void 0,ps=wt&&(!ut||["ReactNative","NativeScript","NS"].indexOf(ut.product)<0),fs=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ms=wt&&window.location.href||"http://localhost",vs=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wt,hasStandardBrowserEnv:ps,hasStandardBrowserWebWorkerEnv:fs,navigator:ut,origin:ms},Symbol.toStringTag,{value:"Module"})),ne={...vs,...ds};function hs(e,t){return Ze(e,new ne.classes.URLSearchParams,{visitor:function(n,o,s,l){return ne.isNode&&m.isBuffer(n)?(this.append(o,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...t})}function gs(e){return m.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ys(e){const t={},n=Object.keys(e);let o;const s=n.length;let l;for(o=0;o<s;o++)l=n[o],t[l]=e[l];return t}function ln(e){function t(n,o,s,l){let a=n[l++];if(a==="__proto__")return!0;const f=Number.isFinite(+a),E=l>=n.length;return a=!a&&m.isArray(s)?s.length:a,E?(m.hasOwnProp(s,a)?s[a]=[s[a],o]:s[a]=o,!f):((!s[a]||!m.isObject(s[a]))&&(s[a]=[]),t(n,o,s[a],l)&&m.isArray(s[a])&&(s[a]=ys(s[a])),!f)}if(m.isFormData(e)&&m.isFunction(e.entries)){const n={};return m.forEachEntry(e,(o,s)=>{t(gs(o),s,n,0)}),n}return null}function _s(e,t,n){if(m.isString(e))try{return(t||JSON.parse)(e),m.trim(e)}catch(o){if(o.name!=="SyntaxError")throw o}return(n||JSON.stringify)(e)}const Fe={transitional:rn,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const o=n.getContentType()||"",s=o.indexOf("application/json")>-1,l=m.isObject(t);if(l&&m.isHTMLForm(t)&&(t=new FormData(t)),m.isFormData(t))return s?JSON.stringify(ln(t)):t;if(m.isArrayBuffer(t)||m.isBuffer(t)||m.isStream(t)||m.isFile(t)||m.isBlob(t)||m.isReadableStream(t))return t;if(m.isArrayBufferView(t))return t.buffer;if(m.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let f;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return hs(t,this.formSerializer).toString();if((f=m.isFileList(t))||o.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return Ze(f?{"files[]":t}:t,E&&new E,this.formSerializer)}}return l||s?(n.setContentType("application/json",!1),_s(t)):t}],transformResponse:[function(t){const n=this.transitional||Fe.transitional,o=n&&n.forcedJSONParsing,s=this.responseType==="json";if(m.isResponse(t)||m.isReadableStream(t))return t;if(t&&m.isString(t)&&(o&&!this.responseType||s)){const a=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(t)}catch(f){if(a)throw f.name==="SyntaxError"?U.from(f,U.ERR_BAD_RESPONSE,this,null,this.response):f}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ne.classes.FormData,Blob:ne.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};m.forEach(["delete","get","head","post","put","patch"],e=>{Fe.headers[e]={}});const ws=m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),bs=e=>{const t={};let n,o,s;return e&&e.split(`
`).forEach(function(a){s=a.indexOf(":"),n=a.substring(0,s).trim().toLowerCase(),o=a.substring(s+1).trim(),!(!n||t[n]&&ws[n])&&(n==="set-cookie"?t[n]?t[n].push(o):t[n]=[o]:t[n]=t[n]?t[n]+", "+o:o)}),t},Rt=Symbol("internals");function xe(e){return e&&String(e).trim().toLowerCase()}function We(e){return e===!1||e==null?e:m.isArray(e)?e.map(We):String(e)}function Ss(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=n.exec(e);)t[o[1]]=o[2];return t}const Es=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function ot(e,t,n,o,s){if(m.isFunction(o))return o.call(this,t,n);if(s&&(t=n),!!m.isString(t)){if(m.isString(o))return t.indexOf(o)!==-1;if(m.isRegExp(o))return o.test(t)}}function Is(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,o)=>n.toUpperCase()+o)}function Cs(e,t){const n=m.toCamelCase(" "+t);["get","set","has"].forEach(o=>{Object.defineProperty(e,o+n,{value:function(s,l,a){return this[o].call(this,t,s,l,a)},configurable:!0})})}let le=class{constructor(t){t&&this.set(t)}set(t,n,o){const s=this;function l(f,E,p){const u=xe(E);if(!u)throw new Error("header name must be a non-empty string");const h=m.findKey(s,u);(!h||s[h]===void 0||p===!0||p===void 0&&s[h]!==!1)&&(s[h||E]=We(f))}const a=(f,E)=>m.forEach(f,(p,u)=>l(p,u,E));if(m.isPlainObject(t)||t instanceof this.constructor)a(t,n);else if(m.isString(t)&&(t=t.trim())&&!Es(t))a(bs(t),n);else if(m.isObject(t)&&m.isIterable(t)){let f={},E,p;for(const u of t){if(!m.isArray(u))throw TypeError("Object iterator must return a key-value pair");f[p=u[0]]=(E=f[p])?m.isArray(E)?[...E,u[1]]:[E,u[1]]:u[1]}a(f,n)}else t!=null&&l(n,t,o);return this}get(t,n){if(t=xe(t),t){const o=m.findKey(this,t);if(o){const s=this[o];if(!n)return s;if(n===!0)return Ss(s);if(m.isFunction(n))return n.call(this,s,o);if(m.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=xe(t),t){const o=m.findKey(this,t);return!!(o&&this[o]!==void 0&&(!n||ot(this,this[o],o,n)))}return!1}delete(t,n){const o=this;let s=!1;function l(a){if(a=xe(a),a){const f=m.findKey(o,a);f&&(!n||ot(o,o[f],f,n))&&(delete o[f],s=!0)}}return m.isArray(t)?t.forEach(l):l(t),s}clear(t){const n=Object.keys(this);let o=n.length,s=!1;for(;o--;){const l=n[o];(!t||ot(this,this[l],l,t,!0))&&(delete this[l],s=!0)}return s}normalize(t){const n=this,o={};return m.forEach(this,(s,l)=>{const a=m.findKey(o,l);if(a){n[a]=We(s),delete n[l];return}const f=t?Is(l):String(l).trim();f!==l&&delete n[l],n[f]=We(s),o[f]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return m.forEach(this,(o,s)=>{o!=null&&o!==!1&&(n[s]=t&&m.isArray(o)?o.join(", "):o)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const o=new this(t);return n.forEach(s=>o.set(s)),o}static accessor(t){const o=(this[Rt]=this[Rt]={accessors:{}}).accessors,s=this.prototype;function l(a){const f=xe(a);o[f]||(Cs(s,a),o[f]=!0)}return m.isArray(t)?t.forEach(l):l(t),this}};le.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);m.reduceDescriptors(le.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(o){this[n]=o}}});m.freezeMethods(le);function st(e,t){const n=this||Fe,o=t||n,s=le.from(o.headers);let l=o.data;return m.forEach(e,function(f){l=f.call(n,l,s.normalize(),t?t.status:void 0)}),s.normalize(),l}function cn(e){return!!(e&&e.__CANCEL__)}function Ae(e,t,n){U.call(this,e??"canceled",U.ERR_CANCELED,t,n),this.name="CanceledError"}m.inherits(Ae,U,{__CANCEL__:!0});function un(e,t,n){const o=n.config.validateStatus;!n.status||!o||o(n.status)?e(n):t(new U("Request failed with status code "+n.status,[U.ERR_BAD_REQUEST,U.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ts(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function ks(e,t){e=e||10;const n=new Array(e),o=new Array(e);let s=0,l=0,a;return t=t!==void 0?t:1e3,function(E){const p=Date.now(),u=o[l];a||(a=p),n[s]=E,o[s]=p;let h=l,T=0;for(;h!==s;)T+=n[h++],h=h%e;if(s=(s+1)%e,s===l&&(l=(l+1)%e),p-a<t)return;const O=u&&p-u;return O?Math.round(T*1e3/O):void 0}}function As(e,t){let n=0,o=1e3/t,s,l;const a=(p,u=Date.now())=>{n=u,s=null,l&&(clearTimeout(l),l=null),e(...p)};return[(...p)=>{const u=Date.now(),h=u-n;h>=o?a(p,u):(s=p,l||(l=setTimeout(()=>{l=null,a(s)},o-h)))},()=>s&&a(s)]}const Ge=(e,t,n=3)=>{let o=0;const s=ks(50,250);return As(l=>{const a=l.loaded,f=l.lengthComputable?l.total:void 0,E=a-o,p=s(E),u=a<=f;o=a;const h={loaded:a,total:f,progress:f?a/f:void 0,bytes:E,rate:p||void 0,estimated:p&&f&&u?(f-a)/p:void 0,event:l,lengthComputable:f!=null,[t?"download":"upload"]:!0};e(h)},n)},Dt=(e,t)=>{const n=e!=null;return[o=>t[0]({lengthComputable:n,total:e,loaded:o}),t[1]]},Ot=e=>(...t)=>m.asap(()=>e(...t)),Rs=ne.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,ne.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(ne.origin),ne.navigator&&/(msie|trident)/i.test(ne.navigator.userAgent)):()=>!0,Ds=ne.hasStandardBrowserEnv?{write(e,t,n,o,s,l){const a=[e+"="+encodeURIComponent(t)];m.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),m.isString(o)&&a.push("path="+o),m.isString(s)&&a.push("domain="+s),l===!0&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Os(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function xs(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function dn(e,t,n){let o=!Os(t);return e&&(o||n==!1)?xs(e,t):t}const xt=e=>e instanceof le?{...e}:e;function Ee(e,t){t=t||{};const n={};function o(p,u,h,T){return m.isPlainObject(p)&&m.isPlainObject(u)?m.merge.call({caseless:T},p,u):m.isPlainObject(u)?m.merge({},u):m.isArray(u)?u.slice():u}function s(p,u,h,T){if(m.isUndefined(u)){if(!m.isUndefined(p))return o(void 0,p,h,T)}else return o(p,u,h,T)}function l(p,u){if(!m.isUndefined(u))return o(void 0,u)}function a(p,u){if(m.isUndefined(u)){if(!m.isUndefined(p))return o(void 0,p)}else return o(void 0,u)}function f(p,u,h){if(h in t)return o(p,u);if(h in e)return o(void 0,p)}const E={url:l,method:l,data:l,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:f,headers:(p,u,h)=>s(xt(p),xt(u),h,!0)};return m.forEach(Object.keys({...e,...t}),function(u){const h=E[u]||s,T=h(e[u],t[u],u);m.isUndefined(T)&&h!==f||(n[u]=T)}),n}const pn=e=>{const t=Ee({},e);let{data:n,withXSRFToken:o,xsrfHeaderName:s,xsrfCookieName:l,headers:a,auth:f}=t;t.headers=a=le.from(a),t.url=an(dn(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),f&&a.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):"")));let E;if(m.isFormData(n)){if(ne.hasStandardBrowserEnv||ne.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((E=a.getContentType())!==!1){const[p,...u]=E?E.split(";").map(h=>h.trim()).filter(Boolean):[];a.setContentType([p||"multipart/form-data",...u].join("; "))}}if(ne.hasStandardBrowserEnv&&(o&&m.isFunction(o)&&(o=o(t)),o||o!==!1&&Rs(t.url))){const p=s&&l&&Ds.read(l);p&&a.set(s,p)}return t},Ms=typeof XMLHttpRequest<"u",Ps=Ms&&function(e){return new Promise(function(n,o){const s=pn(e);let l=s.data;const a=le.from(s.headers).normalize();let{responseType:f,onUploadProgress:E,onDownloadProgress:p}=s,u,h,T,O,b;function g(){O&&O(),b&&b(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let y=new XMLHttpRequest;y.open(s.method.toUpperCase(),s.url,!0),y.timeout=s.timeout;function I(){if(!y)return;const M=le.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),B={data:!f||f==="text"||f==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:M,config:e,request:y};un(function(K){n(K),g()},function(K){o(K),g()},B),y=null}"onloadend"in y?y.onloadend=I:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(I)},y.onabort=function(){y&&(o(new U("Request aborted",U.ECONNABORTED,e,y)),y=null)},y.onerror=function(){o(new U("Network Error",U.ERR_NETWORK,e,y)),y=null},y.ontimeout=function(){let V=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const B=s.transitional||rn;s.timeoutErrorMessage&&(V=s.timeoutErrorMessage),o(new U(V,B.clarifyTimeoutError?U.ETIMEDOUT:U.ECONNABORTED,e,y)),y=null},l===void 0&&a.setContentType(null),"setRequestHeader"in y&&m.forEach(a.toJSON(),function(V,B){y.setRequestHeader(B,V)}),m.isUndefined(s.withCredentials)||(y.withCredentials=!!s.withCredentials),f&&f!=="json"&&(y.responseType=s.responseType),p&&([T,b]=Ge(p,!0),y.addEventListener("progress",T)),E&&y.upload&&([h,O]=Ge(E),y.upload.addEventListener("progress",h),y.upload.addEventListener("loadend",O)),(s.cancelToken||s.signal)&&(u=M=>{y&&(o(!M||M.type?new Ae(null,e,y):M),y.abort(),y=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const A=Ts(s.url);if(A&&ne.protocols.indexOf(A)===-1){o(new U("Unsupported protocol "+A+":",U.ERR_BAD_REQUEST,e));return}y.send(l||null)})},Ls=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let o=new AbortController,s;const l=function(p){if(!s){s=!0,f();const u=p instanceof Error?p:this.reason;o.abort(u instanceof U?u:new Ae(u instanceof Error?u.message:u))}};let a=t&&setTimeout(()=>{a=null,l(new U(`timeout ${t} of ms exceeded`,U.ETIMEDOUT))},t);const f=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach(p=>{p.unsubscribe?p.unsubscribe(l):p.removeEventListener("abort",l)}),e=null)};e.forEach(p=>p.addEventListener("abort",l));const{signal:E}=o;return E.unsubscribe=()=>m.asap(f),E}},Ns=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let o=0,s;for(;o<n;)s=o+t,yield e.slice(o,s),o=s},$s=async function*(e,t){for await(const n of Fs(e))yield*Ns(n,t)},Fs=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:o}=await t.read();if(n)break;yield o}}finally{await t.cancel()}},Mt=(e,t,n,o)=>{const s=$s(e,t);let l=0,a,f=E=>{a||(a=!0,o&&o(E))};return new ReadableStream({async pull(E){try{const{done:p,value:u}=await s.next();if(p){f(),E.close();return}let h=u.byteLength;if(n){let T=l+=h;n(T)}E.enqueue(new Uint8Array(u))}catch(p){throw f(p),p}},cancel(E){return f(E),s.return()}},{highWaterMark:2})},et=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",fn=et&&typeof ReadableStream=="function",Us=et&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),mn=(e,...t)=>{try{return!!e(...t)}catch{return!1}},Vs=fn&&mn(()=>{let e=!1;const t=new Request(ne.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),Pt=64*1024,dt=fn&&mn(()=>m.isReadableStream(new Response("").body)),Je={stream:dt&&(e=>e.body)};et&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Je[t]&&(Je[t]=m.isFunction(e[t])?n=>n[t]():(n,o)=>{throw new U(`Response type '${t}' is not supported`,U.ERR_NOT_SUPPORT,o)})})})(new Response);const Bs=async e=>{if(e==null)return 0;if(m.isBlob(e))return e.size;if(m.isSpecCompliantForm(e))return(await new Request(ne.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(m.isArrayBufferView(e)||m.isArrayBuffer(e))return e.byteLength;if(m.isURLSearchParams(e)&&(e=e+""),m.isString(e))return(await Us(e)).byteLength},zs=async(e,t)=>{const n=m.toFiniteNumber(e.getContentLength());return n??Bs(t)},js=et&&(async e=>{let{url:t,method:n,data:o,signal:s,cancelToken:l,timeout:a,onDownloadProgress:f,onUploadProgress:E,responseType:p,headers:u,withCredentials:h="same-origin",fetchOptions:T}=pn(e);p=p?(p+"").toLowerCase():"text";let O=Ls([s,l&&l.toAbortSignal()],a),b;const g=O&&O.unsubscribe&&(()=>{O.unsubscribe()});let y;try{if(E&&Vs&&n!=="get"&&n!=="head"&&(y=await zs(u,o))!==0){let B=new Request(t,{method:"POST",body:o,duplex:"half"}),q;if(m.isFormData(o)&&(q=B.headers.get("content-type"))&&u.setContentType(q),B.body){const[K,J]=Dt(y,Ge(Ot(E)));o=Mt(B.body,Pt,K,J)}}m.isString(h)||(h=h?"include":"omit");const I="credentials"in Request.prototype;b=new Request(t,{...T,signal:O,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:o,duplex:"half",credentials:I?h:void 0});let A=await fetch(b,T);const M=dt&&(p==="stream"||p==="response");if(dt&&(f||M&&g)){const B={};["status","statusText","headers"].forEach(X=>{B[X]=A[X]});const q=m.toFiniteNumber(A.headers.get("content-length")),[K,J]=f&&Dt(q,Ge(Ot(f),!0))||[];A=new Response(Mt(A.body,Pt,K,()=>{J&&J(),g&&g()}),B)}p=p||"text";let V=await Je[m.findKey(Je,p)||"text"](A,e);return!M&&g&&g(),await new Promise((B,q)=>{un(B,q,{data:V,headers:le.from(A.headers),status:A.status,statusText:A.statusText,config:e,request:b})})}catch(I){throw g&&g(),I&&I.name==="TypeError"&&/Load failed|fetch/i.test(I.message)?Object.assign(new U("Network Error",U.ERR_NETWORK,e,b),{cause:I.cause||I}):U.from(I,I&&I.code,e,b)}}),pt={http:ss,xhr:Ps,fetch:js};m.forEach(pt,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const Lt=e=>`- ${e}`,Hs=e=>m.isFunction(e)||e===null||e===!1,vn={getAdapter:e=>{e=m.isArray(e)?e:[e];const{length:t}=e;let n,o;const s={};for(let l=0;l<t;l++){n=e[l];let a;if(o=n,!Hs(n)&&(o=pt[(a=String(n)).toLowerCase()],o===void 0))throw new U(`Unknown adapter '${a}'`);if(o)break;s[a||"#"+l]=o}if(!o){const l=Object.entries(s).map(([f,E])=>`adapter ${f} `+(E===!1?"is not supported by the environment":"is not available in the build"));let a=t?l.length>1?`since :
`+l.map(Lt).join(`
`):" "+Lt(l[0]):"as no adapter specified";throw new U("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return o},adapters:pt};function at(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ae(null,e)}function Nt(e){return at(e),e.headers=le.from(e.headers),e.data=st.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),vn.getAdapter(e.adapter||Fe.adapter)(e).then(function(o){return at(e),o.data=st.call(e,e.transformResponse,o),o.headers=le.from(o.headers),o},function(o){return cn(o)||(at(e),o&&o.response&&(o.response.data=st.call(e,e.transformResponse,o.response),o.response.headers=le.from(o.response.headers))),Promise.reject(o)})}const hn="1.11.0",tt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{tt[e]=function(o){return typeof o===e||"a"+(t<1?"n ":" ")+e}});const $t={};tt.transitional=function(t,n,o){function s(l,a){return"[Axios v"+hn+"] Transitional option '"+l+"'"+a+(o?". "+o:"")}return(l,a,f)=>{if(t===!1)throw new U(s(a," has been removed"+(n?" in "+n:"")),U.ERR_DEPRECATED);return n&&!$t[a]&&($t[a]=!0,console.warn(s(a," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(l,a,f):!0}};tt.spelling=function(t){return(n,o)=>(console.warn(`${o} is likely a misspelling of ${t}`),!0)};function qs(e,t,n){if(typeof e!="object")throw new U("options must be an object",U.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let s=o.length;for(;s-- >0;){const l=o[s],a=t[l];if(a){const f=e[l],E=f===void 0||a(f,l,e);if(E!==!0)throw new U("option "+l+" must be "+E,U.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new U("Unknown option "+l,U.ERR_BAD_OPTION)}}const Ke={assertOptions:qs,validators:tt},ve=Ke.validators;let Se=class{constructor(t){this.defaults=t||{},this.interceptors={request:new At,response:new At}}async request(t,n){try{return await this._request(t,n)}catch(o){if(o instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const l=s.stack?s.stack.replace(/^.+\n/,""):"";try{o.stack?l&&!String(o.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+l):o.stack=l}catch{}}throw o}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=Ee(this.defaults,n);const{transitional:o,paramsSerializer:s,headers:l}=n;o!==void 0&&Ke.assertOptions(o,{silentJSONParsing:ve.transitional(ve.boolean),forcedJSONParsing:ve.transitional(ve.boolean),clarifyTimeoutError:ve.transitional(ve.boolean)},!1),s!=null&&(m.isFunction(s)?n.paramsSerializer={serialize:s}:Ke.assertOptions(s,{encode:ve.function,serialize:ve.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Ke.assertOptions(n,{baseUrl:ve.spelling("baseURL"),withXsrfToken:ve.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let a=l&&m.merge(l.common,l[n.method]);l&&m.forEach(["delete","get","head","post","put","patch","common"],b=>{delete l[b]}),n.headers=le.concat(a,l);const f=[];let E=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(n)===!1||(E=E&&g.synchronous,f.unshift(g.fulfilled,g.rejected))});const p=[];this.interceptors.response.forEach(function(g){p.push(g.fulfilled,g.rejected)});let u,h=0,T;if(!E){const b=[Nt.bind(this),void 0];for(b.unshift(...f),b.push(...p),T=b.length,u=Promise.resolve(n);h<T;)u=u.then(b[h++],b[h++]);return u}T=f.length;let O=n;for(h=0;h<T;){const b=f[h++],g=f[h++];try{O=b(O)}catch(y){g.call(this,y);break}}try{u=Nt.call(this,O)}catch(b){return Promise.reject(b)}for(h=0,T=p.length;h<T;)u=u.then(p[h++],p[h++]);return u}getUri(t){t=Ee(this.defaults,t);const n=dn(t.baseURL,t.url,t.allowAbsoluteUrls);return an(n,t.params,t.paramsSerializer)}};m.forEach(["delete","get","head","options"],function(t){Se.prototype[t]=function(n,o){return this.request(Ee(o||{},{method:t,url:n,data:(o||{}).data}))}});m.forEach(["post","put","patch"],function(t){function n(o){return function(l,a,f){return this.request(Ee(f||{},{method:t,headers:o?{"Content-Type":"multipart/form-data"}:{},url:l,data:a}))}}Se.prototype[t]=n(),Se.prototype[t+"Form"]=n(!0)});let Ws=class gn{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const o=this;this.promise.then(s=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](s);o._listeners=null}),this.promise.then=s=>{let l;const a=new Promise(f=>{o.subscribe(f),l=f}).then(s);return a.cancel=function(){o.unsubscribe(l)},a},t(function(l,a,f){o.reason||(o.reason=new Ae(l,a,f),n(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=o=>{t.abort(o)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new gn(function(s){t=s}),cancel:t}}};function Ks(e){return function(n){return e.apply(null,n)}}function Gs(e){return m.isObject(e)&&e.isAxiosError===!0}const ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ft).forEach(([e,t])=>{ft[t]=e});function yn(e){const t=new Se(e),n=Kt(Se.prototype.request,t);return m.extend(n,Se.prototype,t,{allOwnKeys:!0}),m.extend(n,t,null,{allOwnKeys:!0}),n.create=function(s){return yn(Ee(e,s))},n}const Y=yn(Fe);Y.Axios=Se;Y.CanceledError=Ae;Y.CancelToken=Ws;Y.isCancel=cn;Y.VERSION=hn;Y.toFormData=Ze;Y.AxiosError=U;Y.Cancel=Y.CanceledError;Y.all=function(t){return Promise.all(t)};Y.spread=Ks;Y.isAxiosError=Gs;Y.mergeConfig=Ee;Y.AxiosHeaders=le;Y.formToJSON=e=>ln(m.isHTMLForm(e)?new FormData(e):e);Y.getAdapter=vn.getAdapter;Y.HttpStatusCode=ft;Y.default=Y;const{Axios:br,AxiosError:Sr,CanceledError:Er,isCancel:Ir,CancelToken:Cr,VERSION:Tr,all:kr,Cancel:Ar,isAxiosError:Rr,spread:Dr,toFormData:Or,AxiosHeaders:xr,HttpStatusCode:Mr,formToJSON:Pr,getAdapter:Lr,mergeConfig:Nr}=Y,fe=Y.create({baseURL:"http://spacemit.topcoder.fun",timeout:1e4,headers:{"Content-Type":"application/json"}});fe.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),console.log("API请求:",e.method?.toUpperCase(),e.url),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e)));fe.interceptors.response.use(e=>{const{data:t}=e;if(t.code!==void 0)if(t.code===200||t.code===0){console.log("=== API响应拦截器 ==="),console.log("原始响应:",t),console.log("data.data:",t.data),console.log("data.data.events:",t.data?.events),console.log("data.data.events长度:",t.data?.events?.length);const n=t.data||t;return console.log("最终返回数据:",n),console.log("最终返回的events:",n.events),console.log("最终返回的events长度:",n.events?.length),n}else return pe.error(t.message||"请求失败"),Promise.reject(new Error(t.message||"请求失败"));return t},e=>{console.error("API响应错误:",e);let t="网络错误";if(e.response){const{status:n,data:o}=e.response;switch(n){case 401:t="未授权，请重新登录",localStorage.removeItem("auth_token");break;case 403:t="拒绝访问";break;case 404:t="请求的资源不存在";break;case 500:t="服务器内部错误";break;default:t=o?.message||`请求失败 (${n})`}}else e.code==="ECONNABORTED"?t="请求超时":e.message&&(t=e.message);return pe.error(t),Promise.reject(e)});const Me={getDevices(e={}){return console.log("=== API调用: 获取设备列表 ==="),console.log("请求参数:",e),fe.get("/api/v1/platform/devices",{params:e})},getDeviceDetail(e){return fe.get(`/api/v1/platform/devices/${e}`)},getDeviceTrack(e,t={}){return fe.get(`/api/v1/platform/devices/${e}/track`,{params:t})},getRealtimeStream(){return fe.get("/api/v1/platform/realtime/stream")},updateDevice(e,t){return console.log("=== API调用: 更新设备信息 ==="),console.log("设备ID:",e),console.log("更新数据:",t),fe.put(`/api/v1/platform/devices/${e}`,t)}},bt=mt("device",()=>{const e=L([]),t=L(null),n=L([]),o=L(!1),s=L(null),l=G(()=>e.value.filter(I=>I.status==="ONLINE")),a=G(()=>e.value.filter(I=>I.status==="OFFLINE")),f=G(()=>({total:e.value.length,online:l.value.length,offline:a.value.length})),E=async(I={})=>{o.value=!0,s.value=null,console.log("=== 设备Store: 开始获取设备列表 ==="),console.log("参数:",I);try{const A=await Me.getDevices(I);return console.log("设备API响应:",A),console.log("响应中的设备数组:",A.devices),console.log("设备数组长度:",A.devices?.length),A.devices&&A.devices.length>0?(e.value=A.devices,console.log("设置设备列表:",e.value.length,"个设备"),console.log("最终设备列表:",e.value),console.log("第一个设备的用户名:",e.value[0]?.username),console.log("第一个设备的设备ID:",e.value[0]?.deviceId)):(console.log("API返回的设备数组为空，使用空数组"),e.value=[]),e.value.length===0&&(console.log("⚠️ 警告：使用模拟数据！"),e.value=[{deviceId:"MUSE_PI_PRO_001",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:85,lastSeen:new Date().toISOString(),username:"张三",phone:"13800138001",location:{lat:33.553733,lng:119.030953,speed:60,direction:45,altitude:10,hdop:1.2,satellites:8}},{deviceId:"MUSE_PI_PRO_002",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:92,lastSeen:new Date(Date.now()-300*1e3).toISOString(),username:"李四",phone:"13800138002",location:{lat:33.563733,lng:119.040953,speed:45,direction:90,altitude:15,hdop:.8,satellites:10}},{deviceId:"MUSE_PI_PRO_003",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"OFFLINE",healthScore:78,lastSeen:new Date(Date.now()-1800*1e3).toISOString(),username:"王五",phone:"13800138003",location:{lat:33.543733,lng:119.020953,speed:0,direction:0,altitude:8,hdop:2.1,satellites:6}}]),A}catch(A){console.error("获取设备列表失败:",A),s.value=A.message,console.log("API调用失败，使用模拟数据"),e.value=[{deviceId:"MUSE_PI_PRO_001",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:85,lastSeen:new Date().toISOString(),username:"张三",phone:"13800138001",location:{lat:33.553733,lng:119.030953,speed:60,direction:45,altitude:10,hdop:1.2,satellites:8}},{deviceId:"MUSE_PI_PRO_002",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"ONLINE",healthScore:92,lastSeen:new Date(Date.now()-300*1e3).toISOString(),username:"李四",phone:"13800138002",location:{lat:33.563733,lng:119.040953,speed:45,direction:90,altitude:15,hdop:.8,satellites:10}},{deviceId:"MUSE_PI_PRO_003",deviceType:"MUSE_PI_PRO",version:"1.0.0",status:"OFFLINE",healthScore:78,lastSeen:new Date(Date.now()-1800*1e3).toISOString(),username:"王五",phone:"13800138003",location:{lat:33.543733,lng:119.020953,speed:0,direction:0,altitude:8,hdop:2.1,satellites:6}}]}finally{o.value=!1}},p=async I=>{o.value=!0,s.value=null;try{const A=await Me.getDeviceDetail(I);return t.value=A,A}catch(A){throw s.value=A.message,A}finally{o.value=!1}},u=async(I,A={})=>{try{return await Me.getDeviceTrack(I,A)}catch(M){return s.value=M.message,{track:h(I,A)}}},h=(I,A)=>{const M=[],V=new Date(A.startTime||Date.now()-864e5),B=new Date(A.endTime||Date.now());let q=33.553733,K=119.030953;const J=Math.ceil((B-V)/(1e3*60*60));for(let X=0;X<J;X++){const oe=new Date(V.getTime()+X*60*60*1e3),ie=q+(Math.random()-.5)*.01,ce=K+(Math.random()-.5)*.01;M.push({timestamp:oe.toISOString(),lat:ie,lng:ce,speed:Math.random()*80+20,direction:Math.random()*360,altitude:Math.random()*20+5,hdop:Math.random()*2+.5,satellites:Math.floor(Math.random()*5)+6})}return M};return{devices:e,currentDevice:t,realtimeDevices:n,loading:o,error:s,onlineDevices:l,offlineDevices:a,deviceCount:f,fetchDevices:E,fetchDeviceDetail:p,fetchDeviceTrack:u,fetchRealtimeStream:async()=>{try{const I=await Me.getRealtimeStream();return n.value=I.devices||[],I}catch(I){throw s.value=I.message,I}},updateDeviceStatus:(I,A)=>{const M=e.value.find(V=>V.deviceId===I);M&&(M.status=A,M.lastSeen=new Date().toISOString())},updateDeviceLocation:(I,A)=>{const M=e.value.find(V=>V.deviceId===I);M&&(M.location=A)},updateDevice:async(I,A)=>{o.value=!0,s.value=null,console.log("=== 设备Store: 开始更新设备信息 ==="),console.log("设备ID:",I),console.log("更新数据:",A);try{const M=await Me.updateDevice(I,A);console.log("更新设备API响应:",M);const V=e.value.find(B=>B.deviceId===I);return V&&Object.assign(V,A),M}catch(M){throw console.error("更新设备失败:",M),s.value=M.message,M}finally{o.value=!1}},clearError:()=>{s.value=null}}}),Js={getOverview(){return fe.get("/api/v1/platform/overview")}},Ys=mt("overview",()=>{const e=L(null),t=L(!1),n=L(null);return{overview:e,loading:t,error:n,fetchOverview:async()=>{t.value=!0,n.value=null;try{const l=await Js.getOverview();return e.value=l,l}catch(l){throw n.value=l.message,l}finally{t.value=!1}},clearError:()=>{n.value=null}}}),Xs={class:"dashboard"},Qs={class:"card-header"},Zs={class:"header-actions"},ea={class:"card-header"},ta={class:"header-actions"},na={key:0},oa={key:1,class:"text-muted"},sa={__name:"Dashboard",setup(e){const t=vt(),n=bt(),o=Ys(),s=L({}),l=L([]),a=L(""),f=L(""),E=L(!1),p=L({apiKey:"",securityKey:"",version:"1.4.15"}),u=L(null),h=G(()=>{console.log("计算filteredDevices，当前设备数量:",n.devices.length),console.log("设备列表:",n.devices),console.log("搜索关键词:",a.value),console.log("地图状态筛选:",f.value);let w=n.devices;if(a.value){const _=a.value.toLowerCase();w=w.filter(x=>x.deviceId.toLowerCase().includes(_)||x.username&&x.username.toLowerCase().includes(_))}return f.value&&(w=w.filter(_=>_.status===f.value)),console.log("过滤后设备数量:",w.length),w}),T=async()=>{try{console.log("=== 开始并行加载数据 ==="),await Promise.all([O(),b(),g()]),console.log("=== 数据加载完成 ===")}catch(w){console.error("加载数据失败:",w),pe.error("加载数据失败")}},O=async()=>{try{const w=await o.fetchOverview();s.value=w}catch(w){console.error("加载概览数据失败:",w)}},b=async()=>{try{console.log("=== Dashboard: 开始加载设备列表 ==="),await n.fetchDevices(),console.log("=== Dashboard: 设备列表加载完成 ==="),console.log("当前设备数量:",n.devices.length),console.log("设备列表:",n.devices),n.devices.length>0&&(console.log("第一个设备详情:",n.devices[0]),console.log("第一个设备用户名:",n.devices[0].username),console.log("第一个设备ID:",n.devices[0].deviceId))}catch(w){console.error("加载设备列表失败:",w)}},g=async()=>{try{console.log("=== 开始加载实时数据 ===");const w=await n.fetchRealtimeStream();console.log("实时数据响应:",w),l.value=w.devices||[],console.log("设置实时设备数量:",l.value.length),console.log("实时设备列表:",l.value)}catch(w){console.error("加载实时数据失败:",w),console.log("使用设备列表作为实时数据备选"),l.value=n.devices||[]}},y=()=>{g()},I=()=>{u.value&&u.value.forceRefresh()},A=()=>{b()},M=()=>{console.log("更新地图筛选:",f.value)},V=w=>{console.log("设备点击:",w)},B=w=>{console.log("地图准备就绪:",w)},q=w=>{K(w)},K=w=>{t.push(`/devices/${w.deviceId}`)},J=()=>{p.value.apiKey=localStorage.getItem("amap_api_key")||"",p.value.securityKey=localStorage.getItem("amap_security_key")||"",p.value.version=localStorage.getItem("amap_version")||"1.4.15",E.value=!0},X=()=>{if(!p.value.apiKey.trim()){pe.warning("请输入API Key");return}localStorage.setItem("amap_api_key",p.value.apiKey),localStorage.setItem("amap_security_key",p.value.securityKey),localStorage.setItem("amap_version",p.value.version),E.value=!1,pe.success("地图配置已保存"),setTimeout(()=>{window.location.reload()},1e3)},oe=w=>{if(!w)return"未知";const _=new Date(w),P=new Date-_,S=Math.floor(P/6e4);if(S<1)return"刚刚";if(S<60)return`${S}分钟前`;const R=Math.floor(S/60);return R<24?`${R}小时前`:_.toLocaleDateString()},ie=w=>{console.log("收到实时数据推送:",w);const{type:_,payload:x}=w;if(_==="realtime_data"){const{deviceId:P,data:S,timestamp:R}=x,j=l.value.find(H=>H.deviceId===P);j?Object.assign(j,{location:S.location,speed:S.speed,direction:S.direction,fatigueLevel:S.fatigueLevel,fatigueScore:S.fatigueScore,lastSeen:new Date(R).toISOString()}):l.value.push({deviceId:P,...S,lastSeen:new Date(R).toISOString()}),u.value&&u.value.updateMarkers()}},ce=w=>{console.log("收到设备状态更新:",w);const{type:_,payload:x}=w;if(_==="device_status"){const{deviceId:P,status:S,timestamp:R}=x,j=l.value.find(H=>H.deviceId===P);j&&(j.status=S,j.lastSeen=new Date(R).toISOString()),pe.info(`设备 ${P} 状态变更为 ${S}`)}},ue=w=>{console.log("收到告警推送:",w);const{type:_,payload:x}=w;if(_==="alert"){const{alertType:P,message:S,severity:R}=x;pe({type:{CRITICAL:"error",HIGH:"warning",MEDIUM:"info",LOW:"success"}[R]||"warning",message:`${P}: ${S}`,duration:R==="CRITICAL"?0:5e3,showClose:!0}),(R==="CRITICAL"||R==="HIGH")&&i(R)}},d=w=>{console.log("收到事件通知:",w);const{type:_,payload:x}=w;if(_==="event"){const{eventType:P}=x;if(s.value.eventSummary){const S=new Date().toDateString();s.value.eventSummary[S]||(s.value.eventSummary[S]={total:0,fatigue:0,distraction:0,emergency:0}),s.value.eventSummary[S].total++,s.value.eventSummary[S][P.toLowerCase()]++}}},i=w=>{try{new Audio(`/static/audio/alert_${w.toLowerCase()}.mp3`).play().catch(x=>{console.log("无法播放告警声音:",x)})}catch(_){console.log("告警声音文件不存在:",_)}};return Ce(async()=>{console.log("=== Dashboard组件已挂载 ==="),console.log("开始加载数据..."),console.log("当前时间:",new Date().toISOString());try{await T(),console.log("=== Dashboard数据加载完成 ===")}catch(_){console.error("=== Dashboard数据加载失败 ===",_)}console.log("开始连接WebSocket...");try{ee.connect(),console.log("WebSocket连接请求已发送")}catch(_){console.error("WebSocket连接失败:",_)}ee.on("realtime_data",ie),ee.on("device_status",ce),ee.on("alert",ue),ee.on("event",d);const w=setInterval(()=>{console.log("=== 定时刷新实时数据 ==="),g()},15e3);Te(()=>{clearInterval(w),ee.off("realtime_data",ie),ee.off("device_status",ce),ee.off("alert",ue),ee.off("event",d)})}),(w,_)=>{const x=C("el-col"),P=C("el-row"),S=C("el-option"),R=C("el-select"),j=C("el-icon"),H=C("el-button"),Z=C("el-card"),Q=C("el-input"),de=C("el-table-column"),ye=C("el-table"),_e=C("el-form-item"),Re=C("el-form"),te=C("el-dialog"),De=ht("loading");return F(),W("div",Xs,[r(P,{gutter:20,class:"overview-section"},{default:c(()=>[r(x,{xs:12,sm:6,md:6,lg:6,xl:6},{default:c(()=>[r(Be,{title:"在线设备",value:s.value.deviceStatus?.online||0,total:s.value.deviceStatus?.total||0,icon:"Monitor",color:"success",suffix:"台"},null,8,["value","total"])]),_:1}),r(x,{xs:12,sm:6,md:6,lg:6,xl:6},{default:c(()=>[r(Be,{title:"离线设备",value:s.value.deviceStatus?.offline||0,icon:"CircleClose",color:"info",suffix:"台"},null,8,["value"])]),_:1}),r(x,{xs:12,sm:6,md:6,lg:6,xl:6},{default:c(()=>[r(Be,{title:"今日事件",value:s.value.eventSummary?.today?.total||0,icon:"Warning",color:"warning",suffix:"起"},null,8,["value"])]),_:1}),r(x,{xs:12,sm:6,md:6,lg:6,xl:6},{default:c(()=>[r(Be,{title:"活跃告警",value:s.value.alertSummary?.active||0,icon:"Bell",color:"danger",suffix:"条"},null,8,["value"])]),_:1})]),_:1}),r(Z,{class:"map-section",shadow:"hover"},{header:c(()=>[v("div",Qs,[_[10]||(_[10]=v("span",null,"实时设备监控",-1)),v("div",Zs,[r(R,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=N=>f.value=N),placeholder:"筛选设备状态",size:"small",clearable:"",style:{"margin-right":"10px",width:"150px"},onChange:M},{default:c(()=>[r(S,{label:"全部设备",value:""}),r(S,{label:"在线设备",value:"ONLINE"}),r(S,{label:"离线设备",value:"OFFLINE"}),r(S,{label:"失联设备",value:"LOST"})]),_:1},8,["modelValue"]),r(H,{size:"small",onClick:y},{default:c(()=>[r(j,null,{default:c(()=>[r(z(be))]),_:1}),_[7]||(_[7]=D(" 刷新 ",-1))]),_:1}),r(H,{size:"small",onClick:I},{default:c(()=>[r(j,null,{default:c(()=>[r(z(Ln))]),_:1}),_[8]||(_[8]=D(" 强制刷新 ",-1))]),_:1}),r(H,{size:"small",onClick:J},{default:c(()=>[r(j,null,{default:c(()=>[r(z(jt))]),_:1}),_[9]||(_[9]=D(" 配置 ",-1))]),_:1})])])]),default:c(()=>[r(yo,{ref_key:"mapComponent",ref:u,devices:h.value,onDeviceClick:V,onMapReady:B},null,8,["devices"])]),_:1}),r(Z,{class:"device-list-section",shadow:"hover"},{header:c(()=>[v("div",ea,[_[12]||(_[12]=v("span",null,"设备列表",-1)),v("div",ta,[r(Q,{modelValue:a.value,"onUpdate:modelValue":_[1]||(_[1]=N=>a.value=N),placeholder:"搜索设备ID或驾驶员",size:"small",style:{width:"200px","margin-right":"10px"},clearable:""},{prefix:c(()=>[r(j,null,{default:c(()=>[r(z(Ht))]),_:1})]),_:1},8,["modelValue"]),r(H,{size:"small",onClick:A},{default:c(()=>[r(j,null,{default:c(()=>[r(z(be))]),_:1}),_[11]||(_[11]=D(" 刷新 ",-1))]),_:1})])])]),default:c(()=>[gt((F(),ae(ye,{data:h.value,stripe:"",style:{width:"100%"},onRowClick:q},{default:c(()=>[r(de,{prop:"deviceId",label:"设备ID",width:"150"}),r(de,{prop:"username",label:"驾驶员",width:"120"}),r(de,{prop:"status",label:"状态",width:"100"},{default:c(({row:N})=>[r(qt,{status:N.status},null,8,["status"])]),_:1}),r(de,{prop:"healthScore",label:"健康度",width:"120"},{default:c(({row:N})=>[r(Wt,{score:N.healthScore||0},null,8,["score"])]),_:1}),r(de,{prop:"lastSeen",label:"最后心跳",width:"150"},{default:c(({row:N})=>[D(k(oe(N.lastSeen)),1)]),_:1}),r(de,{prop:"location",label:"位置","min-width":"200"},{default:c(({row:N})=>[N.location&&N.location.lat!==null&&N.location.lng!==null?(F(),W("span",na,k(N.location.lat.toFixed(6))+", "+k(N.location.lng.toFixed(6)),1)):(F(),W("span",oa,"未知"))]),_:1}),r(de,{label:"操作",width:"120",fixed:"right"},{default:c(({row:N})=>[r(H,{size:"small",type:"primary",onClick:Vt(nt=>K(N),["stop"])},{default:c(()=>[..._[13]||(_[13]=[D(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[De,z(n).loading]])]),_:1}),r(te,{modelValue:E.value,"onUpdate:modelValue":_[6]||(_[6]=N=>E.value=N),title:"地图配置",width:"600px","close-on-click-modal":!1},{footer:c(()=>[r(H,{onClick:_[5]||(_[5]=N=>E.value=!1)},{default:c(()=>[..._[17]||(_[17]=[D("取消",-1)])]),_:1}),r(H,{type:"primary",onClick:X},{default:c(()=>[..._[18]||(_[18]=[D("保存",-1)])]),_:1})]),default:c(()=>[r(Re,{model:p.value,"label-width":"120px"},{default:c(()=>[r(_e,{label:"高德地图API Key"},{default:c(()=>[r(Q,{modelValue:p.value.apiKey,"onUpdate:modelValue":_[2]||(_[2]=N=>p.value.apiKey=N),type:"password",placeholder:"请输入高德地图API Key","show-password":""},null,8,["modelValue"]),_[14]||(_[14]=v("div",{class:"form-tip"},[D(" 请到 "),v("a",{href:"https://console.amap.com/",target:"_blank"},"高德开放平台"),D(" 申请API Key "),v("br"),v("a",{href:"/map-config-help",target:"_blank"},"查看详细配置帮助")],-1))]),_:1}),r(_e,{label:"安全密钥"},{default:c(()=>[r(Q,{modelValue:p.value.securityKey,"onUpdate:modelValue":_[3]||(_[3]=N=>p.value.securityKey=N),type:"password",placeholder:"请输入安全密钥（可选）","show-password":""},null,8,["modelValue"]),_[15]||(_[15]=v("div",{class:"form-tip"}," 2021年后申请的API Key需要配置安全密钥，请到控制台获取 ",-1))]),_:1}),r(_e,{label:"API版本"},{default:c(()=>[r(R,{modelValue:p.value.version,"onUpdate:modelValue":_[4]||(_[4]=N=>p.value.version=N),placeholder:"选择API版本"},{default:c(()=>[r(S,{label:"基础版 v1.4.15",value:"1.4.15"}),r(S,{label:"标准版 v2.0",value:"2.0"})]),_:1},8,["modelValue"]),_[16]||(_[16]=v("div",{class:"form-tip"}," 基础版功能较少但调用限制较少，标准版功能完整但有限制 ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},aa=he(sa,[["__scopeId","data-v-1dffdc95"]]),ra={class:"map-controls"},la={key:0,class:"time-controls"},ia={key:1,class:"map-error"},ca={key:2,class:"map-loading"},ua={__name:"SimpleTrackMap",props:{deviceId:{type:String,required:!0},trackData:{type:Array,default:()=>[]},events:{type:Array,default:()=>[]},center:{type:Object,default:()=>({lat:33.553733,lng:119.030953})},zoom:{type:Number,default:12}},emits:["event-click","map-ready"],setup(e,{expose:t,emit:n}){const o=e,s=n,l=L(null),a=L(!1),f=L(""),E=L(!1),p=L(0);let u=null,h=null,T=[],O=[],b=null,g=null,y=null;const I=L(""),A=()=>{const S="732a364f70864bb0c4ac3395cc3d5503";localStorage.getItem("amap_api_key"),I.value=S},M=async()=>{if(console.log("开始初始化SimpleTrackMap..."),console.log("API Key:",I.value?"已配置":"未配置"),console.log("地图容器:",l.value),!I.value){f.value="高德地图API key未配置";return}if(!l.value){f.value="地图容器未找到";return}a.value=!0,f.value="";try{if(window.AMap||(console.log("加载高德地图API..."),await V()),!window.AMap)throw new Error("高德地图API加载失败");console.log("AMap已加载，开始创建SimpleTrackMap实例..."),console.log("地图容器尺寸:",l.value.offsetWidth,"x",l.value.offsetHeight),u=new window.AMap.Map(l.value,{center:[o.center.lng,o.center.lat],zoom:o.zoom,mapStyle:"amap://styles/normal"}),console.log("SimpleTrackMap实例创建成功"),g=new window.AMap.InfoWindow({offset:new window.AMap.Pixel(0,-30)}),u.on("complete",()=>{console.log("SimpleTrackMap地图加载完成"),s("map-ready",u),B(),q(),a.value=!1})}catch(S){console.error("SimpleTrackMap地图初始化失败:",S),f.value=S.message||"地图初始化失败",a.value=!1}},V=()=>new Promise((S,R)=>{if(window.AMap){S();return}const j=localStorage.getItem("amap_version")||"1.4.15",H=document.createElement("script");H.src=`https://webapi.amap.com/maps?v=${j}&key=${I.value}`,H.onload=()=>{const Z=()=>{window.AMap&&window.AMap.Map?S():setTimeout(Z,100)};Z()},H.onerror=()=>{R(new Error("高德地图API加载失败"))},document.head.appendChild(H)}),B=()=>{if(!u||!o.trackData.length)return;h&&u.remove(h),T.forEach(R=>u.remove(R)),T=[];const S=o.trackData.map(R=>[R.lng,R.lat]);h=new window.AMap.Polyline({path:S,strokeColor:"#409EFF",strokeWeight:3,strokeOpacity:.8}),u.add(h),o.trackData.forEach((R,j)=>{const H=new window.AMap.Marker({position:[R.lng,R.lat],title:`轨迹点 ${j+1}`,icon:K(j),anchor:"center"});H.on("click",()=>{X(R,H)}),T.push(H),u.add(H)}),S.length>0&&u.setFitView(T)},q=()=>{!u||!o.events.length||(O.forEach(S=>u.remove(S)),O=[],o.events.forEach(S=>{if(S.location&&S.location.lat&&S.location.lng){const R=new window.AMap.Marker({position:[S.location.lng,S.location.lat],title:x(S.eventType),icon:J(S.severity),anchor:"center"});R.on("click",()=>{oe(S,R),s("event-click",S)}),O.push(R),u.add(R)}}))},K=S=>S===0?"https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png":S===o.trackData.length-1?"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png":"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",J=S=>{const R={LOW:"https://webapi.amap.com/theme/v1.3/markers/n/mark_g.png",MEDIUM:"https://webapi.amap.com/theme/v1.3/markers/n/mark_y.png",HIGH:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",CRITICAL:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png"};return R[S]||R.MEDIUM},X=(S,R)=>{const j=`
    <div class="track-point-info">
      <h4>轨迹点</h4>
      <p><strong>时间:</strong> ${_(S.timestamp)}</p>
      <p><strong>位置:</strong> ${S.lat.toFixed(6)}, ${S.lng.toFixed(6)}</p>
      <p><strong>速度:</strong> ${S.speed||0} km/h</p>
      <p><strong>方向:</strong> ${S.direction||0}°</p>
    </div>
  `;g.setContent(j),g.open(u,R.getPosition())},oe=(S,R)=>{const j=`
    <div class="event-info">
      <h4>${x(S.eventType)}</h4>
      <p><strong>严重程度:</strong> ${P(S.severity)}</p>
      <p><strong>置信度:</strong> ${(S.confidence*100).toFixed(1)}%</p>
      <p><strong>时间:</strong> ${_(S.timestamp)}</p>
      <p><strong>描述:</strong> ${S.context||"无"}</p>
    </div>
  `;g.setContent(j),g.open(u,R.getPosition())},ie=()=>{o.trackData.length&&(E.value?(y&&(clearInterval(y),y=null),E.value=!1):(E.value=!0,p.value=0,y=setInterval(()=>{p.value<o.trackData.length-1?(p.value++,ue(p.value)):(y&&(clearInterval(y),y=null),E.value=!1)},1e3)))},ce=()=>{y&&(clearInterval(y),y=null),E.value=!1,p.value=0,B()},ue=S=>{if(!u||!o.trackData[S])return;const R=o.trackData[S];u.setCenter([R.lng,R.lat]),b&&u.remove(b),b=new window.AMap.Marker({position:[R.lng,R.lat],title:"当前位置",icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",anchor:"center"}),u.add(b)},d=()=>{u&&o.trackData.length>0?u.setFitView(T):u&&u.setCenter([o.center.lng,o.center.lat])},i=()=>{f.value="",u&&(u.destroy(),u=null),M()},w=S=>o.trackData[S]?_(o.trackData[S].timestamp):"",_=S=>S?new Date(S).toLocaleString():"未知",x=S=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[S]||"未知事件",P=S=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[S]||"未知";return Ie(()=>o.trackData,B,{deep:!0}),Ie(()=>o.events,q,{deep:!0}),Ie(()=>I.value,S=>{S&&!u&&M()}),Ce(()=>{A(),Ut(()=>{I.value&&M()})}),Te(()=>{y&&clearInterval(y),u&&u.destroy()}),t({centerMap:d,updateTrackDisplay:B,updateEventMarkers:q,getMap:()=>u}),(S,R)=>{const j=C("el-icon"),H=C("el-button"),Z=C("el-button-group"),Q=C("el-slider"),de=C("el-alert");return F(),W("div",{class:"simple-track-map",ref_key:"mapContainer",ref:l},[v("div",ra,[r(Z,null,{default:c(()=>[r(H,{size:"small",onClick:ie,disabled:!e.trackData.length},{default:c(()=>[r(j,null,{default:c(()=>[r(z(Nn))]),_:1}),D(" "+k(E.value?"暂停":"播放"),1)]),_:1},8,["disabled"]),r(H,{size:"small",onClick:ce},{default:c(()=>[r(j,null,{default:c(()=>[r(z(be))]),_:1}),R[1]||(R[1]=D(" 重置 ",-1))]),_:1}),r(H,{size:"small",onClick:d},{default:c(()=>[r(j,null,{default:c(()=>[r(z(Bt))]),_:1}),R[2]||(R[2]=D(" 居中 ",-1))]),_:1})]),_:1})]),e.trackData.length?(F(),W("div",la,[r(Q,{modelValue:p.value,"onUpdate:modelValue":R[0]||(R[0]=ye=>p.value=ye),min:0,max:e.trackData.length-1,step:1,onChange:ue,"format-tooltip":w},null,8,["modelValue","max"])])):ge("",!0),f.value?(F(),W("div",ia,[r(de,{title:"地图加载失败",description:f.value,type:"error","show-icon":"",closable:!1},null,8,["description"]),r(H,{onClick:i,style:{"margin-top":"10px"}},{default:c(()=>[...R[3]||(R[3]=[D("重试",-1)])]),_:1})])):ge("",!0),a.value?(F(),W("div",ca,[r(j,{class:"is-loading"},{default:c(()=>[r(z(zt))]),_:1}),R[4]||(R[4]=v("span",null,"地图加载中...",-1))])):ge("",!0)],512)}}},da=he(ua,[["__scopeId","data-v-89efa1a2"]]),rt={getEvents(e={}){return console.log("=== API调用: 获取事件列表 ==="),console.log("请求参数:",e),fe.get("/api/v1/platform/events",{params:e})},getEventStatistics(e={}){return fe.get("/api/v1/platform/events/statistics",{params:e})},getDrivingBehaviorAnalysis(e,t={}){return fe.get("/api/v1/platform/analysis/driving-behavior",{params:{deviceId:e,...t}})}},_n=mt("event",()=>{const e=L([]),t=L(null),n=L(null),o=L(!1),s=L(null),l=G(()=>({total:e.value.length,fatigue:e.value.filter(g=>g.eventType==="FATIGUE").length,distraction:e.value.filter(g=>g.eventType==="DISTRACTION").length,emergency:e.value.filter(g=>g.eventType==="EMERGENCY").length})),a=G(()=>({low:e.value.filter(g=>g.severity==="LOW").length,medium:e.value.filter(g=>g.severity==="MEDIUM").length,high:e.value.filter(g=>g.severity==="HIGH").length,critical:e.value.filter(g=>g.severity==="CRITICAL").length})),f=async(g={})=>{o.value=!0,s.value=null,console.log("=== 事件Store: 开始获取事件列表 ==="),console.log("请求参数:",g);try{const y=await rt.getEvents(g);return console.log("事件API响应:",y),console.log("响应中的事件数组:",y.events),console.log("事件数组长度:",y.events?.length),e.value=y.events||[],console.log("设置事件列表:",e.value.length,"个事件"),console.log("最终事件列表:",e.value),y}catch(y){console.error("获取事件列表失败:",y),s.value=y.message,console.log("API调用失败，使用模拟数据");const I=E(g);return e.value=I,{events:I}}finally{o.value=!1}},E=g=>{const y=[],I=g.deviceId||"MUSE_PI_PRO_001",A=["FATIGUE","DISTRACTION","EMERGENCY"],M=["LOW","MEDIUM","HIGH","CRITICAL"];for(let V=0;V<5;V++){const B=new Date(Date.now()-Math.random()*24*60*60*1e3),q=A[Math.floor(Math.random()*A.length)],K=M[Math.floor(Math.random()*M.length)],J=33.553733+(Math.random()-.5)*.01,X=119.030953+(Math.random()-.5)*.01;y.push({eventId:`EVENT_${Date.now()}_${V}`,deviceId:I,eventType:q,severity:K,confidence:Math.random()*.4+.6,duration:Math.floor(Math.random()*30)+5,timestamp:B.toISOString(),location:{lat:J,lng:X,altitude:Math.random()*20+5},behavior:p(q),context:u(q,K)})}return y.sort((V,B)=>new Date(B.timestamp)-new Date(V.timestamp))},p=g=>{const I={FATIGUE:["频繁眨眼","头部下垂","打哈欠","注意力不集中"],DISTRACTION:["看手机","转头说话","吃东西","调整设备"],EMERGENCY:["急刹车","急转弯","偏离车道","碰撞预警"]}[g]||["未知行为"];return I[Math.floor(Math.random()*I.length)]},u=(g,y)=>({FATIGUE:{LOW:"轻微疲劳，建议适当休息",MEDIUM:"中度疲劳，建议立即休息",HIGH:"严重疲劳，存在安全隐患",CRITICAL:"极度疲劳，立即停车休息"},DISTRACTION:{LOW:"轻微分心，注意驾驶安全",MEDIUM:"中度分心，影响驾驶安全",HIGH:"严重分心，存在碰撞风险",CRITICAL:"极度分心，立即停止驾驶"},EMERGENCY:{LOW:"轻微紧急情况，注意观察",MEDIUM:"中度紧急情况，谨慎驾驶",HIGH:"严重紧急情况，立即处理",CRITICAL:"极度紧急情况，立即停车"}})[g]?.[y]||"事件详情";return{events:e,eventStatistics:t,drivingBehaviorAnalysis:n,loading:o,error:s,eventCount:l,severityCount:a,fetchEvents:f,fetchEventStatistics:async(g={})=>{try{const y=await rt.getEventStatistics(g);return t.value=y,y}catch(y){throw s.value=y.message,y}},fetchDrivingBehaviorAnalysis:async(g,y={})=>{try{const I=await rt.getDrivingBehaviorAnalysis(g,y);return n.value=I,I}catch(I){throw s.value=I.message,I}},addEvent:g=>{e.value.unshift(g)},clearError:()=>{s.value=null}}}),pa={class:"device-detail"},fa={class:"page-header"},ma={key:0,class:"device-info"},va={class:"info-item"},ha={class:"info-item"},ga={class:"info-item"},ya={class:"info-item"},_a={class:"info-item"},wa={class:"info-item"},ba={class:"info-item"},Sa={class:"info-item"},Ea={key:0,class:"data-grid"},Ia={class:"data-item"},Ca={class:"data-item"},Ta={class:"data-item"},ka={class:"data-item"},Aa={class:"data-item"},Ra={class:"data-item"},Da={key:0,class:"stats-grid"},Oa={class:"stat-item"},xa={class:"stat-value"},Ma={class:"stat-item"},Pa={class:"stat-value"},La={class:"stat-item"},Na={class:"stat-value"},$a={class:"stat-item"},Fa={class:"stat-value"},Ua={class:"stat-item"},Va={class:"stat-value"},Ba={class:"event-context"},za={class:"event-details"},ja={class:"header-actions"},Ha={key:0,class:"event-detail"},qa={__name:"DeviceDetail",setup(e){const t=Ft(),n=vt(),o=bt(),s=_n(),l=G(()=>t.params.deviceId),a=G(()=>o.currentDevice),f=L([]),E=L([]),p=L(!1),u=L(null),h=L(!1),T=L({apiKey:""}),O=()=>{n.go(-1)},b=async()=>{try{await o.fetchDeviceDetail(l.value)}catch(d){console.error("加载设备详情失败:",d),pe.error("加载设备详情失败")}},g=async()=>{try{const d={deviceId:l.value,eventType:"FATIGUE",limit:10},i=await s.fetchEvents(d);f.value=i.events||[]}catch(d){console.error("加载事件历史失败:",d)}},y=async()=>{try{const d=new Date,w={startTime:new Date(d.getTime()-1440*60*1e3).toISOString(),endTime:d.toISOString()},_=await o.fetchDeviceTrack(l.value,w);E.value=_.track||[]}catch(d){console.error("加载轨迹数据失败:",d)}},I=()=>{b()},A=d=>{console.log("显示事件位置:",d)},M=d=>{u.value=d,p.value=!0},V=()=>{T.value.apiKey=localStorage.getItem("amap_api_key")||"",h.value=!0},B=()=>{if(!T.value.apiKey.trim()){pe.warning("请输入API Key");return}localStorage.setItem("amap_api_key",T.value.apiKey),h.value=!1,pe.success("地图配置已保存"),setTimeout(()=>{window.location.reload()},1e3)},q=d=>d?new Date(d).toLocaleString():"未知",K=d=>d?`${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}`:"未知",J=d=>{if(!d)return"0分钟";const i=Math.floor(d/3600),w=Math.floor(d%3600/60);return i>0?`${i}小时${w}分钟`:`${w}分钟`},X=d=>d?d<1?"优秀":d<2?"良好":d<5?"一般":"较差":"未知",oe=d=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[d]||"未知事件",ie=d=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[d]||"未知",ce=d=>({LOW:"success",MEDIUM:"warning",HIGH:"danger",CRITICAL:"danger"})[d]||"info",ue=d=>{d.deviceId===l.value&&b()};return Ce(()=>{b(),g(),y(),ee.on("realtime_data",ue);const d=setInterval(()=>{b()},3e4);Te(()=>{clearInterval(d),ee.off("realtime_data",ue)})}),(d,i)=>{const w=C("el-icon"),_=C("el-button"),x=C("el-card"),P=C("el-empty"),S=C("el-tag"),R=C("el-timeline-item"),j=C("el-timeline"),H=C("el-col"),Z=C("el-row"),Q=C("el-descriptions-item"),de=C("el-descriptions"),ye=C("el-dialog"),_e=C("el-input"),Re=C("el-form-item"),te=C("el-form"),De=ht("loading");return F(),W("div",pa,[v("div",fa,[r(_,{onClick:O,size:"small"},{default:c(()=>[r(w,null,{default:c(()=>[r(z($n))]),_:1}),i[4]||(i[4]=D(" 返回 ",-1))]),_:1}),v("h2",null,"设备详情 - "+k(l.value),1)]),gt((F(),ae(Z,{gutter:20},{default:c(()=>[r(H,{xs:24,sm:24,md:10,lg:10,xl:10},{default:c(()=>[r(x,{class:"info-panel",shadow:"hover"},{header:c(()=>[...i[5]||(i[5]=[v("span",null,"设备信息",-1)])]),default:c(()=>[a.value?(F(),W("div",ma,[v("div",va,[i[6]||(i[6]=v("label",null,"设备ID:",-1)),v("span",null,k(a.value.deviceId),1)]),v("div",ha,[i[7]||(i[7]=v("label",null,"设备类型:",-1)),v("span",null,k(a.value.deviceType),1)]),v("div",ga,[i[8]||(i[8]=v("label",null,"版本:",-1)),v("span",null,k(a.value.version),1)]),v("div",ya,[i[9]||(i[9]=v("label",null,"驾驶员:",-1)),v("span",null,k(a.value.user?.username||"未知"),1)]),v("div",_a,[i[10]||(i[10]=v("label",null,"联系方式:",-1)),v("span",null,k(a.value.user?.phone||"未知"),1)]),v("div",wa,[i[11]||(i[11]=v("label",null,"状态:",-1)),r(qt,{status:a.value.status},null,8,["status"])]),v("div",ba,[i[12]||(i[12]=v("label",null,"健康度:",-1)),r(Wt,{score:a.value.healthScore||0},null,8,["score"])]),v("div",Sa,[i[13]||(i[13]=v("label",null,"最后心跳:",-1)),v("span",null,k(q(a.value.lastSeen)),1)])])):ge("",!0)]),_:1}),r(x,{class:"realtime-data",shadow:"hover"},{header:c(()=>[i[15]||(i[15]=v("span",null,"实时数据",-1)),r(_,{size:"small",onClick:I},{default:c(()=>[r(w,null,{default:c(()=>[r(z(be))]),_:1}),i[14]||(i[14]=D(" 刷新 ",-1))]),_:1})]),default:c(()=>[a.value?.currentLocation?(F(),W("div",Ea,[v("div",Ia,[i[16]||(i[16]=v("label",null,"位置:",-1)),v("span",null,k(K(a.value.currentLocation)),1)]),v("div",Ca,[i[17]||(i[17]=v("label",null,"速度:",-1)),v("span",null,k(a.value.currentLocation.speed||0)+" km/h",1)]),v("div",Ta,[i[18]||(i[18]=v("label",null,"方向:",-1)),v("span",null,k(a.value.currentLocation.direction||0)+"°",1)]),v("div",ka,[i[19]||(i[19]=v("label",null,"海拔:",-1)),v("span",null,k(a.value.currentLocation.altitude||0)+"m",1)]),v("div",Aa,[i[20]||(i[20]=v("label",null,"GPS质量:",-1)),v("span",null,k(X(a.value.currentLocation.hdop)),1)]),v("div",Ra,[i[21]||(i[21]=v("label",null,"卫星数:",-1)),v("span",null,k(a.value.currentLocation.satellites||0)+"颗",1)])])):(F(),ae(P,{key:1,description:"暂无实时数据"}))]),_:1}),r(x,{class:"fatigue-stats",shadow:"hover"},{header:c(()=>[...i[22]||(i[22]=[v("span",null,"疲劳行为统计",-1)])]),default:c(()=>[a.value?.statistics?(F(),W("div",Da,[v("div",Oa,[i[23]||(i[23]=v("label",null,"今日疲劳事件:",-1)),v("span",xa,k(a.value.statistics.fatigueEvents||0),1)]),v("div",Ma,[i[24]||(i[24]=v("label",null,"今日分心事件:",-1)),v("span",Pa,k(a.value.statistics.distractionEvents||0),1)]),v("div",La,[i[25]||(i[25]=v("label",null,"总驾驶时长:",-1)),v("span",Na,k(J(a.value.statistics.totalDrivingTime)),1)]),v("div",$a,[i[26]||(i[26]=v("label",null,"总行驶距离:",-1)),v("span",Fa,k(a.value.statistics.totalDistance||0)+" km",1)]),v("div",Ua,[i[27]||(i[27]=v("label",null,"最后疲劳事件:",-1)),v("span",Va,k(q(a.value.statistics.lastFatigueEvent)),1)])])):(F(),ae(P,{key:1,description:"暂无统计数据"}))]),_:1}),r(x,{class:"event-history",shadow:"hover"},{header:c(()=>[i[29]||(i[29]=v("span",null,"历史疲劳事件",-1)),r(_,{size:"small",onClick:g},{default:c(()=>[r(w,null,{default:c(()=>[r(z(be))]),_:1}),i[28]||(i[28]=D(" 刷新 ",-1))]),_:1})]),default:c(()=>[f.value.length?(F(),ae(j,{key:0},{default:c(()=>[(F(!0),W(je,null,He(f.value,N=>(F(),ae(R,{key:N.eventId,timestamp:q(N.timestamp),type:ce(N.severity),onClick:nt=>A(N)},{default:c(()=>[r(S,{type:ce(N.severity),size:"small"},{default:c(()=>[D(k(oe(N.eventType)),1)]),_:2},1032,["type"]),v("p",Ba,k(N.context),1),v("p",za," 置信度: "+k((N.confidence*100).toFixed(1))+"% | 持续时间: "+k(N.duration)+"秒 ",1)]),_:2},1032,["timestamp","type","onClick"]))),128))]),_:1})):(F(),ae(P,{key:1,description:"暂无疲劳事件"}))]),_:1})]),_:1}),r(H,{xs:24,sm:24,md:14,lg:14,xl:14},{default:c(()=>[r(x,{class:"map-panel",shadow:"hover"},{header:c(()=>[i[32]||(i[32]=v("span",null,"设备轨迹与事件位置",-1)),v("div",ja,[r(_,{size:"small",onClick:y},{default:c(()=>[r(w,null,{default:c(()=>[r(z(be))]),_:1}),i[30]||(i[30]=D(" 刷新轨迹 ",-1))]),_:1}),r(_,{size:"small",onClick:V},{default:c(()=>[r(w,null,{default:c(()=>[r(z(jt))]),_:1}),i[31]||(i[31]=D(" 配置 ",-1))]),_:1})])]),default:c(()=>[r(da,{"device-id":l.value,"track-data":E.value,events:f.value,onEventClick:M},null,8,["device-id","track-data","events"])]),_:1})]),_:1})]),_:1})),[[De,z(o).loading]]),r(ye,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=N=>p.value=N),title:"事件详情",width:"600px"},{default:c(()=>[u.value?(F(),W("div",Ha,[r(de,{column:2,border:""},{default:c(()=>[r(Q,{label:"事件ID"},{default:c(()=>[D(k(u.value.eventId),1)]),_:1}),r(Q,{label:"设备ID"},{default:c(()=>[D(k(u.value.deviceId),1)]),_:1}),r(Q,{label:"事件类型"},{default:c(()=>[D(k(oe(u.value.eventType)),1)]),_:1}),r(Q,{label:"严重程度"},{default:c(()=>[D(k(ie(u.value.severity)),1)]),_:1}),r(Q,{label:"置信度"},{default:c(()=>[D(k((u.value.confidence*100).toFixed(1))+"%",1)]),_:1}),r(Q,{label:"持续时间"},{default:c(()=>[D(k(u.value.duration)+"秒",1)]),_:1}),r(Q,{label:"发生时间",span:2},{default:c(()=>[D(k(q(u.value.timestamp)),1)]),_:1}),r(Q,{label:"位置",span:2},{default:c(()=>[D(k(K(u.value.location)),1)]),_:1}),r(Q,{label:"行为描述",span:2},{default:c(()=>[D(k(u.value.behavior),1)]),_:1}),r(Q,{label:"上下文",span:2},{default:c(()=>[D(k(u.value.context),1)]),_:1})]),_:1})])):ge("",!0)]),_:1},8,["modelValue"]),r(ye,{modelValue:h.value,"onUpdate:modelValue":i[3]||(i[3]=N=>h.value=N),title:"地图配置",width:"500px","close-on-click-modal":!1},{footer:c(()=>[r(_,{onClick:i[2]||(i[2]=N=>h.value=!1)},{default:c(()=>[...i[34]||(i[34]=[D("取消",-1)])]),_:1}),r(_,{type:"primary",onClick:B},{default:c(()=>[...i[35]||(i[35]=[D("保存",-1)])]),_:1})]),default:c(()=>[r(te,{model:T.value,"label-width":"100px"},{default:c(()=>[r(Re,{label:"高德地图API Key"},{default:c(()=>[r(_e,{modelValue:T.value.apiKey,"onUpdate:modelValue":i[1]||(i[1]=N=>T.value.apiKey=N),type:"password",placeholder:"请输入高德地图API Key","show-password":""},null,8,["modelValue"]),i[33]||(i[33]=v("div",{class:"form-tip"},[D(" 请到 "),v("a",{href:"https://console.amap.com/",target:"_blank"},"高德开放平台"),D(" 申请API Key ")],-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Wa=he(qa,[["__scopeId","data-v-37e52c0a"]]),Ka={class:"event-trend-chart"},Ga={class:"chart-header"},Ja={__name:"EventTrendChart",props:{data:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["period-change"],setup(e,{emit:t}){zn([Hn,qn,Wn,Kn,Gn,Jn,Yn]);const n=e,o=t,s=L("today"),l=G(()=>{const u=["FATIGUE","DISTRACTION","EMERGENCY"],h=["#E6A23C","#F56C6C","#67C23A"],T=a();return{title:{text:"事件趋势",left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(O){let b=`<div style="margin-bottom: 5px; font-weight: bold;">${O[0].axisValue}</div>`;return O.forEach(g=>{b+=`<div style="margin: 2px 0;">
            <span style="display: inline-block; width: 10px; height: 10px; background-color: ${g.color}; border-radius: 50%; margin-right: 5px;"></span>
            ${g.seriesName}: ${g.value}
          </div>`}),b}},legend:{data:["疲劳事件","分心事件","紧急事件"],top:30},grid:{left:"3%",right:"4%",bottom:"10%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:T.timeLabels,axisLabel:{rotate:45}},yAxis:{type:"value",name:"事件数量",axisLabel:{formatter:"{value}"}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100,height:30,bottom:10}],series:u.map((O,b)=>({name:E(O),type:"line",data:T.seriesData[O]||[],smooth:!0,symbol:"circle",symbolSize:6,lineStyle:{width:3},itemStyle:{color:h[b]},areaStyle:{opacity:.1,color:h[b]}}))}}),a=()=>{if(!n.data.length)return{timeLabels:[],seriesData:{}};const u={},h=["FATIGUE","DISTRACTION","EMERGENCY"];n.data.forEach(b=>{const g=f(b.timestamp);u[g]||(u[g]={}),u[g][b.eventType]||(u[g][b.eventType]=0),u[g][b.eventType]++});const T=Object.keys(u).sort(),O={};return h.forEach(b=>{O[b]=T.map(g=>u[g]?.[b]||0)}),{timeLabels:T,seriesData:O}},f=u=>{const h=new Date(u);switch(s.value){case"today":return`${h.getHours().toString().padStart(2,"0")}:${h.getMinutes().toString().padStart(2,"0")}`;case"week":return`${h.getMonth()+1}/${h.getDate()}`;case"month":return`${h.getMonth()+1}/${h.getDate()}`;default:return h.toLocaleDateString()}},E=u=>({FATIGUE:"疲劳事件",DISTRACTION:"分心事件",EMERGENCY:"紧急事件"})[u]||u,p=u=>{o("period-change",u)};return Ie(()=>n.data,()=>{},{deep:!0}),(u,h)=>{const T=C("el-option"),O=C("el-select");return F(),W("div",Ka,[v("div",Ga,[h[1]||(h[1]=v("h3",null,"事件趋势分析",-1)),r(O,{modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=b=>s.value=b),onChange:p,size:"small"},{default:c(()=>[r(T,{label:"今日",value:"today"}),r(T,{label:"本周",value:"week"}),r(T,{label:"本月",value:"month"})]),_:1},8,["modelValue"])]),r(z(jn),{class:"chart",option:l.value,loading:e.loading,autoresize:""},null,8,["option","loading"])])}}},Ya=he(Ja,[["__scopeId","data-v-63850a8e"]]),Xa={class:"event-management"},Qa={class:"page-header"},Za={class:"header-actions"},er={class:"card-header"},tr={class:"header-info"},nr={class:"pagination-wrapper"},or={class:"severity-stats"},sr={class:"severity-label"},ar={class:"severity-count"},rr={class:"severity-percentage"},lr={class:"device-stats"},ir={class:"device-info"},cr={class:"device-id"},ur={class:"device-user"},dr={class:"device-count"},pr={key:0,class:"event-detail"},fr={__name:"EventManagement",setup(e){vt();const t=_n(),n=bt(),o=L({deviceId:"",eventType:"",severity:"",timeRange:[]}),s=L({currentPage:1,pageSize:20,total:0}),l=L(!1),a=L(null),f=G(()=>n.devices),E=G(()=>{const d={LOW:0,MEDIUM:0,HIGH:0,CRITICAL:0};return t.events.forEach(i=>{d.hasOwnProperty(i.severity)&&d[i.severity]++}),d}),p=G(()=>{const d={};return t.events.forEach(i=>{d[i.deviceId]||(d[i.deviceId]={deviceId:i.deviceId,username:i.user?.username||"未知",eventCount:0}),d[i.deviceId].eventCount++}),Object.values(d).sort((i,w)=>w.eventCount-i.eventCount)}),u=async()=>{try{console.log("=== EventManagement: 开始加载事件列表 ===");const d={...T()};console.log("加载参数:",d);const i=await t.fetchEvents(d);console.log("=== EventManagement: 事件列表加载完成 ==="),console.log("响应数据:",i),console.log("当前事件数量:",t.events.length),console.log("事件列表:",t.events),s.value.total=i.total||0}catch(d){console.error("加载事件列表失败:",d),pe.error("加载事件列表失败")}},h=async()=>{try{await n.fetchDevices()}catch(d){console.error("加载设备列表失败:",d)}},T=()=>{const d={};return o.value.deviceId&&(d.deviceId=o.value.deviceId),o.value.eventType&&(d.eventType=o.value.eventType),o.value.severity&&(d.severity=o.value.severity),o.value.timeRange&&o.value.timeRange.length===2&&(d.startTime=o.value.timeRange[0],d.endTime=o.value.timeRange[1]),d},O=()=>{s.value.currentPage=1,u()},b=()=>{o.value={deviceId:"",eventType:"",severity:"",timeRange:[]},s.value.currentPage=1,u()},g=()=>{u()},y=()=>{pe.info("导出功能开发中...")},I=d=>{A(d)},A=d=>{a.value=d,l.value=!0},M=d=>{s.value.pageSize=d,s.value.currentPage=1,u()},V=d=>{s.value.currentPage=d,u()},B=d=>{u()},q=d=>d?new Date(d).toLocaleString():"未知",K=d=>d?`${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}`:"未知",J=d=>({FATIGUE:"疲劳检测",DISTRACTION:"分心行为",EMERGENCY:"紧急事件"})[d]||"未知事件",X=d=>({FATIGUE:"warning",DISTRACTION:"danger",EMERGENCY:"danger"})[d]||"info",oe=d=>({LOW:"轻微",MEDIUM:"中等",HIGH:"严重",CRITICAL:"危急"})[d]||"未知",ie=d=>({LOW:"success",MEDIUM:"warning",HIGH:"danger",CRITICAL:"danger"})[d]||"info",ce=d=>{const i=t.events.length;return i===0?0:(d/i*100).toFixed(1)},ue=d=>{console.log("收到新事件推送:",d);const{type:i,payload:w}=d;if(i==="event"){const{deviceId:_,eventType:x,data:P,timestamp:S}=w,R={eventId:P.eventId||`EVENT_${Date.now()}`,deviceId:_,eventType:x,severity:P.severity||"MEDIUM",location:P.location,behavior:P.behavior,confidence:P.confidence,duration:P.duration,alertLevel:P.alertLevel,context:P.context,timestamp:new Date(S).toISOString(),user:{username:"实时推送"}};t.events.unshift(R),pe.success(`收到新事件: ${x}`);try{new Audio("/static/audio/alert_mid.mp3").play().catch(()=>{})}catch(j){console.log("无法播放提示音:",j)}}};return Ce(()=>{h(),u(),ee.on("event",ue);const d=setInterval(()=>{u()},3e5);Te(()=>{clearInterval(d),ee.off("event",ue)})}),(d,i)=>{const w=C("el-icon"),_=C("el-button"),x=C("el-option"),P=C("el-select"),S=C("el-form-item"),R=C("el-date-picker"),j=C("el-form"),H=C("el-card"),Z=C("el-table-column"),Q=C("el-tag"),de=C("el-table"),ye=C("el-pagination"),_e=C("el-col"),Re=C("el-row"),te=C("el-descriptions-item"),De=C("el-descriptions"),N=C("el-dialog"),nt=ht("loading");return F(),W("div",Xa,[v("div",Qa,[i[9]||(i[9]=v("h2",null,"事件管理",-1)),v("div",Za,[r(_,{onClick:g},{default:c(()=>[r(w,null,{default:c(()=>[r(z(be))]),_:1}),i[7]||(i[7]=D(" 刷新 ",-1))]),_:1}),r(_,{onClick:y},{default:c(()=>[r(w,null,{default:c(()=>[r(z(Fn))]),_:1}),i[8]||(i[8]=D(" 导出 ",-1))]),_:1})])]),r(H,{class:"filter-section",shadow:"hover"},{default:c(()=>[r(j,{model:o.value,inline:""},{default:c(()=>[r(S,{label:"设备"},{default:c(()=>[r(P,{modelValue:o.value.deviceId,"onUpdate:modelValue":i[0]||(i[0]=$=>o.value.deviceId=$),placeholder:"选择设备",clearable:"",style:{width:"200px"}},{default:c(()=>[(F(!0),W(je,null,He(f.value,$=>(F(),ae(x,{key:$.deviceId,label:`${$.deviceId} (${$.username})`,value:$.deviceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(S,{label:"事件类型"},{default:c(()=>[r(P,{modelValue:o.value.eventType,"onUpdate:modelValue":i[1]||(i[1]=$=>o.value.eventType=$),placeholder:"选择事件类型",clearable:"",style:{width:"150px"}},{default:c(()=>[r(x,{label:"疲劳检测",value:"FATIGUE"}),r(x,{label:"分心行为",value:"DISTRACTION"}),r(x,{label:"紧急事件",value:"EMERGENCY"})]),_:1},8,["modelValue"])]),_:1}),r(S,{label:"严重程度"},{default:c(()=>[r(P,{modelValue:o.value.severity,"onUpdate:modelValue":i[2]||(i[2]=$=>o.value.severity=$),placeholder:"选择严重程度",clearable:"",style:{width:"150px"}},{default:c(()=>[r(x,{label:"轻微",value:"LOW"}),r(x,{label:"中等",value:"MEDIUM"}),r(x,{label:"严重",value:"HIGH"}),r(x,{label:"危急",value:"CRITICAL"})]),_:1},8,["modelValue"])]),_:1}),r(S,{label:"时间范围"},{default:c(()=>[r(R,{modelValue:o.value.timeRange,"onUpdate:modelValue":i[3]||(i[3]=$=>o.value.timeRange=$),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),r(S,null,{default:c(()=>[r(_,{type:"primary",onClick:O},{default:c(()=>[r(w,null,{default:c(()=>[r(z(Ht))]),_:1}),i[10]||(i[10]=D(" 搜索 ",-1))]),_:1}),r(_,{onClick:b},{default:c(()=>[r(w,null,{default:c(()=>[r(z(Un))]),_:1}),i[11]||(i[11]=D(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),r(Re,{gutter:20},{default:c(()=>[r(_e,{xs:24,sm:24,md:16,lg:16,xl:16},{default:c(()=>[r(H,{class:"event-list-section",shadow:"hover"},{header:c(()=>[v("div",er,[i[12]||(i[12]=v("span",null,"事件列表",-1)),v("div",tr," 共 "+k(z(t).events.length)+" 条记录 ",1)])]),default:c(()=>[gt((F(),ae(de,{data:z(t).events,stripe:"",style:{width:"100%"},onRowClick:I},{default:c(()=>[r(Z,{prop:"timestamp",label:"时间",width:"180"},{default:c(({row:$})=>[D(k(q($.timestamp)),1)]),_:1}),r(Z,{prop:"deviceId",label:"设备ID",width:"150"}),r(Z,{prop:"username",label:"驾驶员",width:"120"},{default:c(({row:$})=>[D(k($.user?.username||"未知"),1)]),_:1}),r(Z,{prop:"eventType",label:"事件类型",width:"120"},{default:c(({row:$})=>[r(Q,{type:X($.eventType),size:"small"},{default:c(()=>[D(k(J($.eventType)),1)]),_:2},1032,["type"])]),_:1}),r(Z,{prop:"severity",label:"严重程度",width:"100"},{default:c(({row:$})=>[r(Q,{type:ie($.severity),size:"small"},{default:c(()=>[D(k(oe($.severity)),1)]),_:2},1032,["type"])]),_:1}),r(Z,{prop:"confidence",label:"置信度",width:"100"},{default:c(({row:$})=>[D(k($.confidence?($.confidence*100).toFixed(1)+"%":"未知"),1)]),_:1}),r(Z,{prop:"duration",label:"持续时间",width:"100"},{default:c(({row:$})=>[D(k($.duration?$.duration+"秒":"未知"),1)]),_:1}),r(Z,{prop:"context",label:"描述","min-width":"200","show-overflow-tooltip":""}),r(Z,{label:"操作",width:"120",fixed:"right"},{default:c(({row:$})=>[r(_,{size:"small",onClick:Vt(Ve=>A($),["stop"])},{default:c(()=>[...i[13]||(i[13]=[D(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[nt,z(t).loading]]),v("div",nr,[r(ye,{"current-page":s.value.currentPage,"onUpdate:currentPage":i[4]||(i[4]=$=>s.value.currentPage=$),"page-size":s.value.pageSize,"onUpdate:pageSize":i[5]||(i[5]=$=>s.value.pageSize=$),"page-sizes":[10,20,50,100],total:s.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),r(_e,{xs:24,sm:24,md:8,lg:8,xl:8},{default:c(()=>[r(H,{class:"statistics-section",shadow:"hover"},{header:c(()=>[...i[14]||(i[14]=[v("span",null,"事件统计图表",-1)])]),default:c(()=>[r(Ya,{data:z(t).events,loading:z(t).loading,onPeriodChange:B},null,8,["data","loading"])]),_:1}),r(H,{class:"severity-section",shadow:"hover"},{header:c(()=>[...i[15]||(i[15]=[v("span",null,"严重程度分布",-1)])]),default:c(()=>[v("div",or,[(F(!0),W(je,null,He(E.value,($,Ve)=>(F(),W("div",{key:Ve,class:"severity-item"},[v("div",sr,[r(Q,{type:ie(Ve),size:"small"},{default:c(()=>[D(k(oe(Ve)),1)]),_:2},1032,["type"])]),v("div",ar,k($),1),v("div",rr,k(ce($))+"% ",1)]))),128))])]),_:1}),r(H,{class:"device-stats-section",shadow:"hover"},{header:c(()=>[...i[16]||(i[16]=[v("span",null,"设备事件统计",-1)])]),default:c(()=>[v("div",lr,[(F(!0),W(je,null,He(p.value,$=>(F(),W("div",{key:$.deviceId,class:"device-stat-item"},[v("div",ir,[v("div",cr,k($.deviceId),1),v("div",ur,k($.username),1)]),v("div",dr,k($.eventCount),1)]))),128))])]),_:1})]),_:1})]),_:1}),r(N,{modelValue:l.value,"onUpdate:modelValue":i[6]||(i[6]=$=>l.value=$),title:"事件详情",width:"800px"},{default:c(()=>[a.value?(F(),W("div",pr,[r(De,{column:2,border:""},{default:c(()=>[r(te,{label:"事件ID"},{default:c(()=>[D(k(a.value.eventId),1)]),_:1}),r(te,{label:"设备ID"},{default:c(()=>[D(k(a.value.deviceId),1)]),_:1}),r(te,{label:"驾驶员"},{default:c(()=>[D(k(a.value.user?.username||"未知"),1)]),_:1}),r(te,{label:"联系方式"},{default:c(()=>[D(k(a.value.user?.phone||"未知"),1)]),_:1}),r(te,{label:"事件类型"},{default:c(()=>[D(k(J(a.value.eventType)),1)]),_:1}),r(te,{label:"严重程度"},{default:c(()=>[D(k(oe(a.value.severity)),1)]),_:1}),r(te,{label:"置信度"},{default:c(()=>[D(k((a.value.confidence*100).toFixed(1))+"%",1)]),_:1}),r(te,{label:"持续时间"},{default:c(()=>[D(k(a.value.duration)+"秒",1)]),_:1}),r(te,{label:"发生时间",span:2},{default:c(()=>[D(k(q(a.value.timestamp)),1)]),_:1}),r(te,{label:"位置",span:2},{default:c(()=>[D(k(K(a.value.location)),1)]),_:1}),r(te,{label:"行为描述",span:2},{default:c(()=>[D(k(a.value.behavior),1)]),_:1}),r(te,{label:"上下文",span:2},{default:c(()=>[D(k(a.value.context),1)]),_:1})]),_:1})])):ge("",!0)]),_:1},8,["modelValue"])])}}},mr=he(fr,[["__scopeId","data-v-74d57346"]]),vr=[{path:"/",name:"Dashboard",component:aa,meta:{title:"实时监控仪表板"}},{path:"/devices/:deviceId",name:"DeviceDetail",component:Wa,meta:{title:"设备详情"}},{path:"/events",name:"EventManagement",component:mr,meta:{title:"事件管理"}},{path:"/alerts",name:"AlertCenter",component:()=>Oe(()=>import("./AlertCenter-B7xRL3qO.js"),__vite__mapDeps([0,1,2,3,4])),meta:{title:"告警中心"}},{path:"/analytics",name:"Analytics",component:()=>Oe(()=>import("./Analytics-wVHM7b_G.js"),__vite__mapDeps([5,2,1,3,6])),meta:{title:"数据分析"}},{path:"/users",name:"UserManagement",component:()=>Oe(()=>import("./UserManagement-ZlSOaJUM.js"),__vite__mapDeps([7,1,2,3,8])),meta:{title:"用户管理"}},{path:"/websocket-test",name:"WebSocketTest",component:()=>Oe(()=>import("./WebSocketTest-BWRlERPs.js"),__vite__mapDeps([9,1,2,3,10])),meta:{title:"WebSocket测试"}},{path:"/map-config-help",name:"MapConfigHelp",component:()=>Oe(()=>import("./MapConfigHelp-DS-svIgq.js"),__vite__mapDeps([11,1,2,3,12])),meta:{title:"地图配置帮助"}}],wn=bn({history:Sn(),routes:vr});wn.beforeEach((e,t,n)=>{e.meta.title&&(document.title=`${e.meta.title} - Muse 云端实时检测平台`),n()});const Ue=En(no);for(const[e,t]of Object.entries(Vn))Ue.component(e,t);Ue.use(In());Ue.use(wn);Ue.use(Bn);Ue.mount("#app");export{qt as D,Ya as E,Wt as H,Be as S,he as _,bt as a,fe as r,_n as u,ee as w};
